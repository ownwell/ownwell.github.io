---
title: Anroid沉浸式状态栏
tags: [weekly]
weekly: ["weekly"]
date: 2016-08-11 14:21:50
---

# 概要
很少写Material Design的东西，今天趁着手热，在Material化财经APP的时候，看了些透明状态栏/沉浸式状态栏的东西，趁着手热总结下。

<img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1470896523109.png" width="136"/>
<!-- more -->


现在大规模的APP都已经实现了实现了沉浸式状态栏，

<img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1470968884672.png" width="308"/>

&emsp;&emsp;关于这个状态栏变色到底叫「Immersive Mode」/「Translucent Bars」有兴趣可以去 [为什么在国内会有很多用户把 ｢透明栏｣（Translucent Bars）称作 ｢沉浸式顶栏｣？](http://www.zhihu.com/question/27040217)以及[何为沉浸模式，沉浸式顶栏，变色龙状态栏](https://www.zhihu.com/question/24908570)，这个历史原因我们解释不清，不过我们还是称为彩色状态栏这样便于理解（原谅我这个标题党）。

根据开发中遇到的情况，根据内容延伸的角度可以分为两张：前三者都是状态栏固定在上方，无论下面怎么滑动，内部View都是那一块固定的大小区域，而后两者是小米系统的天气APP，内容View和状态栏像放在一个`FrameLayout`一样，是层叠关系，内容View可以延伸到状态栏；而根据状态栏的颜色，可以分为状态栏透明和不透明（网易新闻、小米天气都是透明，而豌豆荚、wechat都是不透明）。
# 准备
由于5.0之后已经有了可以设置状态栏和底部导航栏的方法，我们更多的是考虑对4.4--5.0设配的适配。为了更好的理解，我们下来熟悉下面几个名词：

## 透明状态栏

由于Android 4.4才加入透明状态栏，而不是之前的黑乎乎的状态栏，这个也是再向IOS靠近，所以我们只能为4.4之后的系统设置彩色或者透明的状态栏。

### Android 4.4设置透明状态栏
设置方法有两种:

* 代码
```java
 if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
            // 设置状态栏透明
            activity.getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
            
}
```

* XML

 在values-v19文件夹下，为activity的Style 添加一个属性：
 
 ```xml
 <resources>

    <style name="AppTheme" parent="@style/BaseAppTheme">
        <item name="android:windowTranslucentStatus">true</item>
    </style>
</resources>
 ```


### 5.0+透明状态栏
不过对于5.0系统，上面的设置后的结果可能不是透明哦：

<img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1470904408961.png" width="135"/>

```java
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {     
            activity.getWindow().addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);    
            activity.getWindow().clearFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
            activity.getWindow().setStatusBarColor(tranColor);
        } 
```
## `setFitsSystemWindows`

在android doc是这么藐视的：
>
>void setFitsSystemWindows (boolean fitSystemWindows)    
>Sets whether or not this view should account for system screen decorations such as the status bar and inset its content; that is, controlling whether the default implementation of fitSystemWindows(Rect) will be executed. See that method for more details.

Note that if you are providing your own implementation of fitSystemWindows(Rect), then there is no need to set this flag to true -- your implementation will be overriding the default implementation that checks this flag.

大概意思是：`setFitsSystemWindows`用来设置影响系统的工具栏如状态栏，决定了这个view是否插入到它的ContentView。当您设置了fitSystemWindows(Rect)而没有将`setFitsSystemWindows`设置为true，你对fitSystemWindows(Rect)设置是无效的.

该属性可以设置是否为系统 View 预留出空间, 当设置为 true 时,会预留出状态栏的空间。

由于这个实在API14(4.0)之后的函数，为了兼容低版本，才有V4里面的
```java
public static void setFitsSystemWindows(View view, boolean fitSystemWindows) 
```


 
# 延伸内容到状态栏
将内容延伸到状态栏类似与小米天气的APP，先考虑下怎么做？

>答案：将内容移到状态栏下，并且状态栏背景透明.

## 4.4--5.0

```java
  if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
            // 设置状态栏透明
            activity.getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
            //  设置根布局的参数
            ViewGroup rootView = (ViewGroup) ((ViewGroup) activity.findViewById(android.R.id.content)).getChildAt(0);
            ViewCompat.setFitsSystemWindows(rootView,false);
            rootView.setClipToPadding(true);
        }
```









# 参考文章
[Using Immersive Full-Screen Mode](https://developer.android.com/training/system-ui/immersive.html?hl=zh-cn#nonsticky)






