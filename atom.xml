<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>cyning</title>
  <subtitle>Follow your Heart</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://ownwell.github.io/"/>
  <updated>2017-11-05T15:38:46.390Z</updated>
  <id>http://ownwell.github.io/</id>
  
  <author>
    <name>ä¸€èµ·åˆ†äº«æŠ€æœ¯</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åœ¨Androidä¸­ä½¿ç”¨ProGuard</title>
    <link href="http://ownwell.github.io/2017/10/30/android-better-progurad/"/>
    <id>http://ownwell.github.io/2017/10/30/android-better-progurad/</id>
    <published>2017-10-30T14:08:30.000Z</published>
    <updated>2017-11-05T15:38:46.390Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äºä¸€ä¸ªæœ‰ç»éªŒçš„ç¨‹åºå‘˜ï¼ŒProGuardå¤§å®¶ä¸€å®šä¸é™Œç”Ÿï¼Œæœ‰äººè¯´ä»–æ˜¯æ··æ·†ï¼Œæˆ‘å¿…é¡»çº æ­£ï¼Œæ··æ·†åªæ˜¯ProGuardçš„ä¸€ä¸ªè¿‡ç¨‹(æˆ‘ä¸ä¼šç§°ProGuardä¸ºæ··æ·†ï¼ŒProGuardå°±æ˜¯ProGuardï¼Œè°å†è¯´ProGuardæ‰æ˜¯çœŸæ­£çš„æ··æ·†è§†å¬ï¼Œä¸‹é¢æœ‰è§£é‡Š).<br>ProGuardå…¶å®ä¸æ˜¯Androidç‰¹æœ‰çš„å·¥å…·ï¼Œä»–å…¶å®æ›´æ—©é€‚ç”¨äºjavaé¡¹ç›®ä¸­ï¼Œä¼˜åŒ–javaä»£ç ï¼Œä¿è¯javaç¨‹åºçš„å®‰å…¨æ€§ã€‚ç”±äºAndroidç¨‹åºå¤§éƒ¨åˆ†ä¹Ÿæ˜¯æ˜¯Javaä»£ç ï¼Œæ‰€ä»¥ProGuardæˆä¸ºAndroidå·¥ç¨‹å¸ˆå¿…ä¿®çš„ä¸€é—¨è¯¾ç¨‹ã€‚</p>
<h1 id="ç®€å•è®¤è¯†ProGuard"><a href="#ç®€å•è®¤è¯†ProGuard" class="headerlink" title="ç®€å•è®¤è¯†ProGuard"></a>ç®€å•è®¤è¯†ProGuard</h1><p>åœ¨å¹³æ—¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬çš„é¡¹ç›®æ˜¯ProGuardå¼€å…³é»˜è®¤æ˜¯æ˜¯å…³çš„ï¼Œæˆ‘ä»¬é€šè¿‡å¦‚ä¸‹ä»£ç æ‰“å¼€ProGuardï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line"></div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            <span class="function">minifyEnabled <span class="keyword">true</span></span></div><div class="line">            proguardFiles <span class="title">getDefaultProguardFile</span><span class="params">(<span class="string">'proguard-android.txt'</span>)</span>ï¼Œ  'project.pro'</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å…ˆè§£é‡Šä¸‹æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>minifyEnabled</code>æ‰“å¼€å¼€å…³ï¼Œé€šè¿‡<code>proguardFiles</code>æŒ‡å®šæˆ‘ä»¬çš„<code>ProGuard Rule</code>çš„å¤šä¸ªæ–‡ä»¶ï¼ˆåé¢ä¼šä»‹ç»ï¼‰ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>proguardFile</code>æŒ‡å®šä¸€ä¸ªä¸€ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­<code>proguard-android.txt</code>å®é™…ä¸Šæ˜¯æˆ‘ä»¬çš„<code>{Android Sdk path}/tools/proguard/</code>ä¸‹<code>proguard-android.txt</code>ã€‚è¿™æ ·å°±å¯ä»¥ç®€å•ä½¿ç”¨æˆ‘ä»¬çš„ProGuardï¼Œå½“ç„¶äº†å¯¹åº”çš„<code>ProGuard</code>ä¹Ÿæ˜¯æˆ‘ä»¬SDKä¸‹<code>proguard-android.txt</code></p>
<h1 id="ä»€ä¹ˆæ˜¯ProGuard"><a href="#ä»€ä¹ˆæ˜¯ProGuard" class="headerlink" title="ä»€ä¹ˆæ˜¯ProGuard"></a>ä»€ä¹ˆæ˜¯ProGuard</h1><p>é‚£ä¸ªç©¶ç«Ÿä»€ä¹ˆæ˜¯ProGuardå‘¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹<code>{Android Sdk path}/tools/proguard/</code>ä¸‹çš„ProGuardçš„docæ–‡æ¡£ï¼š</p>
<blockquote>
<p>ProGuard is a free Java class file shrinker, optimizer, obfuscator, and preverifier. It detects and removes unused classes, fields, methods, and attributes. It optimizes bytecode and removes unused instructions. It renames the remaining classes, fields, and methods using short meaningless names. Finally, it preverifies the processed code for Java 6 or for Java Micro Edition.</p>
</blockquote>
<p>å¤§æ¦‚æ„æ€å°±æ˜¯ï¼š ProGuardæ˜¯ä¸€ä¸ªå…è´¹çš„å¯ä»¥å°†java classæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œä¼˜åŒ–ï¼Œæ··æ·†ï¼Œé¢„æ ¡éªŒçš„å·¥å…·ã€‚å®ƒèƒ½åˆ é™¤æ— ç”¨çš„ç±»ï¼Œå˜é‡ã€æ–¹æ³•ä»¥åŠå±æ€§ã€‚å®ƒèƒ½ä¼˜åŒ–å­—èŠ‚ç ï¼Œç§»é™¤æ— ç”¨çš„æŒ‡ä»¤ï¼ŒåŒæ—¶å®ƒå°†ï¼ˆå‹ç¼©åï¼‰ä¿ç•™çš„ç±»ï¼Œå˜é‡å’Œæ–¹æ³•ä½¿ç”¨æ— æ„ä¹‰çš„æ®µå­—ç¬¦æ¥é‡å‘½åï¼Œè€Œåè¿˜èƒ½åœ¨å¯¹åº”çš„javaç‰ˆæœ¬ä¸Šè¿›è¡Œé¢„æ ¡éªŒè¿™äº›å¤„ç†åçš„codeã€‚</p>
<p>## ProGuardå››å…„å¼Ÿ</p>
<p><img src="http://7xwwa2.com1.z0.glb.clouddn.com/proguard_intro.png" alt=""></p>
<p>å¦‚ä¸Šå›¾ï¼ŒProGuardå®é™…ä¸Šå››å¤§å¤©ç‹ï¼ˆé­”å®¶å››å°†ï¼‰ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯å‹ç¼©ï¼ˆshrinkingï¼‰ï¼Œä¼˜åŒ–ï¼ˆoptimizationï¼‰ï¼Œæ··æ·†ï¼ˆobfuscationï¼‰å’Œé¢„æ ¡éªŒï¼ˆpreverificationï¼‰ï¼Œä¸€ä¸ªclasså’Œå››å¤§å¤©ç‹ç¢°è¿‡é¢æ‰å¯ä»¥åˆ°æœ€åçš„å—å¤©é—¨ï¼ˆã€‚</p>
<p>å‹ç¼©(shrinking)ï¼šæ£€æµ‹å¹¶ç§»é™¤ä»£ç ä¸­æ— ç”¨çš„ç±»ã€å­—æ®µã€æ–¹æ³•å’Œç‰¹æ€§ï¼ˆAttributeï¼‰<br>ä¼˜åŒ–(optimization)ï¼šå¯¹å­—èŠ‚ç è¿›è¡Œä¼˜åŒ–ï¼Œç§»é™¤æ— ç”¨çš„æŒ‡ä»¤<br>æ··æ·†(obfuscation)ï¼šä½¿ç”¨aï¼Œbï¼Œcï¼Œdè¿™æ ·ç®€çŸ­è€Œæ— æ„ä¹‰çš„åç§°ï¼Œå¯¹ç±»ã€å­—æ®µå’Œæ–¹æ³•è¿›è¡Œé‡å‘½å<br>é¢„æ£€(preverification)ï¼šåœ¨Javaå¹³å°ä¸Šå¯¹å¤„ç†åçš„ä»£ç è¿›è¡Œé¢„æ£€ï¼Œç¡®ä¿åŠ è½½çš„classæ–‡ä»¶æ˜¯å¯æ‰§è¡Œçš„ã€‚<br>å¯¹äºä¸€ä¸ªclassæ–‡ä»¶ä¹Ÿè¦ç»å†å¦‚ä¸‹å››æ­¥ï¼š</p>
<ol>
<li>ä¼šé¦–å…ˆæ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦æœ‰åœ°æ–¹ç”¨åˆ°ï¼ˆæ²¡ç”¨åˆ°ç›´æ¥åˆ é™¤ï¼‰ï¼Œè¿™ä¸ªç±»é‡Œé¢çš„æ–¹æ³•æˆ–è€…å˜é‡å“ªäº›æˆ‘ä»¬æ²¡ç”¨åˆ°ï¼Œæ²¡ç”¨åˆ°å°±ç›´æ¥åˆ é™¤</li>
<li><p>è‹¥ç±»æ²¡æœ‰è¢«åˆ é™¤ï¼Œæ£€æŸ¥classæ–‡ä»¶çš„æ— ç”¨æŒ‡ä»¤å’Œå­—èŠ‚</p>
</li>
<li><p>å°†ä»ç„¶ä¿ç•™çš„ç±»ï¼Œæ··æ·†classååŠå†…éƒ¨çš„å˜é‡å’Œæ–¹æ³•å</p>
</li>
<li>åœ¨å¯¹åº”çš„javaçš„å¹³å°ä¸Šé¢„æ ¡éªŒè¿™ä¸ªclassæ˜¯å¦å®Œæ•´æœ‰æ•ˆ<br>è¿™ä¸ªæ˜¯é»˜è®¤çš„æƒ…å†µä¸‹ç»å†ç€å››ä¸ªæ­¥éª¤ï¼Œè¿™ä¸ªä¹Ÿä¸æ˜¯å¿…é¡»çš„ã€‚å¾ˆåƒç›®å‰ä¸­å›½çš„å¤§ç¯å¢ƒï¼Œä½ å¯ä»¥é€šè¿‡äººæƒ…æ¥é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œè¿™å››å¤§å¤©ç‹ä¹Ÿä¸ä¾‹å¤–ã€‚<br>ä¾‹å¦‚æˆ‘å†™ä¸ªSDKï¼Œé‡Œé¢å°è£…å¾ˆå¤šjavaæ–‡ä»¶ï¼Œæœ€åç±»åº“ä¸ºç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œæœ€åæˆ‘æ‰“å‡ºä¸€ä¸ªjarï¼Œè¿™ä¸ªjaræˆ‘æœŸæœ›ç”¨æ··æ·†ã€‚ä¸¥æ ¼æŒ‰ç…§æ··æ·†çš„å››å¤§å¤©ç‹çš„è§„åˆ™ï¼Œå°±ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼š</li>
<li>ä¿ç•™ä¸€äº›ç±»ã€‚é‡Œé¢çš„ç±»å¥½å¯¹å¤–ä½¿ç”¨çš„ï¼Œä¸ä¼šè¢«SDKå†…éƒ¨ä½¿ç”¨ï¼ŒæŒ‰ç…§æ··æ·†çš„å››å¤§å¤©ç‹çš„è§„åˆ™ï¼Œç¬¬ä¸€æ­¥ç›´æ¥å°±è¢«å¹²æ‰äº†ï¼Œæ‰€æœ‰å°±å¾—èµ°ç‚¹åé—¨<br>2. æŸäº›classï¼Œmethodæˆ–è€…å˜é‡ï¼Œæˆ‘æœŸæœ›ä¸è¦æ··æ·†ã€‚ä¾‹å¦‚ä¸€ä¸ªæ”¯ä»˜çš„classä¸ºPaySDKï¼Œé‡Œé¢çš„æ–¹æ³•ä¹Ÿå°½é‡æ˜¯aliPayï¼ŒwxPayï¼Œåç§°æœ‰æ„ä¹‰ï¼Œä½¿ç”¨æ··æ·†åPaySDKæˆäº†aï¼Œæ–¹æ³•åä¹Ÿæ˜¯æ— æ„ä¹‰çš„aï¼Œbï¼Œè¿™å¯¹ä½¿ç”¨sdkçš„å¼€å‘è€…æ˜¯ä¸å‹å¥½çš„ã€‚<br>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥åˆ¶å®šä¸€ä¸ªè§„åˆ™ï¼Œåœ¨å»å—å¤©é—¨çš„è·¯ä¸Šï¼Œä½ åªç®¡è¿™ä¸ªè§„åˆ™æ¥ç»™å››å¤§å¤©ç‹çœ‹ï¼Œå‘Šè¯‰æŒ‰ç…§æˆ‘ä»¬çš„è§„åˆ™èµ°ï¼Œè€Œè¿™ä¸ªè§„åˆ™å°±æ˜¯<code>ProGuard Rule</code>æˆ‘ä»¬åˆšæ‰é…ç½®çš„<code>proguardFiles</code>,å¯¹äºæˆ‘ä»¬æ¥è¯´å†™ä¸€ä¸ª<code>ProGuard Rule</code>æ˜¯ç›®å‰æ¯”è¾ƒä¸å¤ªå¥½å†™çš„ä¸€ä»¶äº‹ã€‚</li>
</ol>
<h1 id="ProGuard-Rule"><a href="#ProGuard-Rule" class="headerlink" title="ProGuard Rule"></a>ProGuard Rule</h1><p>åœ¨ç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬æåˆ°åœ¨ä¸»é¡¹ç›®ä¸‹çš„build.gradleé…ç½®æˆ‘ä»¬çš„<code>ProGuard Rule</code>,å…¶ä¸­Googleå®˜æ–¹æä¾›äº†ä¸€ä¸ªç®€å•çš„<a href="https://gist.github.com/ownwell/373860e6468671e8e65c8b9eb849f7c2#file-proguard-android-txt" target="_blank" rel="external">åŸºç¡€ç¤ºä¾‹</a>ï¼š<br>æˆ‘ä»¬å°±æ¥å¤§è‡´çœ‹ä¸‹ä»–ä»¬æ˜¯åˆ†åˆ«çš„ä½œç”¨ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># dont ä¸€èˆ¬æ˜¯ä»£è¡¨do notä¸è¦çš„æ„æ€ï¼Œè¿™ä¸ªå°±è¡¨ç¤ºæ··æ·†çš„å­—ç¬¦ä¸é€‚ç”¨å¤§å°å†™æ··åˆçš„ï¼ˆå¦‚Abï¼‰</div><div class="line">-dontusemixedcaseclassnames</div><div class="line">-dontskipnonpubliclibraryclasses</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªæ˜¯Googleå»ºè®®çš„ï¼Œè‹¥ä½ éä½¿ç”¨å¤§å°æ··åˆï¼Œæ²¡äººä¼šæ‹¦ä½ ã€‚ğŸ˜†ã€‚<br><br><br></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ä¸ä¼˜åŒ–ï¼Œdexä¸æ˜¯è¿è¡Œåœ¨JVMä¸Šçš„ï¼Œå½“ç„¶äº†ä¹Ÿä¸åšé¢„æ ¡éªŒ</div><div class="line">-dontoptimize</div><div class="line">-dontpreverify</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ˜¯é’ˆå¯¹androidçš„å¼€å‘è€Œè¨€ï¼Œä¸è¿‡ä½ è¦ä½¿ç”¨ä¼˜åŒ–ï¼Œå°½é‡ä½¿ç”¨<code>{Android Sdk path}/tools/proguard/</code>ä¸‹çš„<code>proguard-android-optimize.txt</code>æ–‡ä»¶ã€‚<br><br><br></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># æ³¨è§£ç›¸å…³çš„</div><div class="line">-keepattributes *Annotation*</div><div class="line"># çŒœæµ‹æ˜¯GoogleæœåŠ¡ç›¸å…³çš„</div><div class="line">-keep public class com.google.vending.licensing.ILicensingService</div><div class="line">-keep public class com.android.vending.licensing.ILicensingService</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æœ‰ä¸ª<code>keepattributes</code>è‚¯å®šæ˜¯ä¿ç•™ç±»çš„å±æ€§å•¦ï¼Œè¿˜æœ‰ä¸ª<code>-keep public class ç±»å</code>è¿™ä¸ªè‚¯å®šå°±æ˜¯ä¸ºäº†ä¿ç•™è¿™ä¸ªç±»ä¸è¢«å‹ç¼©æˆ–è€…æ··æ·†ã€‚<br><br><br><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-keepclasseswithmembernames <span class="class"><span class="keyword">class</span> * </span>&#123;</div><div class="line">    <span class="keyword">native</span> &lt;methods&gt;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ª<code>-keepclasseswithmembernames public class ç±»å</code>ä¸éš¾è§£é‡Šå§ï¼Œå­—é¢æ„æ€æ˜¯ä¿ç•™classå’Œç±»çš„æˆå‘˜ï¼Œå¹¶ä¸”è¿™ä¸ªç±»æœ‰ä¸ªnativeæ–¹æ³•ã€‚<br><br><br><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-keepclassmembers <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> * <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">view</span>.<span class="title">View</span> </span>&#123;</div><div class="line">   <span class="keyword">void</span> set*(***);</div><div class="line">   *** get*();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªå°±ä»£è¡¨ä¿ç•™ç±»ä¸­çš„getter/setteræ–¹æ³•ï¼Œè¿™ä¸ªç±»æ˜¯ç»§æ‰¿è‡ª<code>android.view.View</code><br><br><br><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-keepclassmembers <span class="class"><span class="keyword">class</span> **.<span class="title">R</span>$* </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;fields&gt;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªè‚¯å®šæ˜¯ä¿ç•™æˆ‘ä»¬èµ„æºIDå¯¹åº”çš„Ræ–‡ä»¶ä¸­æ‰€æœ‰çš„é™æ€å˜é‡ã€‚<br><br><br></p>
<p>çœ‹äº†è¿™ä¹ˆå¤šæˆ‘ä»¬ä¼šäº§ç”Ÿç–‘é—®ï¼škeepã€keepclassmembersç­‰è¿™äº›keepå¼€å¤´çš„æœ‰å“ªäº›ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆé…ç½®å‚æ•°ï¼Œclassï¼Œmethodè¿™äº›æ€ä¹ˆå†™ï¼Œ<em>*ä»¥åŠ</em>åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Œå°±è®©æˆ‘ä»¬æ¥ä¸€èµ·æ¢ç´¢<code>ProGuard Rule</code>çš„å†™æ³•å§ã€‚</p>
<h2 id="Keep-options"><a href="#Keep-options" class="headerlink" title="Keep options"></a>Keep options</h2><p>keepç›®å‰å¸¸è§çš„å°±6å…­ç§ï¼š</p>
<ol>
<li>-keep [,modifier,â€¦] class_specification </li>
<li>-keepclassmembers [,modifier,â€¦] class_specification   </li>
<li>-keepclasseswithmembers [,modifier,â€¦] class_specification </li>
<li>-keepnames class_specification åœ¨å‹ç¼©ï¼ˆåˆ é™¤æ— ç”¨çš„ç±»å’Œæˆå‘˜ï¼‰åä¿ç•™ä¸‹æ¥çš„ç±»å’Œå…¶æˆå‘˜ä¸­ï¼Œé˜»æ­¢ç±»å’Œç±»çš„æˆå‘˜(é‡Œé¢çš„å˜é‡å’Œæ–¹æ³•éƒ½æ˜¯æˆå‘˜)æ··æ·†</li>
<li>-keepclassmembernames class_specification åœ¨å‹ç¼©åä¿ç•™ä¸‹æ¥çš„ç±»ä¸­ï¼Œé˜»æ­¢ç±»çš„æˆå‘˜è¢«æ··æ·†</li>
<li>-keepclasseswithmembernames class_specification</li>
</ol>
<h3 id="æœ‰æ— nameçš„keep"><a href="#æœ‰æ— nameçš„keep" class="headerlink" title="æœ‰æ— nameçš„keep*"></a>æœ‰æ— nameçš„keep*</h3><p>å¯ä»¥çœ‹åˆ°å‰ä¸‰ä¸ªå®é™…ä¸Šæ˜¯æ¯”åä¸‰ä¸ªå°‘äº†nameçš„ï¼Œä½†æ˜¯æ„ä¹‰å´å¤§ä¸åŒå•Šã€‚å°±ä»¥keepå’ŒkeepNameä¸ºä¾‹å§ï¼Œ<br>keepæ˜¯é˜»æ­¢ç±»å’Œç±»çš„å˜é‡ï¼ˆå®é™…ä¸Šå°±æ˜¯ç±»ä¸­çš„æ–¹æ³•å’Œå˜é‡ï¼‰è¢«å‹ç¼©å’Œæ··æ·†ï¼Œè€Œkeepnamesé‚£ä¹ˆåˆ™æ˜¯åœ¨å‹ç¼©åï¼Œé˜²æ­¢ç±»å’Œç±»çš„æˆå‘˜è¢«æ··æ·†ã€‚æ¢å¥è¯è¯´ï¼Œkeepåœ¨å‹ç¼©ç¬¬ä¸€é“å¤§é—¨æ—¶ï¼Œå°±å·²ç»ç”Ÿæ•ˆï¼Œå¯ä»¥é¿å…è¢«å‹ç¼©æ‰ï¼Œå³ä½¿è¿™ä¸ªç±»æˆ–è€…æˆå‘˜æ²¡æœ‰è¢«ç”¨åˆ°ä¹Ÿä¸ä¼šè¢«ç§»é™¤ï¼Œè€Œkeepnamesåˆ™æ˜¯åœ¨å‹ç¼©åï¼Œä»ä¿ç•™çš„ç±»ä¸­æ¥çœ‹å“ªäº›ç±»å’Œæˆå‘˜ä¸èƒ½è¢«æ··æ·†ï¼Œæ˜¯åœ¨å‹ç¼©åæ‰ç”Ÿæ•ˆã€‚<br>å®˜æ–¹æ–‡æ¡£è§£é‡Šçš„å¾ˆåˆ°ä½ï¼š</p>
<blockquote>
<blockquote>
<blockquote>
<p>Short for -keep,allowshrinking class_specification</p>
</blockquote>
</blockquote>
</blockquote>
<p>å®é™…ä¸ŠåŠ äº†<code>allowshrinking</code>çš„keppå‘½ä»¤ï¼Œå…è®¸å‹ç¼©ã€‚</p>
<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>æ¦‚è¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>keep</td>
<td>é˜»æ­¢ç±»å’Œæˆå‘˜è¢«å’Œæ··æ·†</td>
</tr>
<tr>
<td>keepclassmember</td>
<td>é˜»æ­¢ç±»çš„æˆå‘˜è¢«å’Œæ··æ·†</td>
</tr>
<tr>
<td>keepclasseswithmembers</td>
<td>é˜»æ­¢ç±»å’Œç±»ä¸­ç‰¹å®šçš„æˆå‘˜è¢«å‹ç¼©å’Œæ··æ·†</td>
</tr>
<tr>
<td>keepnames</td>
<td>åœ¨å‹ç¼©åä¿ç•™ä¸‹æ¥çš„ç±»å’Œå…¶æˆå‘˜ä¸­ï¼Œé˜»æ­¢ç±»å’Œç±»çš„æˆå‘˜(é‡Œé¢çš„å˜é‡å’Œæ–¹æ³•éƒ½æ˜¯æˆå‘˜)æ··æ·†</td>
</tr>
<tr>
<td>keepclassmembernames</td>
<td>åœ¨å‹ç¼©åä¿ç•™ä¸‹æ¥çš„ç±»å’Œå…¶æˆå‘˜ä¸­ï¼Œé˜»æ­¢ç±»çš„æˆå‘˜è¢«æ··æ·†</td>
</tr>
<tr>
<td>keepclassmembernames</td>
<td>åœ¨å‹ç¼©åä¿ç•™ä¸‹æ¥çš„ç±»å’Œå…¶æˆå‘˜ä¸­ï¼Œé˜»æ­¢ç±»å’Œç±»ä¸­ç‰¹å®šçš„æˆå‘˜è¢«æ··æ·†</td>
</tr>
</tbody>
</table>
<h3 id="keep-VS-keepclasseswithmembers"><a href="#keep-VS-keepclasseswithmembers" class="headerlink" title="keep VS keepclasseswithmembers"></a>keep VS keepclasseswithmembers</h3><p>è¿™ä¸¤ä¸ªéƒ½å¯ä»¥æ³¨é‡Šä¿ç•™ä½classåŠå…¶æˆå‘˜ï¼Œä½†æ˜¯äºŒè€…åŒºåˆ†æœ€å¤§ä¹‹å¤„åœ¨äºï¼škeepåªçœ‹åé¢çš„class æ˜¯ä»€ä¹ˆï¼Œä¸å…³å¿ƒåé¢çš„æˆå‘˜ï¼Œè€Œkeepclasseswithmembersåˆ™æ˜¯æ›´å…³å¿ƒåé¢çš„æ¡ä»¶ã€‚å¹²è¯´å¤ªç¡¬ï¼Œæ¥ç‚¹æ¹¿çš„ã€‚<br>å¦‚ä¸‹è§„åˆ™ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-keepclasseswithmembernames <span class="class"><span class="keyword">class</span> <span class="title">me</span>.<span class="title">cyning</span>.* </span>&#123;</div><div class="line">    <span class="keyword">native</span> &lt;methods&gt;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å½“åœ¨me.cyningåŒ…ä¸‹ï¼Œé‡åˆ°æ–¹æ³•ä½“æœ‰nativeæ–¹æ³•æ—¶ï¼Œåˆ™keepå…¶classï¼ŒåŒæ—¶keepè¿™ä¸ªclassçš„nativeçš„æ–¹æ³•ï¼ˆå…¶ä»–æ— ç”¨æ–¹æ³•å¯èƒ½ä¼šè¢«åˆ æ‰æˆ–è€…æ–¹æ³•åä¼šè¢«æ··æ·†ï¼‰ã€‚</p>
<p>è€Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-keep <span class="class"><span class="keyword">class</span> <span class="title">me</span>.<span class="title">cyning</span>.* </span>&#123;</div><div class="line">    <span class="keyword">native</span> &lt;methods&gt;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åˆ™ä¼šå°†classä¸å‹ç¼©</p>
<p>è¿™ä¸ªkeep*å¯ä»¥ä¿è¯ç±»æˆ–è€…æ–¹æ³•ä¸è¢«å‹ç¼©å’Œæ··æ·†ï¼Œè‡³äºé€‰å“ªä¸ªçœ‹ä½ å¿ƒæƒ…å–½ã€‚</p>
<p>## </p>
<h2 id="Class-specifications"><a href="#Class-specifications" class="headerlink" title="Class specifications"></a>Class specifications</h2><p>åœ¨åˆšæ‰ç¤ºä¾‹ä¸­ï¼Œæœ‰ä¸ªä»£ç ç‰‡æ®µï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-keep <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">google</span>.<span class="title">vending</span>.<span class="title">licensing</span>.<span class="title">ILicensingService</span></span></div></pre></td></tr></table></figure></p>
<p>é€šè¿‡è¿™ä¸€å¥<code>keep</code>äº†<code>com.google.vending.licensing.ILicensingService</code>ï¼Œä½†æ˜¯æˆ‘ä»¬è‹¥æ˜¯<code>keep</code>æŸä¸€ç±»æ—¶è€Œä¸åªæ˜¯ä¸€ä¸ªclassæ—¶ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆåŠï¼Ÿ<br>è¿™å°±éœ€è¦æˆ‘ä»¬å°†è¿™ä¸€ç±»çš„åšä¸ªæŠ½è±¡ï¼Œè€Œå°†è¿™æ‰€æœ‰çš„ç±»éƒ½åˆ—å‡ºæ¥ä¸€ä¸ªä¸ªkeepã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸‹classçš„åŸºæœ¬ç¤ºä¾‹ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[@annotationtype] [[!]public|final|abstract|@ ...] [!]interface|class|enum classname</div><div class="line">    [extends|implements [@annotationtype] classname]</div><div class="line">[&#123;</div><div class="line">    [@annotationtype] [[!]public|private|protected|static|volatile|transient ...] &lt;fields&gt; |</div><div class="line">                                                                      (fieldtype fieldname);</div><div class="line">    [@annotationtype] [[!]public|private|protected|static|synchronized|native|abstract|strictfp ...] &lt;methods&gt; |</div><div class="line">                                                                                           &lt;init&gt;(argumenttype,...) |</div><div class="line">                                                                                           classname(argumenttype,...) |</div><div class="line">                                                                                           (returntype methodname(argumenttype,...));</div><div class="line">    [@annotationtype] [[!]public|private|protected|static ... ] *;</div><div class="line">    ...</div><div class="line">&#125;]</div></pre></td></tr></table></figure></p>
<p>å…ˆæ¥è§£é‡Šä¸‹[]å§ï¼Œè¿™ä¸ªéƒ½æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥é€‰æ‹©æ— ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©[]é‡Œçš„ä¸€ç§æˆ–è€…å¤šç§ã€‚å¦‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@me</span>.cyning.Keep <span class="class"><span class="keyword">class</span> * </span>&#123;</div><div class="line">   <span class="keyword">native</span> &lt;methods&gt;() </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å°±è¡¨ç¤ºæ‰€æœ‰åŠ äº†<code>me.cyning.Keep</code>ç±»æ³¨è§£ä¸”æœ‰nativeæ–¹æ³•çš„ç±»ã€‚<br>å°±è®©æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹<code>Class specifications</code></p>
<ol>
<li>annotationtypeå®é™…ä¸Šå°±æ˜¯ç±»æ³¨è§£ï¼Œå¦‚ä¸Šé¢<code>@me.cyning.Keep</code></li>
<li>class/interface/enum å‰å¯ä»¥æ·»åŠ ä¿®é¥°ç¬¦å¦‚publicï¼Œfinalï¼Œabstractç­‰ä¿®é¥°ç¬¦ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™äº›ä¿®é¥°ç¬¦å‰åŠ !è¡¨ç¤ºå¦å®šï¼Œå¦‚!private éç§æœ‰çš„ï¼›åœ¨class/interface/enumå‰ä¹Ÿå¯ä»¥åŠ !è¡¨ç¤ºå¦å®šï¼Œéƒ½æ˜¯é»‘ç§‘æŠ€å•Š</li>
<li>extends/implements åå¯ä»¥æ·»åŠ æˆ‘ä»¬ç»§æ‰¿æˆ–è€…å®ç°çš„ç±»æˆ–è€…æ¥å£ï¼Œä½†æ˜¯è®°ä½ä¸€å®šè¦å†™å…¨åï¼ˆåŒ…å+classnameï¼‰ã€‚</li>
<li><fields> è¡¨ç¤ºé‡Œé¢çš„å˜é‡ï¼Œä»–çš„å‰é¢å¯ä»¥åŠ å…¥ä¿®é¥°ç¬¦<code>public</code>ã€<code>private</code>ã€<code>protected</code>ã€<code>static</code>ã€<code>volatile</code>ã€<code>transient</code>ç­‰ã€‚</fields></li>
<li><methods>å¯ä»¥è¡¨ç¤ºå‡ºäº†æ„é€ å‡½æ•°å¤–çš„æ–¹æ³•ï¼Œå®ƒå‰é¢ä¹Ÿå¯ä»¥åŠ å…¥<code>public</code>ã€<code>private</code>ã€<code>protected</code>ã€<code>static</code>|<code>synchronized</code>ã€<code>native</code>ã€<code>abstract</code>ã€<code>strictfp</code>ç­‰ä¿®é¥°ç¬¦;è€Œ<init>åˆ™è¡¨ç¤ºæ„é€ å‡½æ•°<br>6.</init></methods></li>
<li>é’ˆå¯¹ä¸€ä¸ªclass/interface/enumä¸‹çš„æ‰€æœ‰æ–¹æ³•æˆ‘ä»¬å¯ä»¥ç”¨<em>æ¥è¡¨ç¤ºå¦‚ `public </em>;`åˆ™è¡¨ç¤ºæ‰€æœ‰ä¿®é¥°ç¬¦ä¸ºpublicçš„æ–¹æ³•å’Œå˜é‡ã€‚</li>
</ol>
<p>é’ˆå¯¹ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜é—æ¼äº†ä¸€ä¸ªå¾ˆé‡çš„ä¸œè¥¿å°±æ˜¯é€šé…ç¬¦ï¼Œå¦‚<em>ï¼Œ*</em>ã€‚è€Œé€šé…ç¬¦åˆåˆ†ä¸ºä»¥ä¸‹ï¼š</p>
<h2 id="packageName-className-methodName"><a href="#packageName-className-methodName" class="headerlink" title="packageName/className/methodName"></a>packageName/className/methodName</h2><p>åŒ…åæˆ–è€…ç±»åæ˜¯æˆ‘ä»¬å¸¸è§éœ€è¦ç”¨åˆ°çš„ï¼Œæˆ‘ä»¬åˆ—å‡ºæˆ‘ä»¬å¸¸ç”¨çš„é€šé…ç¬¦ã€‚<br>é€šé…ç¬¦ |   æ¦‚è¿°<br>â€”-    | â€”<br>ï¼Ÿ    | è¡¨ç¤ºä»»ä½•ä¸€ä¸ªä»»æ„ä½†ä¸æ˜¯åŒ…åä¸­çš„.åˆ†éš”ç¬¦ã€‚å¦‚<code>me.cyning.Test?</code>å¯ä»¥è¡¨ç¤º<code>me.cyning.Test1</code>å’Œ<code>me.cyning.TestA</code>ï¼Œè€Œä¸èƒ½ä»£è¡¨<code>me.cyning.Test11</code></p>
<ul>
<li>|  è¡¨ç¤ºä»»ä½•å¤šä¸ªå­—ç¬¦ä½†ä¸èƒ½æ˜¯åŒ…åä¸­çš„.åˆ†éš”ç¬¦ã€‚å¦‚<code>me.cyning.Test*</code>å¯ä»¥è¡¨ç¤º<code>me.cyning.Test1</code>å’Œ<code>me.cyning.Test11</code>ï¼Œè€Œä¸èƒ½ä»£è¡¨<code>me.cyning.Test.A</code><br><strong>         | è¡¨ç¤ºä»»ä½•å¤šä¸ªå­—ç¬¦,å¯ä»¥æ˜¯åŒ…åä¸­çš„.åˆ†éš”ç¬¦,å¦‚`me.cyning.</strong><code>å¯ä»¥è¡¨ç¤º</code>me.cyning.Test1<code>å’Œ</code>me.cyning.Test11<code>,ä¹Ÿå¯ä»¥æ˜¯</code>me.cyning.Test.A`</li>
</ul>
<h2 id="ç±»å‹æè¿°"><a href="#ç±»å‹æè¿°" class="headerlink" title="ç±»å‹æè¿°"></a>ç±»å‹æè¿°</h2><p>åŒ…åæˆ–è€…ç±»åæ˜¯æˆ‘ä»¬å¸¸è§éœ€è¦ç”¨åˆ°çš„ï¼Œæˆ‘ä»¬åˆ—å‡ºæˆ‘ä»¬å¸¸ç”¨çš„é€šé…ç¬¦ã€‚å’Œ<code>packageName/className/methodName</code>æœ‰ç±»ä¼¼ä¹‹å¤„<br>é€šé…ç¬¦ |   æ¦‚è¿°<br>â€”-    | â€”<br>%  | é™¤äº†voidçš„åŸºæœ¬ç±»å‹<br>?  | å•ä¸ªå­—ç¬¦</p>
<ul>
<li>| ä¸åŒ…æ‹¬.åŒ…åˆ†éš”ç¬¦çš„ä»»æ„ç±»åçš„ä¸€éƒ¨åˆ†<br><strong>  | åŒ…æ‹¬.åŒ…åˆ†éš”ç¬¦çš„ä»»æ„ç±»åçš„ä¸€éƒ¨åˆ†<br>*</strong>  | ä»»æ„ç±»å‹<br>â€¦  | å¯è¡¨ç¤ºå¤šä¸ªä»»æ„ä¸”ä»»æ„ç±»å‹çš„ç±»å‹çš„å‚æ•° å¦‚init(â€¦)å¯ä»£è¡¨init(int a, int b) ä¹Ÿå¯ä»¥ä»£è¡¨æ˜¯init(String)<br>ç†Ÿæ‚‰äº†ProGuard Ruleçš„è§„åˆ™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ¥çœ‹æœ€å¼€å§‹æˆ‘ä»¬æåˆ°çš„[é»˜è®¤çš„ProGuard Rule](â€”<br>title: android_better_progurad<br>date: 2017-10-30 22:08:30<br>tags:</li>
</ul>
<hr>
<p>è¿‡äº†19å¤§ï¼Œå…šæœ‰äº†æœªæ¥5å¹´çš„è§„åˆ’ï¼Œæ–°ç†å¿µä½ Getäº†æ²¡ï¼Ÿï¼ˆæˆ‘è§‰å¾—å¼€å®Œ19å¤§ï¼Œåšåœ°é“éƒ½è½»æ¾å¤šäº†ï¼Œå“ˆå“ˆï¼‰ã€‚æˆ‘ä¹Ÿç»™è‡ªå·±è£‚äº†ä¸ªè§„åˆ’ï¼Œä¸¤å‘¨ä¸€ç¯‡åšå®¢ï¼Œè¶Šå¹²ï¼ˆgan ä¸€å£°ï¼‰è¶Šå¥½ã€‚ä»Šå¤©ç»™è‡ªå·±å¸¦æ¥çš„å¹²è´§æ˜¯ProGuardã€‚<br>å¯¹äºä¸€ä¸ªæœ‰ç»éªŒçš„ç¨‹åºå‘˜ï¼ŒProGuardå¤§å®¶ä¸€å®šä¸é™Œç”Ÿï¼Œæœ‰äººè¯´ä»–æ˜¯æ··æ·†ï¼Œæˆ‘å¿…é¡»çº æ­£ï¼Œæ··æ·†åªæ˜¯ProGuardçš„ä¸€ä¸ªè¿‡ç¨‹(æˆ‘ä¸ä¼šç§°ProGuardä¸ºæ··æ·†ï¼ŒProGuardå°±æ˜¯ProGuardï¼Œè°å†è¯´ProGuardæ‰æ˜¯çœŸæ­£çš„æ··æ·†è§†å¬).<br>ProGuardå…¶å®ä¸æ˜¯Androidç‰¹æœ‰çš„å·¥å…·ï¼Œä»–å…¶å®æ›´æ—©é€‚ç”¨äºjavaé¡¹ç›®ä¸­ï¼Œä¼˜åŒ–javaä»£ç ï¼Œä¿è¯javaç¨‹åºçš„å®‰å…¨æ€§ã€‚ç”±äºAndroidç¨‹åºå¤§éƒ¨åˆ†ä¹Ÿæ˜¯æ˜¯Javaä»£ç ï¼Œæ‰€ä»¥ProGuardæˆä¸ºAndroidå·¥ç¨‹å¸ˆå¿…ä¿®çš„ä¸€é—¨è¯¾ç¨‹ã€‚</p>
<h1 id="ç®€å•è®¤è¯†ProGuard-1"><a href="#ç®€å•è®¤è¯†ProGuard-1" class="headerlink" title="ç®€å•è®¤è¯†ProGuard"></a>ç®€å•è®¤è¯†ProGuard</h1><p>åœ¨å¹³æ—¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬çš„é¡¹ç›®æ˜¯ProGuardå¼€å…³é»˜è®¤æ˜¯æ˜¯å…³çš„ï¼Œæˆ‘ä»¬é€šè¿‡å¦‚ä¸‹ä»£ç æ‰“å¼€ProGuardï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line"></div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            <span class="function">minifyEnabled <span class="keyword">true</span></span></div><div class="line">            proguardFiles <span class="title">getDefaultProguardFile</span><span class="params">(<span class="string">'proguard-android.txt'</span>)</span>ï¼Œ  'project.pro'</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å…ˆè§£é‡Šä¸‹æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>minifyEnabled</code>æ‰“å¼€å¼€å…³ï¼Œé€šè¿‡<code>proguardFiles</code>æŒ‡å®šæˆ‘ä»¬çš„<code>ProGuard Rule</code>çš„å¤šä¸ªæ–‡ä»¶ï¼ˆåé¢ä¼šä»‹ç»ï¼‰ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>proguardFile</code>æŒ‡å®šä¸€ä¸ªä¸€ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­<code>proguard-android.txt</code>å®é™…ä¸Šæ˜¯æˆ‘ä»¬çš„<code>{Android Sdk path}/tools/proguard/</code>ä¸‹<code>proguard-android.txt</code>ã€‚è¿™æ ·å°±å¯ä»¥ç®€å•ä½¿ç”¨æˆ‘ä»¬çš„ProGuardï¼Œå½“ç„¶äº†å¯¹åº”çš„<code>ProGuard</code>ä¹Ÿæ˜¯æˆ‘ä»¬SDKä¸‹<code>proguard-android.txt</code></p>
<h1 id="ä»€ä¹ˆæ˜¯ProGuard-1"><a href="#ä»€ä¹ˆæ˜¯ProGuard-1" class="headerlink" title="ä»€ä¹ˆæ˜¯ProGuard"></a>ä»€ä¹ˆæ˜¯ProGuard</h1><p>é‚£ä¸ªç©¶ç«Ÿä»€ä¹ˆæ˜¯ProGuardå‘¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹<code>{Android Sdk path}/tools/proguard/</code>ä¸‹çš„ProGuardçš„docæ–‡æ¡£ï¼š</p>
<blockquote>
<p>ProGuard is a free Java class file shrinker, optimizer, obfuscator, and preverifier. It detects and removes unused classes, fields, methods, and attributes. It optimizes bytecode and removes unused instructions. It renames the remaining classes, fields, and methods using short meaningless names. Finally, it preverifies the processed code for Java 6 or for Java Micro Edition.</p>
</blockquote>
<p>å¤§æ¦‚æ„æ€å°±æ˜¯ï¼š ProGuardæ˜¯ä¸€ä¸ªå…è´¹çš„å¯ä»¥å°†java classæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œä¼˜åŒ–ï¼Œæ··æ·†ï¼Œé¢„æ ¡éªŒçš„å·¥å…·ã€‚å®ƒèƒ½åˆ é™¤æ— ç”¨çš„ç±»ï¼Œå˜é‡ã€æ–¹æ³•ä»¥åŠå±æ€§ã€‚å®ƒèƒ½ä¼˜åŒ–å­—èŠ‚ç ï¼Œç§»é™¤æ— ç”¨çš„æŒ‡ä»¤ï¼ŒåŒæ—¶å®ƒå°†ï¼ˆå‹ç¼©åï¼‰ä¿ç•™çš„ç±»ï¼Œå˜é‡å’Œæ–¹æ³•ä½¿ç”¨æ— æ„ä¹‰çš„æ®µå­—ç¬¦æ¥é‡å‘½åï¼Œè€Œåè¿˜èƒ½åœ¨å¯¹åº”çš„javaç‰ˆæœ¬ä¸Šè¿›è¡Œé¢„æ ¡éªŒè¿™äº›å¤„ç†åçš„codeã€‚<br>## ProGuardå››å…„å¼Ÿ<br><img src="http://7xwwa2.com1.z0.glb.clouddn.com/proguard_intro.png" alt=""></p>
<p>å¦‚ä¸Šå›¾ï¼ŒProGuardå®é™…ä¸Šå››å¤§å¤©ç‹ï¼ˆé­”å®¶å››å°†ï¼‰ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯å‹ç¼©ï¼ˆshrinkingï¼‰ï¼Œä¼˜åŒ–ï¼ˆoptimizationï¼‰ï¼Œæ··æ·†ï¼ˆobfuscationï¼‰å’Œé¢„æ ¡éªŒï¼ˆpreverificationï¼‰ï¼Œä¸€ä¸ªclasså’Œå››å¤§å¤©ç‹ç¢°è¿‡é¢æ‰å¯ä»¥åˆ°æœ€åçš„å—å¤©é—¨ï¼ˆã€‚</p>
<p>å‹ç¼©(shrinking)ï¼šæ£€æµ‹å¹¶ç§»é™¤ä»£ç ä¸­æ— ç”¨çš„ç±»ã€å­—æ®µã€æ–¹æ³•å’Œç‰¹æ€§ï¼ˆAttributeï¼‰<br>ä¼˜åŒ–(optimization)ï¼šå¯¹å­—èŠ‚ç è¿›è¡Œä¼˜åŒ–ï¼Œç§»é™¤æ— ç”¨çš„æŒ‡ä»¤<br>æ··æ·†(obfuscation)ï¼šä½¿ç”¨aï¼Œbï¼Œcï¼Œdè¿™æ ·ç®€çŸ­è€Œæ— æ„ä¹‰çš„åç§°ï¼Œå¯¹ç±»ã€å­—æ®µå’Œæ–¹æ³•è¿›è¡Œé‡å‘½å<br>é¢„æ£€(preverification)ï¼šåœ¨Javaå¹³å°ä¸Šå¯¹å¤„ç†åçš„ä»£ç è¿›è¡Œé¢„æ£€ï¼Œç¡®ä¿åŠ è½½çš„classæ–‡ä»¶æ˜¯å¯æ‰§è¡Œçš„ã€‚<br>å¯¹äºä¸€ä¸ªclassæ–‡ä»¶ä¹Ÿè¦ç»å†å¦‚ä¸‹å››æ­¥ï¼š</p>
<ol>
<li>ä¼šé¦–å…ˆæ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦æœ‰åœ°æ–¹ç”¨åˆ°ï¼ˆæ²¡ç”¨åˆ°ç›´æ¥åˆ é™¤ï¼‰ï¼Œè¿™ä¸ªç±»é‡Œé¢çš„æ–¹æ³•æˆ–è€…å˜é‡å“ªäº›æˆ‘ä»¬æ²¡ç”¨åˆ°ï¼Œæ²¡ç”¨åˆ°å°±ç›´æ¥åˆ é™¤</li>
<li><p>è‹¥ç±»æ²¡æœ‰è¢«åˆ é™¤ï¼Œæ£€æŸ¥classæ–‡ä»¶çš„æ— ç”¨æŒ‡ä»¤å’Œå­—èŠ‚</p>
</li>
<li><p>å°†ä»ç„¶ä¿ç•™çš„ç±»ï¼Œæ··æ·†classååŠå†…éƒ¨çš„å˜é‡å’Œæ–¹æ³•å</p>
</li>
<li>åœ¨å¯¹åº”çš„javaçš„å¹³å°ä¸Šé¢„æ ¡éªŒè¿™ä¸ªclassæ˜¯å¦å®Œæ•´æœ‰æ•ˆ<br>è¿™ä¸ªæ˜¯é»˜è®¤çš„æƒ…å†µä¸‹ç»å†ç€å››ä¸ªæ­¥éª¤ï¼Œè¿™ä¸ªä¹Ÿä¸æ˜¯å¿…é¡»çš„ã€‚å¾ˆåƒç›®å‰ä¸­å›½çš„å¤§ç¯å¢ƒï¼Œä½ å¯ä»¥é€šè¿‡äººæƒ…æ¥é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œè¿™å››å¤§å¤©ç‹ä¹Ÿä¸ä¾‹å¤–ã€‚<br>ä¾‹å¦‚æˆ‘å†™ä¸ªSDKï¼Œé‡Œé¢å°è£…å¾ˆå¤šjavaæ–‡ä»¶ï¼Œæœ€åç±»åº“ä¸ºç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œæœ€åæˆ‘æ‰“å‡ºä¸€ä¸ªjarï¼Œè¿™ä¸ªjaræˆ‘æœŸæœ›ç”¨æ··æ·†ã€‚ä¸¥æ ¼æŒ‰ç…§æ··æ·†çš„å››å¤§å¤©ç‹çš„è§„åˆ™ï¼Œå°±ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼š</li>
<li>ä¿ç•™ä¸€äº›ç±»ã€‚é‡Œé¢çš„ç±»å¥½å¯¹å¤–ä½¿ç”¨çš„ï¼Œä¸ä¼šè¢«SDKå†…éƒ¨ä½¿ç”¨ï¼ŒæŒ‰ç…§æ··æ·†çš„å››å¤§å¤©ç‹çš„è§„åˆ™ï¼Œç¬¬ä¸€æ­¥ç›´æ¥å°±è¢«å¹²æ‰äº†ï¼Œæ‰€æœ‰å°±å¾—èµ°ç‚¹åé—¨<br>2. æŸäº›classï¼Œmethodæˆ–è€…å˜é‡ï¼Œæˆ‘æœŸæœ›ä¸è¦æ··æ·†ã€‚ä¾‹å¦‚ä¸€ä¸ªæ”¯ä»˜çš„classä¸ºPaySDKï¼Œé‡Œé¢çš„æ–¹æ³•ä¹Ÿå°½é‡æ˜¯aliPayï¼ŒwxPayï¼Œåç§°æœ‰æ„ä¹‰ï¼Œä½¿ç”¨æ··æ·†åPaySDKæˆäº†aï¼Œæ–¹æ³•åä¹Ÿæ˜¯æ— æ„ä¹‰çš„aï¼Œbï¼Œè¿™å¯¹ä½¿ç”¨sdkçš„å¼€å‘è€…æ˜¯ä¸å‹å¥½çš„ã€‚<br>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥åˆ¶å®šä¸€ä¸ªè§„åˆ™ï¼Œåœ¨å»å—å¤©é—¨çš„è·¯ä¸Šï¼Œä½ åªç®¡è¿™ä¸ªè§„åˆ™æ¥ç»™å››å¤§å¤©ç‹çœ‹ï¼Œå‘Šè¯‰æŒ‰ç…§æˆ‘ä»¬çš„è§„åˆ™èµ°ï¼Œè€Œè¿™ä¸ªè§„åˆ™å°±æ˜¯<code>ProGuard Rule</code>æˆ‘ä»¬åˆšæ‰é…ç½®çš„<code>proguardFiles</code>,å¯¹äºæˆ‘ä»¬æ¥è¯´å†™ä¸€ä¸ª<code>ProGuard Rule</code>æ˜¯ç›®å‰æ¯”è¾ƒä¸å¤ªå¥½å†™çš„ä¸€ä»¶äº‹ã€‚</li>
</ol>
<h1 id="ProGuard-Rule-1"><a href="#ProGuard-Rule-1" class="headerlink" title="ProGuard Rule"></a>ProGuard Rule</h1><p>åœ¨ç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬æåˆ°åœ¨ä¸»é¡¹ç›®ä¸‹çš„build.gradleé…ç½®æˆ‘ä»¬çš„<code>ProGuard Rule</code>,å…¶ä¸­Googleå®˜æ–¹æä¾›äº†ä¸€ä¸ªç®€å•çš„<a href="https://gist.github.com/ownwell/373860e6468671e8e65c8b9eb849f7c2#file-proguard-android-txt" target="_blank" rel="external">åŸºç¡€ç¤ºä¾‹</a>ï¼š<br>æˆ‘ä»¬å°±æ¥å¤§è‡´çœ‹ä¸‹ä»–ä»¬æ˜¯åˆ†åˆ«çš„ä½œç”¨ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># dont ä¸€èˆ¬æ˜¯ä»£è¡¨do notä¸è¦çš„æ„æ€ï¼Œè¿™ä¸ªå°±è¡¨ç¤ºæ··æ·†çš„å­—ç¬¦ä¸é€‚ç”¨å¤§å°å†™æ··åˆçš„ï¼ˆå¦‚Abï¼‰</div><div class="line">-dontusemixedcaseclassnames</div><div class="line">-dontskipnonpubliclibraryclasses</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªæ˜¯Googleå»ºè®®çš„ï¼Œè‹¥ä½ éä½¿ç”¨å¤§å°æ··åˆï¼Œæ²¡äººä¼šæ‹¦ä½ ã€‚ğŸ˜†ã€‚<br><br><br></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ä¸ä¼˜åŒ–ï¼Œdexä¸æ˜¯è¿è¡Œåœ¨JVMä¸Šçš„ï¼Œå½“ç„¶äº†ä¹Ÿä¸åšé¢„æ ¡éªŒ</div><div class="line">-dontoptimize</div><div class="line">-dontpreverify</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ˜¯é’ˆå¯¹androidçš„å¼€å‘è€Œè¨€ï¼Œä¸è¿‡ä½ è¦ä½¿ç”¨ä¼˜åŒ–ï¼Œå°½é‡ä½¿ç”¨<code>{Android Sdk path}/tools/proguard/</code>ä¸‹çš„<code>proguard-android-optimize.txt</code>æ–‡ä»¶ã€‚<br><br><br></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># æ³¨è§£ç›¸å…³çš„</div><div class="line">-keepattributes *Annotation*</div><div class="line"># çŒœæµ‹æ˜¯GoogleæœåŠ¡ç›¸å…³çš„</div><div class="line">-keep public class com.google.vending.licensing.ILicensingService</div><div class="line">-keep public class com.android.vending.licensing.ILicensingService</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æœ‰ä¸ª<code>keepattributes</code>è‚¯å®šæ˜¯ä¿ç•™ç±»çš„å±æ€§å•¦ï¼Œè¿˜æœ‰ä¸ª<code>-keep public class ç±»å</code>è¿™ä¸ªè‚¯å®šå°±æ˜¯ä¸ºäº†ä¿ç•™è¿™ä¸ªç±»ä¸è¢«å‹ç¼©æˆ–è€…æ··æ·†ã€‚<br><br><br><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-keepclasseswithmembernames <span class="class"><span class="keyword">class</span> * </span>&#123;</div><div class="line">    <span class="keyword">native</span> &lt;methods&gt;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ª<code>-keepclasseswithmembernames public class ç±»å</code>ä¸éš¾è§£é‡Šå§ï¼Œå­—é¢æ„æ€æ˜¯ä¿ç•™classå’Œç±»çš„æˆå‘˜ï¼Œå¹¶ä¸”è¿™ä¸ªç±»æœ‰ä¸ªnativeæ–¹æ³•ã€‚<br><br><br><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-keepclassmembers <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> * <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">view</span>.<span class="title">View</span> </span>&#123;</div><div class="line">   <span class="keyword">void</span> set*(***);</div><div class="line">   *** get*();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªå°±ä»£è¡¨ä¿ç•™ç±»ä¸­çš„getter/setteræ–¹æ³•ï¼Œè¿™ä¸ªç±»æ˜¯ç»§æ‰¿è‡ª<code>android.view.View</code><br><br><br><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-keepclassmembers <span class="class"><span class="keyword">class</span> **.<span class="title">R</span>$* </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;fields&gt;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªè‚¯å®šæ˜¯ä¿ç•™æˆ‘ä»¬èµ„æºIDå¯¹åº”çš„Ræ–‡ä»¶ä¸­æ‰€æœ‰çš„é™æ€å˜é‡ã€‚<br><br><br></p>
<p>çœ‹äº†è¿™ä¹ˆå¤šæˆ‘ä»¬ä¼šäº§ç”Ÿç–‘é—®ï¼škeepã€keepclassmembersç­‰è¿™äº›keepå¼€å¤´çš„æœ‰å“ªäº›ï¼ŒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆé…ç½®å‚æ•°ï¼Œclassï¼Œmethodè¿™äº›æ€ä¹ˆå†™ï¼Œ<em>*ä»¥åŠ</em>åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Œå°±è®©æˆ‘ä»¬æ¥ä¸€èµ·æ¢ç´¢<code>ProGuard Rule</code>çš„å†™æ³•å§ã€‚</p>
<h2 id="Keep-options-1"><a href="#Keep-options-1" class="headerlink" title="Keep options"></a>Keep options</h2><p>keepç›®å‰å¸¸è§çš„å°±6å…­ç§ï¼š</p>
<ol>
<li>-keep [,modifier,â€¦] class_specification </li>
<li>-keepclassmembers [,modifier,â€¦] class_specification   </li>
<li>-keepclasseswithmembers [,modifier,â€¦] class_specification </li>
<li>-keepnames class_specification åœ¨å‹ç¼©ï¼ˆåˆ é™¤æ— ç”¨çš„ç±»å’Œæˆå‘˜ï¼‰åä¿ç•™ä¸‹æ¥çš„ç±»å’Œå…¶æˆå‘˜ä¸­ï¼Œé˜»æ­¢ç±»å’Œç±»çš„æˆå‘˜(é‡Œé¢çš„å˜é‡å’Œæ–¹æ³•éƒ½æ˜¯æˆå‘˜)æ··æ·†</li>
<li>-keepclassmembernames class_specification åœ¨å‹ç¼©åä¿ç•™ä¸‹æ¥çš„ç±»ä¸­ï¼Œé˜»æ­¢ç±»çš„æˆå‘˜è¢«æ··æ·†</li>
<li>-keepclasseswithmembernames class_specification</li>
</ol>
<h3 id="æœ‰æ— nameçš„keep-1"><a href="#æœ‰æ— nameçš„keep-1" class="headerlink" title="æœ‰æ— nameçš„keep*"></a>æœ‰æ— nameçš„keep*</h3><p>å¯ä»¥çœ‹åˆ°å‰ä¸‰ä¸ªå®é™…ä¸Šæ˜¯æ¯”åä¸‰ä¸ªå°‘äº†nameçš„ï¼Œä½†æ˜¯æ„ä¹‰å´å¤§ä¸åŒå•Šã€‚å°±ä»¥keepå’ŒkeepNameä¸ºä¾‹å§ï¼Œ<br>keepæ˜¯é˜»æ­¢ç±»å’Œç±»çš„å˜é‡ï¼ˆå®é™…ä¸Šå°±æ˜¯ç±»ä¸­çš„æ–¹æ³•å’Œå˜é‡ï¼‰è¢«å‹ç¼©å’Œæ··æ·†ï¼Œè€Œkeepnamesé‚£ä¹ˆåˆ™æ˜¯åœ¨å‹ç¼©åï¼Œé˜²æ­¢ç±»å’Œç±»çš„æˆå‘˜è¢«æ··æ·†ã€‚æ¢å¥è¯è¯´ï¼Œkeepåœ¨å‹ç¼©ç¬¬ä¸€é“å¤§é—¨æ—¶ï¼Œå°±å·²ç»ç”Ÿæ•ˆï¼Œå¯ä»¥é¿å…è¢«å‹ç¼©æ‰ï¼Œå³ä½¿è¿™ä¸ªç±»æˆ–è€…æˆå‘˜æ²¡æœ‰è¢«ç”¨åˆ°ä¹Ÿä¸ä¼šè¢«ç§»é™¤ï¼Œè€Œkeepnamesåˆ™æ˜¯åœ¨å‹ç¼©åï¼Œä»ä¿ç•™çš„ç±»ä¸­æ¥çœ‹å“ªäº›ç±»å’Œæˆå‘˜ä¸èƒ½è¢«æ··æ·†ï¼Œæ˜¯åœ¨å‹ç¼©åæ‰ç”Ÿæ•ˆã€‚<br>å®˜æ–¹æ–‡æ¡£è§£é‡Šçš„å¾ˆåˆ°ä½ï¼š</p>
<blockquote>
<blockquote>
<blockquote>
<p>Short for -keep,allowshrinking class_specification</p>
</blockquote>
</blockquote>
</blockquote>
<p>å®é™…ä¸ŠåŠ äº†<code>allowshrinking</code>çš„keppå‘½ä»¤ï¼Œå…è®¸å‹ç¼©ã€‚</p>
<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>æ¦‚è¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>keep</td>
<td>é˜»æ­¢ç±»å’Œæˆå‘˜è¢«å’Œæ··æ·†</td>
</tr>
<tr>
<td>keepclassmember</td>
<td>é˜»æ­¢ç±»çš„æˆå‘˜è¢«å’Œæ··æ·†</td>
</tr>
<tr>
<td>keepclasseswithmembers</td>
<td>é˜»æ­¢ç±»å’Œç±»ä¸­ç‰¹å®šçš„æˆå‘˜è¢«å‹ç¼©å’Œæ··æ·†</td>
</tr>
<tr>
<td>keepnames</td>
<td>åœ¨å‹ç¼©åä¿ç•™ä¸‹æ¥çš„ç±»å’Œå…¶æˆå‘˜ä¸­ï¼Œé˜»æ­¢ç±»å’Œç±»çš„æˆå‘˜(é‡Œé¢çš„å˜é‡å’Œæ–¹æ³•éƒ½æ˜¯æˆå‘˜)æ··æ·†</td>
</tr>
<tr>
<td>keepclassmembernames</td>
<td>åœ¨å‹ç¼©åä¿ç•™ä¸‹æ¥çš„ç±»å’Œå…¶æˆå‘˜ä¸­ï¼Œé˜»æ­¢ç±»çš„æˆå‘˜è¢«æ··æ·†</td>
</tr>
<tr>
<td>keepclassmembernames</td>
<td>åœ¨å‹ç¼©åä¿ç•™ä¸‹æ¥çš„ç±»å’Œå…¶æˆå‘˜ä¸­ï¼Œé˜»æ­¢ç±»å’Œç±»ä¸­ç‰¹å®šçš„æˆå‘˜è¢«æ··æ·†</td>
</tr>
</tbody>
</table>
<h3 id="keep-VS-keepclasseswithmembers-1"><a href="#keep-VS-keepclasseswithmembers-1" class="headerlink" title="keep VS keepclasseswithmembers"></a>keep VS keepclasseswithmembers</h3><p>è¿™ä¸¤ä¸ªéƒ½å¯ä»¥æ³¨é‡Šä¿ç•™ä½classåŠå…¶æˆå‘˜ï¼Œä½†æ˜¯äºŒè€…åŒºåˆ†æœ€å¤§ä¹‹å¤„åœ¨äºï¼škeepåªçœ‹åé¢çš„class æ˜¯ä»€ä¹ˆï¼Œä¸å…³å¿ƒåé¢çš„æˆå‘˜ï¼Œè€Œkeepclasseswithmembersåˆ™æ˜¯æ›´å…³å¿ƒåé¢çš„æ¡ä»¶ã€‚å¹²è¯´å¤ªç¡¬ï¼Œæ¥ç‚¹æ¹¿çš„ã€‚<br>å¦‚ä¸‹è§„åˆ™ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-keepclasseswithmembernames <span class="class"><span class="keyword">class</span> <span class="title">me</span>.<span class="title">cyning</span>.* </span>&#123;</div><div class="line">    <span class="keyword">native</span> &lt;methods&gt;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å½“åœ¨me.cyningåŒ…ä¸‹ï¼Œé‡åˆ°æ–¹æ³•ä½“æœ‰nativeæ–¹æ³•æ—¶ï¼Œåˆ™keepå…¶classï¼ŒåŒæ—¶keepè¿™ä¸ªclassçš„nativeçš„æ–¹æ³•ï¼ˆå…¶ä»–æ— ç”¨æ–¹æ³•å¯èƒ½ä¼šè¢«åˆ æ‰æˆ–è€…æ–¹æ³•åä¼šè¢«æ··æ·†ï¼‰ã€‚</p>
<p>è€Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-keep <span class="class"><span class="keyword">class</span> <span class="title">me</span>.<span class="title">cyning</span>.* </span>&#123;</div><div class="line">    <span class="keyword">native</span> &lt;methods&gt;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åˆ™ä¼šå°†classä¸å‹ç¼©</p>
<p>è¿™ä¸ªkeep*å¯ä»¥ä¿è¯ç±»æˆ–è€…æ–¹æ³•ä¸è¢«å‹ç¼©å’Œæ··æ·†ï¼Œè‡³äºé€‰å“ªä¸ªçœ‹ä½ å¿ƒæƒ…å–½ã€‚</p>
<p>## </p>
<h2 id="Class-specifications-1"><a href="#Class-specifications-1" class="headerlink" title="Class specifications"></a>Class specifications</h2><p>åœ¨åˆšæ‰ç¤ºä¾‹ä¸­ï¼Œæœ‰ä¸ªä»£ç ç‰‡æ®µï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-keep <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">google</span>.<span class="title">vending</span>.<span class="title">licensing</span>.<span class="title">ILicensingService</span></span></div></pre></td></tr></table></figure></p>
<p>é€šè¿‡è¿™ä¸€å¥<code>keep</code>äº†<code>com.google.vending.licensing.ILicensingService</code>ï¼Œä½†æ˜¯æˆ‘ä»¬è‹¥æ˜¯<code>keep</code>æŸä¸€ç±»æ—¶è€Œä¸åªæ˜¯ä¸€ä¸ªclassæ—¶ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆåŠï¼Ÿ<br>è¿™å°±éœ€è¦æˆ‘ä»¬å°†è¿™ä¸€ç±»çš„åšä¸ªæŠ½è±¡ï¼Œè€Œå°†è¿™æ‰€æœ‰çš„ç±»éƒ½åˆ—å‡ºæ¥ä¸€ä¸ªä¸ªkeepã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸‹classçš„åŸºæœ¬ç¤ºä¾‹ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[@annotationtype] [[!]public|final|abstract|@ ...] [!]interface|class|enum classname</div><div class="line">    [extends|implements [@annotationtype] classname]</div><div class="line">[&#123;</div><div class="line">    [@annotationtype] [[!]public|private|protected|static|volatile|transient ...] &lt;fields&gt; |</div><div class="line">                                                                      (fieldtype fieldname);</div><div class="line">    [@annotationtype] [[!]public|private|protected|static|synchronized|native|abstract|strictfp ...] &lt;methods&gt; |</div><div class="line">                                                                                           &lt;init&gt;(argumenttype,...) |</div><div class="line">                                                                                           classname(argumenttype,...) |</div><div class="line">                                                                                           (returntype methodname(argumenttype,...));</div><div class="line">    [@annotationtype] [[!]public|private|protected|static ... ] *;</div><div class="line">    ...</div><div class="line">&#125;]</div></pre></td></tr></table></figure></p>
<p>å…ˆæ¥è§£é‡Šä¸‹[]å§ï¼Œè¿™ä¸ªéƒ½æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥é€‰æ‹©æ— ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©[]é‡Œçš„ä¸€ç§æˆ–è€…å¤šç§ã€‚å¦‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@me</span>.cyning.Keep <span class="class"><span class="keyword">class</span> * </span>&#123;</div><div class="line">   <span class="keyword">native</span> &lt;methods&gt;() </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å°±è¡¨ç¤ºæ‰€æœ‰åŠ äº†<code>me.cyning.Keep</code>ç±»æ³¨è§£ä¸”æœ‰nativeæ–¹æ³•çš„ç±»ã€‚<br>å°±è®©æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹<code>Class specifications</code></p>
<ol>
<li>annotationtypeå®é™…ä¸Šå°±æ˜¯ç±»æ³¨è§£ï¼Œå¦‚ä¸Šé¢<code>@me.cyning.Keep</code></li>
<li>class/interface/enum å‰å¯ä»¥æ·»åŠ ä¿®é¥°ç¬¦å¦‚publicï¼Œfinalï¼Œabstractç­‰ä¿®é¥°ç¬¦ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™äº›ä¿®é¥°ç¬¦å‰åŠ !è¡¨ç¤ºå¦å®šï¼Œå¦‚!private éç§æœ‰çš„ï¼›åœ¨class/interface/enumå‰ä¹Ÿå¯ä»¥åŠ !è¡¨ç¤ºå¦å®šï¼Œéƒ½æ˜¯é»‘ç§‘æŠ€å•Š</li>
<li>extends/implements åå¯ä»¥æ·»åŠ æˆ‘ä»¬ç»§æ‰¿æˆ–è€…å®ç°çš„ç±»æˆ–è€…æ¥å£ï¼Œä½†æ˜¯è®°ä½ä¸€å®šè¦å†™å…¨åï¼ˆåŒ…å+classnameï¼‰ã€‚</li>
<li><fields> è¡¨ç¤ºé‡Œé¢çš„å˜é‡ï¼Œä»–çš„å‰é¢å¯ä»¥åŠ å…¥ä¿®é¥°ç¬¦<code>public</code>ã€<code>private</code>ã€<code>protected</code>ã€<code>static</code>ã€<code>volatile</code>ã€<code>transient</code>ç­‰ã€‚</fields></li>
<li><methods>å¯ä»¥è¡¨ç¤ºå‡ºäº†æ„é€ å‡½æ•°å¤–çš„æ–¹æ³•ï¼Œå®ƒå‰é¢ä¹Ÿå¯ä»¥åŠ å…¥<code>public</code>ã€<code>private</code>ã€<code>protected</code>ã€<code>static</code>|<code>synchronized</code>ã€<code>native</code>ã€<code>abstract</code>ã€<code>strictfp</code>ç­‰ä¿®é¥°ç¬¦;è€Œ<init>åˆ™è¡¨ç¤ºæ„é€ å‡½æ•°<br>6.</init></methods></li>
<li>é’ˆå¯¹ä¸€ä¸ªclass/interface/enumä¸‹çš„æ‰€æœ‰æ–¹æ³•æˆ‘ä»¬å¯ä»¥ç”¨<em>æ¥è¡¨ç¤ºå¦‚ `public </em>;`åˆ™è¡¨ç¤ºæ‰€æœ‰ä¿®é¥°ç¬¦ä¸ºpublicçš„æ–¹æ³•å’Œå˜é‡ã€‚</li>
</ol>
<p>é’ˆå¯¹ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜é—æ¼äº†ä¸€ä¸ªå¾ˆé‡çš„ä¸œè¥¿å°±æ˜¯é€šé…ç¬¦ï¼Œå¦‚<em>ï¼Œ*</em>ã€‚è€Œé€šé…ç¬¦åˆåˆ†ä¸ºä»¥ä¸‹ï¼š</p>
<h2 id="packageName-className-methodName-1"><a href="#packageName-className-methodName-1" class="headerlink" title="packageName/className/methodName"></a>packageName/className/methodName</h2><p>åŒ…åæˆ–è€…ç±»åæ˜¯æˆ‘ä»¬å¸¸è§éœ€è¦ç”¨åˆ°çš„ï¼Œæˆ‘ä»¬åˆ—å‡ºæˆ‘ä»¬å¸¸ç”¨çš„é€šé…ç¬¦ã€‚<br>é€šé…ç¬¦ |   æ¦‚è¿°<br>â€”-    | â€”<br>ï¼Ÿ    | è¡¨ç¤ºä»»ä½•ä¸€ä¸ªä»»æ„ä½†ä¸æ˜¯åŒ…åä¸­çš„.åˆ†éš”ç¬¦ã€‚å¦‚<code>me.cyning.Test?</code>å¯ä»¥è¡¨ç¤º<code>me.cyning.Test1</code>å’Œ<code>me.cyning.TestA</code>ï¼Œè€Œä¸èƒ½ä»£è¡¨<code>me.cyning.Test11</code></p>
<ul>
<li>|  è¡¨ç¤ºä»»ä½•å¤šä¸ªå­—ç¬¦ä½†ä¸èƒ½æ˜¯åŒ…åä¸­çš„.åˆ†éš”ç¬¦ã€‚å¦‚<code>me.cyning.Test*</code>å¯ä»¥è¡¨ç¤º<code>me.cyning.Test1</code>å’Œ<code>me.cyning.Test11</code>ï¼Œè€Œä¸èƒ½ä»£è¡¨<code>me.cyning.Test.A</code><br><strong>         | è¡¨ç¤ºä»»ä½•å¤šä¸ªå­—ç¬¦,å¯ä»¥æ˜¯åŒ…åä¸­çš„.åˆ†éš”ç¬¦,å¦‚`me.cyning.</strong><code>å¯ä»¥è¡¨ç¤º</code>me.cyning.Test1<code>å’Œ</code>me.cyning.Test11<code>,ä¹Ÿå¯ä»¥æ˜¯</code>me.cyning.Test.A`</li>
</ul>
<h2 id="ç±»å‹æè¿°-1"><a href="#ç±»å‹æè¿°-1" class="headerlink" title="ç±»å‹æè¿°"></a>ç±»å‹æè¿°</h2><p>åŒ…åæˆ–è€…ç±»åæ˜¯æˆ‘ä»¬å¸¸è§éœ€è¦ç”¨åˆ°çš„ï¼Œæˆ‘ä»¬åˆ—å‡ºæˆ‘ä»¬å¸¸ç”¨çš„é€šé…ç¬¦ã€‚å’Œ<code>packageName/className/methodName</code>æœ‰ç±»ä¼¼ä¹‹å¤„<br>é€šé…ç¬¦ |   æ¦‚è¿°<br>â€”-    | â€”<br>%  | é™¤äº†voidçš„åŸºæœ¬ç±»å‹<br>?  | å•ä¸ªå­—ç¬¦</p>
<ul>
<li>| ä¸åŒ…æ‹¬.åŒ…åˆ†éš”ç¬¦çš„ä»»æ„ç±»åçš„ä¸€éƒ¨åˆ†<br><strong>  | åŒ…æ‹¬.åŒ…åˆ†éš”ç¬¦çš„ä»»æ„ç±»åçš„ä¸€éƒ¨åˆ†<br>*</strong>  | ä»»æ„ç±»å‹<br>â€¦  | å¯è¡¨ç¤ºå¤šä¸ªä»»æ„ä¸”ä»»æ„ç±»å‹çš„ç±»å‹çš„å‚æ•° å¦‚init(â€¦)å¯ä»£è¡¨init(int a, int b) ä¹Ÿå¯ä»¥ä»£è¡¨æ˜¯init(String)<br>ç†Ÿæ‚‰äº†ProGuard Ruleçš„è§„åˆ™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ¥çœ‹æœ€å¼€å§‹æˆ‘ä»¬æåˆ°çš„<a href="https://gist.github.com/ownwell/373860e6468671e8e65c8b9eb849f7c2#file-proguard-android-txt" target="_blank" rel="external">é»˜è®¤çš„ProGuard Rule</a>ã€‚ </li>
</ul>
<p>â€”â€” å»ºè®®è¯»è€…æœ‰æ—¶é—´ç»“åˆä¸Šé¢ä»‹ç»çš„Class specificationså’ŒKeep Optionsï¼Œæ¥é‡æ–°è®¤è¯†å’ŒéªŒè¯ä¸‹ã€‚â€”â€”â€“</p>
<h2 id="è‡ªå®šä¹‰ProGuard-Rule"><a href="#è‡ªå®šä¹‰ProGuard-Rule" class="headerlink" title="è‡ªå®šä¹‰ProGuard Rule)"></a>è‡ªå®šä¹‰ProGuard Rule)</h2><p>æˆ‘ä»¬è¦è‡ªå®šä¹‰çš„ProGuard Ruleï¼Œå…¶å®ä¹Ÿæ˜¯ä¸‰æ­¥èµ°ï¼šåŸºæœ¬Proguard Ruleï¼Œä¸šåŠ¡ä¸­å¸¸è§ä»£ç çš„ProGuard Ruleï¼Œç¬¬ä¸‰æ–¹SDKçš„ProGuard Ruleï¼Œä¸€èˆ¬æƒ…å†µä¸»è¦æŒ‰ç…§ä¸‰æ­¥èµ°ï¼Œå°½é‡åšåˆ°ProGuardæ¶‰åŠåˆ°æˆ‘ä»¬åº”ProGuardä¹‹å¤„ã€‚</p>
<h3 id="åŸºæœ¬Proguard-Rule"><a href="#åŸºæœ¬Proguard-Rule" class="headerlink" title="åŸºæœ¬Proguard Rule"></a>åŸºæœ¬Proguard Rule</h3><p>å¯ä»¥ç›´æ¥å‚è€ƒæˆ‘ä»¬çš„<a href="https://gist.github.com/ownwell/373860e6468671e8e65c8b9eb849f7c2#file-proguard-android-txt" target="_blank" rel="external">é»˜è®¤çš„ProGuard Rule</a>ï¼Œè¿™ä¸ªä¸€èˆ¬ä¸ä¼šæ¶‰åŠåˆ°ä¸šåŠ¡ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶å°¾éƒ¨ç»§ç»­é€‚å½“åŠ å…¥ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"># é¿å…æ··æ·†æ³›å‹ï¼Œè¿™åœ¨JSONå®ä½“æ˜ å°„æ—¶éå¸¸é‡è¦ï¼Œæ¯”å¦‚fastJson</div><div class="line">-keepattributes Signature</div><div class="line"></div><div class="line"># æŠ›å‡ºå¼‚å¸¸æ—¶ä¿ç•™ä»£ç è¡Œå·ï¼Œåœ¨å¼‚å¸¸åˆ†æä¸­å¯ä»¥æ–¹ä¾¿å®šä½</div><div class="line">-keepattributes SourceFile,LineNumberTable</div><div class="line"></div><div class="line"># æŠ›å‡ºå¼‚å¸¸æ—¶ä¿ç•™ä»£ç è¡Œå·ï¼Œåœ¨å¼‚å¸¸åˆ†æä¸­å¯ä»¥æ–¹ä¾¿å®šä½</div><div class="line">-keepattributes SourceFile,LineNumberTable</div><div class="line"></div><div class="line"># ä¿ç•™Serializableåºåˆ—åŒ–çš„ç±»ä¸è¢«æ··æ·†</div><div class="line">-keepclassmembers class * implements java.io.Serializable &#123;</div><div class="line">    static final long serialVersionUID;</div><div class="line">    private static final java.io.ObjectStreamField[] serialPersistentFields;</div><div class="line">    private void writeObject(java.io.ObjectOutputStream);</div><div class="line">    private void readObject(java.io.ObjectInputStream);</div><div class="line">    java.lang.Object writeReplace();</div><div class="line">    java.lang.Object readResolve();</div><div class="line">&#125;</div><div class="line"></div><div class="line"># å¯¹äºRï¼ˆèµ„æºï¼‰ä¸‹çš„æ‰€æœ‰ç±»åŠå…¶æ–¹æ³•ï¼Œéƒ½ä¸èƒ½è¢«æ··æ·†</div><div class="line">-keep class **.R$* &#123;</div><div class="line">    *;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªå¤§å®¶æ˜¯ä¸æ˜¯åŸºæœ¬ä¸Šæ˜¯æˆ‘ä»¬æœ€æœ€å¸¸è§çš„ï¼Œä¸æ˜¯ä¸€å®šå¦‚æ­¤ï¼Œè¿™ä¸ªæ˜¯ä¸ªäººè§‚ç‚¹ï¼Œä»…ä¾›å‚è€ƒä½¿ç”¨ã€‚</p>
<h3 id="ä¸šåŠ¡å¸¸è§"><a href="#ä¸šåŠ¡å¸¸è§" class="headerlink" title="ä¸šåŠ¡å¸¸è§"></a>ä¸šåŠ¡å¸¸è§</h3><p>è¿™ä¸ªéœ€è¦ç»“åˆè‡ªå·±çš„ä¸šåŠ¡æ¥åšï¼Œæˆ–è€…æ¥çœ‹ï¼Œä¾‹å¦‚æˆ‘çš„ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">#</div><div class="line"> ä¿ç•™å®ä½“ç±»å’Œæˆå‘˜ä¸è¢«æ··æ·†</div><div class="line">-keep public class com.xxxx.entity.** &#123;</div><div class="line">    public void set*(***);</div><div class="line">    public *** get*();</div><div class="line">    public *** is*();</div><div class="line">&#125;</div><div class="line">ä¸€</div><div class="line"></div><div class="line"></div><div class="line"># å¯¹WebViewçš„å¤„ç†</div><div class="line">-keepclassmembers class * extends android.webkit.webViewClient &#123;</div><div class="line">    public void *(android.webkit.WebView, java.lang.String, android.graphics.Bitmap);</div><div class="line">    public boolean *(android.webkit.WebView, java.lang.String)</div><div class="line">&#125;</div><div class="line">-keepclassmembers class * extends android.webkit.webViewClient &#123;</div><div class="line">    public void *(android.webkit.webView, java.lang.String)</div><div class="line">&#125;</div><div class="line"># ä¿ç•™JSæ–¹æ³•ä¸è¢«æ··æ·†</div><div class="line">-keepclassmembers class com.example.xxx.MainActivity$JSInterface1 &#123;</div><div class="line">    &lt;methods&gt;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#  åå°„ä¸­ç”¨åˆ°çš„ç±»æˆ–è€…æ–¹æ³•</div><div class="line"></div><div class="line"></div><div class="line">### ç¬¬ä¸‰æ–¹åº“</div><div class="line">ä¸€ä¸ªä¼˜ç§€çš„å¼€æºåº“ï¼Œä¸€èˆ¬ä¼šæä¾›æˆ‘ä»¬ProGuard Ruleï¼Œéƒ½è¯´å•¦æ˜¯ä¸€ç­å•¦ï¼ŒäºŒç­çš„åŒå­¦è¿˜æ˜¯éœ€è¦æ ¹æ®æºä»£ç æ¥è‡ªå·±ä¸ºå¼€æºåº“æ·»åŠ ProGuard Ruleã€‚</div><div class="line"></div><div class="line">```java</div><div class="line">-keep class android.support.v4.**  &#123; *; &#125;</div><div class="line">-keep interface android.support.v4.app.** &#123; *; &#125;</div><div class="line">-keep public class * extends android.support.v4.**</div><div class="line">-keep public class * extends android.app.Fragment</div><div class="line"></div><div class="line">-dontwarn com.alipay.android.app.**</div><div class="line">-keep public class com.alipay.**  &#123; *; &#125;</div></pre></td></tr></table></figure></p>
<p>ç½‘ä¸Šæœ‰é›·é”‹å¸®æˆ‘ä»¬å‡†å¤‡äº†ä¸€ä»½ï¼š<a href="https://github.com/msdx/android-proguard-cn" target="_blank" rel="external">msdx/android-proguard-cn</a>,æ‹¿èµ°ä¸è°¢ã€‚</p>
<h1 id="å½©è›‹"><a href="#å½©è›‹" class="headerlink" title="å½©è›‹"></a>å½©è›‹</h1><p>ä¹‹å‰çœ‹èµµå››å¤§å“¥çš„ä¸€ç¯‡æ–‡ç« ï¼Œ<a href="http://www.wjdiankong.cn/android%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E4%B9%8B%E6%97%85-%E5%B8%A6%E4%BD%A0%E6%8A%8Aapk%E6%B7%B7%E6%B7%86%E6%88%90%E4%B8%AD%E6%96%87%E8%AF%AD%E8%A8%80%E4%BB%A3%E7%A0%81/" target="_blank" rel="external">Androidå®‰å…¨é˜²æŠ¤ä¹‹æ—…â€”å¸¦ä½ æŠŠApkæ··æ·†æˆä¸­æ–‡è¯­è¨€ä»£ç 
</a>,å®ƒä»æºç ä¸Šåšäº†å¤„ç†ï¼Œä¸è¿‡è¿™ä¸ªä¸æ˜¯æˆ‘æœŸæœ›çš„ï¼Œåæ¥å±…ç„¶å‘ç°ï¼ŒProGuardå±…ç„¶çœŸçš„å¯ä»¥è®¾ç½®mappdingçš„å­—å…¸ï¼š<br>-obfuscationdictionary naruto.txt<br>narutoå·²ç»ä¸Šä¼ åˆ°<a href="https://gist.github.com/ownwell/2dc6486b4cdda3ab556859c1d63045d3" target="_blank" rel="external">gitgist</a>å•¦.<br>æ‰“å¼€æœ‰æƒŠå–œå“¦ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¯¹äºä¸€ä¸ªæœ‰ç»éªŒçš„ç¨‹åºå‘˜ï¼ŒProGuardå¤§å®¶ä¸€å®šä¸é™Œç”Ÿï¼Œæœ‰äººè¯´ä»–æ˜¯æ··æ·†ï¼Œæˆ‘å¿…é¡»çº æ­£ï¼Œæ··æ·†åªæ˜¯ProGuardçš„ä¸€ä¸ªè¿‡ç¨‹(æˆ‘ä¸ä¼šç§°ProGuardä¸ºæ··æ·†ï¼ŒProGuardå°±æ˜¯ProGuardï¼Œè°å†è¯´ProGuardæ‰æ˜¯çœŸæ­£çš„æ··æ·†è§†å¬ï¼Œä¸‹é¢æœ‰è§£é‡Š).&lt;br&gt;ProGuardå…¶å®
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Androidçš„APKä¸¤ç§ç­¾å</title>
    <link href="http://ownwell.github.io/2017/10/13/apk-two-signer/"/>
    <id>http://ownwell.github.io/2017/10/13/apk-two-signer/</id>
    <published>2017-10-12T16:24:48.000Z</published>
    <updated>2017-10-12T16:36:26.450Z</updated>
    
    <content type="html"><![CDATA[<p>å‰å‡ å¤©åœ¨ç ”ç©¶APKç˜¦èº«çš„ç›¸å…³çŸ¥è¯†ï¼Œå‘ç°æœ‰ä¸ªå¾ˆæœ‰æ„æ€çš„çŸ¥è¯†ç‚¹å°±æ˜¯apkçš„ç­¾å â€“ APK Signature Scheme v2ï¼Œè™½ç„¶å‡ºæ¥äº†ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯è¿™æ–¹ä¾¿çœŸæ˜¯æ²¡åšå¤ªå¤šçš„å…³æ³¨ï¼Œè¶ç€åä¸€åˆšè¿‡çš„çƒ­ä¹åŠ²æ’¸èµ·è¢–å­å¹²ä¸€æ³¢ã€‚</p>
<h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><p>ç›®å‰ä¸ºæ­¢ï¼Œandroidé€šç”¨çš„æ‰“åŒ…è¿‡ç¨‹æ—¶ä½¿ç”¨çš„ç­¾åå·¥å…·æœ‰ä¸¤å¥—â€“jarsignerå’Œapksignerã€‚å…¶ä¸­apksignerä¹Ÿå°±æ˜¯åˆšæ‰æˆ‘ä»¬æåˆ°çš„APK Signature Scheme v2ï¼Œä¸¤è€…æœ‰ä»€ä¹ˆå…³ç³»ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ–°çš„ç­¾åæœºåˆ¶å‘¢ï¼Ÿè¿™æ˜¯æˆ‘ä»¬è¿™ç¯‡æ–‡ç« ä»‹ç»çš„é‡ç‚¹ã€‚</p>
<p>åœ¨äº†è§£ç­¾åä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li>æ•°å­—ç­¾å</li>
<li>ZipAlign</li>
<li>keystore</li>
</ul>
<h2 id="æ•°å­—ç­¾å-â€“-Signature"><a href="#æ•°å­—ç­¾å-â€“-Signature" class="headerlink" title="æ•°å­—ç­¾å â€“ Signature"></a>æ•°å­—ç­¾å â€“ Signature</h2><ul>
<li>æ•°å­—ç­¾åå°±æ˜¯ä¿¡æ¯çš„å‘é€è€…ç”¨è‡ªå·±çš„ç§é’¥å¯¹æ¶ˆæ¯æ‘˜è¦åŠ å¯†äº§ç”Ÿä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŠ å¯†ç®—æ³•ç¡®ä¿åˆ«äººæ— æ³•ä¼ªé€ ç”Ÿæˆè¿™æ®µå­—ç¬¦ä¸²ï¼Œè¿™æ®µæ•°å­—ä¸²ä¹Ÿæ˜¯å¯¹ä¿¡æ¯çš„å‘é€è€…å‘é€ä¿¡æ¯çœŸå®æ€§çš„ä¸€ä¸ªæœ‰æ•ˆè¯æ˜ã€‚</li>
<li>æ•°å­—ç­¾åæ˜¯ éå¯¹ç§°å¯†é’¥åŠ å¯†æŠ€æœ¯ + æ•°å­—æ‘˜è¦æŠ€æœ¯ çš„ç»“åˆã€‚</li>
<li>æ•°å­—ç­¾åæŠ€æœ¯æ˜¯å°†ä¿¡æ¯æ‘˜è¦ç”¨å‘é€è€…çš„ç§é’¥åŠ å¯†ï¼Œä¸åŸæ–‡ä¸€èµ·ä¼ é€ç»™æ¥æ”¶è€…ã€‚æ¥æ”¶è€…åªæœ‰ç”¨å‘é€è€…çš„å…¬é’¥æ‰èƒ½è§£å¯†è¢«åŠ å¯†çš„ä¿¡æ¯æ‘˜è¦ï¼Œç„¶åæ¥æ”¶è€…ç”¨ç›¸åŒçš„Hashå‡½æ•°å¯¹æ”¶åˆ°çš„åŸæ–‡äº§ç”Ÿä¸€ä¸ªä¿¡æ¯æ‘˜è¦ï¼Œä¸è§£å¯†çš„ä¿¡æ¯æ‘˜è¦åšæ¯”å¯¹ã€‚å¦‚æœç›¸åŒï¼Œåˆ™è¯´æ˜æ”¶åˆ°çš„ä¿¡æ¯æ˜¯å®Œæ•´çš„ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ä¿®æ”¹ï¼›ä¸åŒåˆ™è¯´æ˜ä¿¡æ¯è¢«ä¿®æ”¹è¿‡ï¼Œå› æ­¤æ•°å­—ç­¾åèƒ½ä¿è¯ä¿¡æ¯çš„å®Œæ•´æ€§ã€‚å¹¶ä¸”ç”±äºåªæœ‰å‘é€è€…æ‰æœ‰åŠ å¯†æ‘˜è¦çš„ç§é’¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç¡®å®šä¿¡æ¯ä¸€å®šæ˜¯å‘é€è€…å‘é€çš„ã€‚<br>æˆ‘ä»¬çš„APKå°±æ˜¯é€šè¿‡è¿™ç§æ•°å­—ç­¾åæŠ€æœ¯ä¿è¯æˆ‘ä»¬APKçš„å®‰å…¨ã€‚</li>
</ul>
<h2 id="ZipAlign"><a href="#ZipAlign" class="headerlink" title="ZipAlign"></a>ZipAlign</h2><p>zipå¯¹é½ï¼Œå› ä¸ºAPKåŒ…çš„æœ¬è´¨æ˜¯ä¸€ä¸ªzipå‹ç¼©æ–‡æ¡£ï¼Œç»è¿‡è¾¹ç•Œå¯¹é½æ–¹å¼ä¼˜åŒ–èƒ½ä½¿åŒ…å†…æœªå‹ç¼©çš„æ•°æ®æœ‰åºçš„æ’åˆ—ï¼Œä»è€Œå‡å°‘åº”ç”¨ç¨‹åºè¿è¡Œæ—¶çš„å†…å­˜æ¶ˆè€— ï¼Œé€šè¿‡ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼æé«˜æ‰§è¡Œæ•ˆç‡ï¼ˆzipalignåçš„apkåŒ…ä½“ç§¯å¢å¤§äº†90KBå·¦å³ï¼‰ã€‚</p>
<p>åˆ‡æ¢ç›®å½•åˆ°SDKçš„build-toolsç›®å½•ä¸‹ï¼ˆä¾‹å¦‚ SDK/build-tools/25.0.2/ï¼‰ï¼Œæ‰§è¡Œï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zipalign -v <span class="number">4</span> infile.apk outfile.apk</div></pre></td></tr></table></figure></p>
<h2 id="keystore"><a href="#keystore" class="headerlink" title="keystore"></a>keystore</h2><p> keystoreæ˜¯æˆ‘ä»¬æ‰“åŒ…è¿‡ç¨‹ä¸­å¿…é¡»è¦å¡«å†™çš„å†…å®¹ï¼Œè¿™ä¸ªç±»ä¼¼æˆ‘ä»¬ä»£è¡¨æˆ‘ä»¬å¼€å‘è€…ä¿¡æ¯çš„ä¸€ä¸ªã€è¯ä¹¦ã€ï¼Œè¿™ä¸ªè¯ä¹¦ç±»ä¼¼å¼€å‘è€…çš„â€èº«ä»½è¯â€,å®ƒæ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥åªè¦ä¸€ä¸ªappæœ‰è¿™ä¸ªè¯ä¹¦ï¼Œåœ¨åº”ç”¨å¸‚åœºä¸Šå°±å¯ä»¥ä¿è¯è¿™ä¸ªappä¸ä¼šè¢«åˆ«äººå†’å……ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªå¼€å‘è€…çš„å‡­è¯ï¼ˆåªè¦keystoreçš„å¯†ç è´¦å·ä¸è¢«æ³„éœ²ï¼‰ã€‚<br> å…·ä½“å†…å®¹å¯ä»¥å‚è€ƒï¼š<a href="http://www.jianshu.com/p/644ddb6e3d9c" target="_blank" rel="external">Android Keystoreæ¼«è°ˆ</a>.<br> æˆ‘ä»¬å¯ä»¥é€šè¿‡jdk/bin/ä¸‹çš„keytoolå·¥å…·æ¥åˆ›å»ºè‡ªå·±çš„keystoreï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -genkeypair -alias &quot;cyning&quot; -keyalg &quot;RSA&quot; -keystore &quot;cyningfile.keystore&quot;</div></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ªåˆ«åä¸ºcyningçš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦å­˜æ”¾åœ¨åä¸ºcyningfile.keystoreçš„å¯†é’¥åº“ä¸­ï¼Œè‹¥cyningfile.keystoreå¯†é’¥åº“ä¸å­˜åœ¨åˆ™åˆ›å»ºã€‚<br>ç°åœ¨æ›´å¤šäººæ˜¯é€šè¿‡Android Studioçš„å·¥å…·æ¥åˆ›å»ºè‡ªå·±çš„keystoreã€‚</p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<p>-genkeypairï¼šç”Ÿæˆä¸€å¯¹éå¯¹ç§°å¯†é’¥;<br>-aliasï¼šæŒ‡å®šå¯†é’¥å¯¹çš„åˆ«åï¼Œè¯¥åˆ«åæ˜¯å…¬å¼€çš„;<br>-keyalgï¼šæŒ‡å®šåŠ å¯†ç®—æ³•ï¼Œæœ¬ä¾‹ä¸­çš„é‡‡ç”¨é€šç”¨çš„RASåŠ å¯†ç®—æ³•;<br>-keystore:å¯†é’¥åº“çš„è·¯å¾„åŠåç§°ï¼Œä¸æŒ‡å®šçš„è¯ï¼Œé»˜è®¤åœ¨æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªâ€.keystoreâ€çš„æ–‡ä»¶</p>
<p>æŸ¥çœ‹è¿™ä¸ªkeystoreï¼š<br>keytool -list -keystore cyningfile.keystore</p>
<h1 id="APKçš„ç­¾å"><a href="#APKçš„ç­¾å" class="headerlink" title="APKçš„ç­¾å"></a>APKçš„ç­¾å</h1><p>åœ¨V2ç­¾åå‡ºæ¥ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡<code>jarsigner</code>ç­¾åï¼Œè€Œåæ‰æœ‰<code>APK Signature Scheme v2</code>.ä»–ä»¬æœ‰å¾ˆå¤§çš„ä¸åŒã€‚</p>
<h2 id="META-INFä¸‹ç­¾åä¸‰å…„å¼Ÿ"><a href="#META-INFä¸‹ç­¾åä¸‰å…„å¼Ÿ" class="headerlink" title="META-INFä¸‹ç­¾åä¸‰å…„å¼Ÿ"></a>META-INFä¸‹ç­¾åä¸‰å…„å¼Ÿ</h2><p>æ‰€è°“ç­¾åä¸‰å…„å¼Ÿï¼Œå®é™…ä¸Šå°±æ˜¯META-INFæ–‡ä»¶å¤¹ä¸‹çš„MANIFEST.MFã€CERT.SFã€CERT.RSAä¸‰ä¸ªæ–‡ä»¶ã€‚<br>å®ƒä¼šå…ˆé€šè¿‡SHA1ç®—æ³•ç”Ÿæˆè¿™äº›æ–‡ä»¶ï¼ˆpngï¼Œdexç­‰ï¼‰çš„ä¿¡æ¯æ‘˜è¦ï¼Œè€Œåä¼šç”Ÿäº§MANIFEST.MFã€‚</p>
<h1 id="jarsigner"><a href="#jarsigner" class="headerlink" title="jarsigner"></a>jarsigner</h1><p>jarsigneræ˜¯ç”±JDKæä¾›çš„ä¸€ä¸ªç­¾åå·¥å…·ï¼ŒJDK/bin/jarsigner(jarsignerï¼Œwindowsä¸Šæ˜¯exeæ–‡ä»¶).<br>é€šè¿‡è¿™ä¸ªå·¥å…·ä¹Ÿå¯ä»¥ç»™æˆ‘ä»¬çš„APKè¿›è¡Œç­¾åï¼Œåœ¨<code>APK Signature Scheme v2</code>å‡ºæ¥ä¹‹å‰éƒ½æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jarsigner -verbose -keystore test.keystore -signedjar -signed.apk unsigned.apk <span class="string">'test.keystore'</span></div></pre></td></tr></table></figure></p>
<p>å¯¹ç…§ç­¾åå‰åï¼ŒMETA-INFOæ–‡ä»¶çš„å˜åŒ–ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2017/10/10/a86b4f21d90cbf54c181caf6bcbfd860" alt="ç­¾åå‰"><br><img src="https://user-gold-cdn.xitu.io/2017/10/10/8c2f51b4135469231ec206fb8a724128" alt="ç­¾åå"></p>
<p>å°±ä¼šå‘ç°ç­¾ååå¤šäº†ä¸¤ä¸ªæ–‡ä»¶CERT.SFã€CERT.RSAï¼ŒåŒæ—¶MANIFEST.MFä¼šå¤šäº†æ–‡ä»¶å’Œå¯¹åº”çš„SHA1ç®—æ³•ä¸‹çš„æ‘˜è¦ã€‚<br>MFå®é™…ä¸Šä¼šåˆ—å‡ºæ–‡ä»¶è§£å‹åçš„æ‰€æœ‰æ–‡ä»¶é™¤äº†META-INFä¸‹æ‰€æœ‰æ–‡ä»¶çš„ç­¾åã€‚<br>SFåˆ™æ˜¯MFæ–‡ä»¶çš„æ‘˜è¦ä¿¡æ¯ä»¥åŠ.MFæ–‡ä»¶å½“ä¸­æ¯ä¸ªæ¡ç›®åœ¨ç”¨æ‘˜è¦ç®—æ³•è®¡ç®—å¾—åˆ°çš„æ‘˜è¦ä¿¡æ¯å¹¶ç”¨base64ç¼–ç ä¿å­˜ï¼›CERT.SFæ–‡ä»¶åˆ™å­˜æ”¾è¯ä¹¦ä¿¡æ¯ï¼Œå…¬é’¥ä¿¡æ¯ï¼Œä»¥åŠç”¨ç§é’¥å¯¹.SFæ–‡ä»¶çš„åŠ å¯†æ•°æ®å³ç­¾åä¿¡æ¯ï¼Œè¿™æ ·ä¿è¯äº†æ¯ä¸ªæ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œä½†éƒ½æ˜¯åŸºäºapkè§£å‹åçš„æ‰€æœ‰æ–‡ä»¶ã€‚</p>
<p>åœ¨å®‰è£…APKæ—¶ï¼Œä¼šå…ˆæ£€æŸ¥CERT.SFæ–‡ä»¶ï¼Œç¡®è®¤ç­¾åæ­£ç¡®ï¼Œè€Œåæ£€æŸ¥SFæ–‡ä»¶ï¼Œå†é€šè¿‡SFå»æ£€æŸ¥apkæ–‡ä»¶ä¸‹å„ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·ä¸€æ­¥æ­¥ç¯ç¯ç›¸æ‰£ç¡®ä¿äº†æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œç¡®ä¿äº†æ–‡ä»¶çš„å®Œæ•´å’Œå®‰å…¨æ€§ï¼Œä½†æ˜¯å¯¹äºå¥½äº‹è€…è¿˜æ˜¯å‘ç°äº†å…¶ä¸­çš„æ¼æ´ï¼Œç¾å›¢æœ‰ä¸ªæ–¹æ¡ˆå°±æ˜¯é€šè¿‡åœ¨META-INFä¸‹æ·»åŠ ä¸€ä¸ªç©ºæ–‡ä»¶æ¥ä»£è¡¨æ¸ é“ï¼Œè¿™ä¸ªç©ºæ–‡ä»¶ä¸ä¼šè¢«æ£€æŸ¥ï¼Œä»–å’Œä»»ä½•æ–‡ä»¶æ²¡æœ‰å…³è”ï¼ˆCERT.SFã€CERT.RSAå’ŒMANIFEST.MFä»–ä»¬æ˜¯ç›¸å…³å…³è”çš„ï¼‰ã€‚</p>
<p>è¿™æ ·æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä»€ä¹ˆå¯¹äºapkæ–‡ä»¶ZipAlignå¤„ç†åä»–ä»¬çš„å‹ç¼©äº§ç‰©æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥åœ¨å®‰è£…apkæ—¶ï¼Œä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ï¼Œä½†æ˜¯è¿™æ ·çœŸçš„å®‰å…¨ä¹ˆï¼Ÿ<br>ç­”æ¡ˆæ˜¯å¦ï¼<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›ä¸æ£€æµ‹æ–‡ä»¶ä¸­å­˜æ”¾ä¸å®‰å…¨çš„ä»£ç ï¼ŒåŒæ—¶æ¯æ¬¡å®‰è£…apkéƒ½éœ€è¦è§£å‹apkæ–‡ä»¶æ¥è¿›è¡Œæ ¡éªŒï¼Œè€—æ—¶ï¼Œä¹Ÿæ˜¯ä¸ªè€—ç”µçš„è¿‡ç¨‹ã€‚</p>
<p>äºæ˜¯ä¹ï¼Œåœ¨Android Build Toolsä»24.0.3ç‰ˆæœ¬å¼•å…¥çš„ä¸€ä¸ªæ–°çš„apkæ–‡ä»¶ç­¾åå·¥å…·apksignerï¼Œä¹Ÿå°±æ˜¯googleå®˜ç½‘ä¸Šè¯´çš„<br><a href="https://source.android.com/security/apksigning/v2" target="_blank" rel="external"><code>Signature Scheme v2</code>ç¿»è¯‘è¿‡æ¥è¿‡æ¥å°±æ˜¯APKç­¾åæ–¹æ¡ˆv2</a>.</p>
<h1 id="apksigner"><a href="#apksigner" class="headerlink" title="apksigner"></a>apksigner</h1><p>apksigneræ˜¯åŸºäºçœŸä¸ªapkäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ ¡éªŒçš„ï¼Œå³ä½¿ä½ ä½¿ç”¨äº†ZipAlignå¯¹é½åï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶å‘ç”Ÿäº†æ”¹å˜ï¼Œå°±è®¤ä¸ºä¸¤ä¸ªapkä¸ä¸€æ ·,å®é™…ä¸Šä¹Ÿå°±æ˜¯ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶ã€‚<br>å®˜æ–¹è§£é‡Šæ˜¯åœ¨apkæ–‡ä»¶çš„Central Directoryå‰é¢æ’å…¥äº†ä¸€ä¸ªapkç­¾åå—ç”¨æ¥å­˜æ”¾apkçš„ç­¾åä¿¡æ¯ï¼Œæ¥ç¡®ä¿apkç­¾åçš„å®‰å…¨æ€§ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2017/10/12/dd03318efe8ad982b36db9e8d8516644" alt=""></p>
<p>è¿™æ ·apkå°±ç­‰äºæ˜¯æ˜¯æœ‰äº†å››å—ï¼š<br><img src="https://user-gold-cdn.xitu.io/2017/10/12/2bfa5ef2448e40a17f54fcf19db4e489" alt=""></p>
<blockquote>
<p>googleå»ºè®®ï¼š APK ç­¾åæ–¹æ¡ˆ v2 æ˜¯åœ¨ Android 7.0 (Nougat) ä¸­å¼•å…¥çš„ã€‚ä¸ºäº†ä½¿ APK å¯åœ¨ Android 6.0 (Marshmallow) åŠæ›´ä½ç‰ˆæœ¬çš„è®¾å¤‡ä¸Šå®‰è£…ï¼Œåº”å…ˆä½¿ç”¨ JAR ç­¾ååŠŸèƒ½å¯¹ APK è¿›è¡Œç­¾åï¼Œç„¶åå†ä½¿ç”¨ v2 æ–¹æ¡ˆå¯¹å…¶è¿›è¡Œç­¾åã€‚<br>åœ¨android studioçš„Gradle Plugin 2.2ä»¥åŠä¹‹ä¸Šç‰ˆæœ¬çš„æ’ä»¶å½“ä¸­ï¼Œé»˜è®¤æ˜¯v2å¼€å¯çš„,éœ€è¦çš„è¯å¯ä»¥è‡ªå®šä¹‰å…³æˆ–è€…å¼€ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">signConfig &#123;</div><div class="line">    v1SigningEnabled <span class="keyword">false</span></div><div class="line">    v2SigningEnabled <span class="keyword">false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<p>å…¶ä¸­apkç­¾åå—ä¹Ÿæ˜¯ä¸ªçš„ç»“æ„å¦‚ä¸‹ï¼š<br><img src="https://user-gold-cdn.xitu.io/2017/10/12/6127028bd1d01f848712035120ff9855" alt="apkç­¾åå—"><br>ç¾å›¢åˆä¸€æ¬¡åˆ©ç”¨äº†è§„åˆ™ï¼Œåœ¨ID-Valueçš„åŠ å…¥ä¸€ä¸ªæ¸ é“ID-Value(apkä¸ä¼šæ ¡éªŒidï¼Œvalueçš„æœ‰æ•ˆæ€§)ã€‚<br>å…¶æ–‡ç« æ€è·¯å‚è€ƒï¼š<a href="https://tech.meituan.com/android-apk-v2-signature-scheme.html" target="_blank" rel="external">æ–°ä¸€ä»£å¼€æºAndroidæ¸ é“åŒ…ç”Ÿæˆå·¥å…·Walle
</a>.</p>
<p>æ‰€ä»¥ï¼Œå’Œjarsignç›¸æ¯”ï¼Œapksignç­¾åæ›´å®‰å…¨ï¼Œå…¶æ‰“åŒ…ç”Ÿæˆçš„apkä¹Ÿæ›´å°,èµ¶å¿«åŠ¨æ‰‹è¯•è¯•å§ã€‚<br>ä½¿ç”¨ä¹ˆå°±å¾ˆç®€å•å•¦ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">apksigner sign --ks keystore.jks |</div><div class="line">  --key key.pk8 --cert cert.x509.pem</div><div class="line">  [signer_options] app-name.apk</div></pre></td></tr></table></figure></p>
<p>æ›´å¤šå·¥å…·å¯ä»¥å‚è€ƒ<a href="https://developer.android.com/studio/command-line/apksigner.html" target="_blank" rel="external">è°·æ­Œå®˜æ–¹æ–‡æ¡£</a>.<br>æ€»ç»“ä¸‹ï¼šjarsignerç­¾åæ˜¯jdkæä¾›çš„ç­¾åå·¥å…·ï¼Œå®ƒæ˜¯é’ˆå¯¹apkæ–‡ä»¶å‹ç¼©åçš„æ–‡ä»¶è¿›è¡Œçš„å®Œæ•´å’Œå®‰å…¨æ€§æ ¡éªŒï¼Œè€Œapksignä¹Ÿæ˜¯é€šè¿‡å¯¹apkäºŒè¿›åˆ¶æ–‡ä»¶çš„æ ¡éªŒï¼Œä¹Ÿæ›´å®‰å…¨ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰å‡ å¤©åœ¨ç ”ç©¶APKç˜¦èº«çš„ç›¸å…³çŸ¥è¯†ï¼Œå‘ç°æœ‰ä¸ªå¾ˆæœ‰æ„æ€çš„çŸ¥è¯†ç‚¹å°±æ˜¯apkçš„ç­¾å â€“ APK Signature Scheme v2ï¼Œè™½ç„¶å‡ºæ¥äº†ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯è¿™æ–¹ä¾¿çœŸæ˜¯æ²¡åšå¤ªå¤šçš„å…³æ³¨ï¼Œè¶ç€åä¸€åˆšè¿‡çš„çƒ­ä¹åŠ²æ’¸èµ·è¢–å­å¹²ä¸€æ³¢ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å‡†å¤‡&quot;&gt;&lt;a href=&quot;#å‡†å¤‡&quot;
    
    </summary>
    
      <category term="Android" scheme="http://ownwell.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://ownwell.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>æ³¨è§£åœ¨Androidå¼€å‘ä¸­çš„ä½¿ç”¨ï¼ˆ1ï¼‰</title>
    <link href="http://ownwell.github.io/2017/08/08/annotation-for-andrroid-one/"/>
    <id>http://ownwell.github.io/2017/08/08/annotation-for-andrroid-one/</id>
    <published>2017-08-08T13:58:07.000Z</published>
    <updated>2017-08-08T15:00:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä½œä¸ºä¸€ä¸ªAndroidç¨‹åºå‘˜ï¼Œæ³¨è§£ï¼ˆAnnotationï¼‰ä¼šæ˜¯ä¸€ä¸ªè®©æˆ‘ä»¬äº‹åŠåŠŸå€çš„ä¸€ä¸ªå¼€å‘åˆ©å™¨ï¼Œå®ƒå¯ä»¥ç®€åŒ–ä»£ç ï¼ˆå¦‚ButterKnifeï¼‰ï¼Œå¯ä»¥çº¦æŸè¾“å…¥æ¡ä»¶ï¼ˆå¦‚support-annotationsï¼‰ï¼Œå¯ä»¥å°†è¾“å…¥æ¡ä»¶æ”¹ä¸ºé…ç½®ï¼ˆå¦‚Retrofit 2.0ï¼‰ç­‰ï¼Œå°±è®©æˆ‘ä»¬å¼€ä¸‹æ³¨è§£åœ¨æ³¨è§£åœ¨Androidå¼€å‘ä¸­æ˜¯æ€ä¹ˆä½¿ç”¨ã€‚</p>
<p>ä¸ºäº†å®¹æ˜“è®©å¤§å®¶ç†è§£ä»€ä¹ˆæ˜¯æ³¨è§£ï¼Œæ–‡ç« ä¼šåˆ†ä¸ºåˆ†ä¸ºä»¥ä¸‹ä¸¤ç¯‡æ¥åˆ†åˆ«ä»‹ç»ï¼š</p>
<ul>
<li>æ³¨è§£çš„åŸºæœ¬æ¦‚å¿µä»¥åŠè‡ªå®šä¹‰æ³¨è§£</li>
<li>æ¨¡ä»¿ButterKnife</li>
</ul>
<h1 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h1><p>ä»Šå¤©æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è·å–åˆ°å®ƒçš„å€¼ã€‚</p>
<p>â€” ä»£ç 1ï¼šâ€”<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="meta">@BindView</span>(R.id.btnTest)</div><div class="line">    Button btnTest;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h1><p>Java1.5å¼•å…¥äº†æ³¨è§£ï¼Œå½“å‰è®¸å¤šæ¡†æ¶ä¸­å¤§é‡ä½¿ç”¨æ³¨è§£ï¼Œå¦‚Springã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰æ³¨è§£æ¥ï¼Œ è¿™äº›æ³¨è§£ä¼šåœ¨ç¼–è¯‘è¿‡ç¨‹æˆ–æ‰§è¡Œæ—¶äº§ç”Ÿä½œç”¨ã€‚</p>
<p>å¦‚ä¸Šé¢çš„ä»£ç ä¸­<code>@BindView</code>å°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æ³¨è§£ï¼Œæˆ‘ä¹ˆéœ€è¦åœ¨ä½¿ç”¨å‰å…ˆå£°æ˜ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="meta">@Target</span>(ElementType.FIELD)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> BindView &#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">value</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>é¦–å…ˆBindViewè¿™ä¸æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå› ä¸ºå®ƒçš„å£°æ˜æ˜¯<code>@interface</code>,å…¶æ¬¡å®ƒçš„å®šä¹‰éœ€è¦ç”¨åˆ°<code>Retention</code>å’Œ<code>Target</code>è¿™ä¸¤ä¸ªå…ƒæ³¨è§£ã€‚</p>
<h2 id="å…ƒæ³¨è§£"><a href="#å…ƒæ³¨è§£" class="headerlink" title="å…ƒæ³¨è§£"></a>å…ƒæ³¨è§£</h2><p>å…ƒæ³¨è§£çš„ä½œç”¨å°±æ˜¯è´Ÿè´£æ³¨è§£å…¶ä»–æ³¨è§£ã€‚Java5.0å®šä¹‰äº†4ä¸ªæ ‡å‡†çš„meta-annotationç±»å‹ï¼Œå®ƒä»¬è¢«ç”¨æ¥æä¾›å¯¹å…¶å®ƒ annotationç±»å‹ä½œè¯´æ˜ã€‚Java5.0å®šä¹‰çš„å…ƒæ³¨è§£ï¼š</p>
<ul>
<li>@Target,</li>
<li>@Retention,</li>
<li>@Documented,</li>
<li>@Inherited</li>
</ul>
<h3 id="Target"><a href="#Target" class="headerlink" title="@Target"></a>@Target</h3><p>@Targetä¸»è¦æ˜¯æè¿°æ³¨è§£çš„èŒƒå›´ï¼Œå¦‚åŒ…ï¼Œç±»ï¼Œå˜é‡ç­‰ï¼Œåƒä»£ç 1ä¸­çš„BindViewæ˜¯å£°æ˜åœ¨å˜é‡ä¸Šï¼Œä¸‹é¢æ˜¯targetå¸¸ç”¨çš„å‡ ä¸ªï¼š</p>
<ol>
<li>CONSTRUCTOR:ç”¨äºæè¿°æ„é€ å™¨</li>
<li>FIELD:ç”¨äºæè¿°åŸŸ</li>
<li>LOCAL_VARIABLE:ç”¨äºæè¿°å±€éƒ¨å˜é‡</li>
<li>METHOD:ç”¨äºæè¿°æ–¹æ³•</li>
<li>PACKAGE:ç”¨äºæè¿°åŒ…</li>
<li>PARAMETER:ç”¨äºæè¿°å‚æ•°</li>
<li>TYPE:ç”¨äºæè¿°ç±»ã€æ¥å£(åŒ…æ‹¬æ³¨è§£ç±»å‹) æˆ–enumå£°æ˜</li>
</ol>
<h3 id="Retention"><a href="#Retention" class="headerlink" title="Retention"></a>Retention</h3><p>Retentionä»£è¡¨å®ƒä»€ä¹ˆæ—¶å€™å‘ç”Ÿä½œç”¨ï¼Œå¸¸ç”¨å°±ä¸‰ç§ï¼š</p>
<ol>
<li>SOURCE:åœ¨æºæ–‡ä»¶ä¸­æœ‰æ•ˆï¼ˆå³æºæ–‡ä»¶ä¿ç•™ï¼‰</li>
<li>CLASS:åœ¨classæ–‡ä»¶ä¸­æœ‰æ•ˆï¼ˆå³classä¿ç•™ï¼‰</li>
<li>RUNTIME:åœ¨è¿è¡Œæ—¶æœ‰æ•ˆï¼ˆå³è¿è¡Œæ—¶ä¿ç•™ï¼‰</li>
</ol>
<h1 id="Documented"><a href="#Documented" class="headerlink" title="@Documented"></a>@Documented</h1><p>ä¸»è¦æ˜¯javadocæ¡£æ¡ˆåŒ–éœ€è¦</p>
<h1 id="Inheritedï¼š"><a href="#Inheritedï¼š" class="headerlink" title="@Inheritedï¼š"></a>@Inheritedï¼š</h1><p>@Inheritedé˜è¿°äº†æŸä¸ªè¢«æ ‡æ³¨çš„ç±»å‹æ˜¯è¢«ç»§æ‰¿çš„</p>
<h1 id="éªŒè¯è‡ªå®šä¹‰çš„æƒ…å†µ"><a href="#éªŒè¯è‡ªå®šä¹‰çš„æƒ…å†µ" class="headerlink" title="éªŒè¯è‡ªå®šä¹‰çš„æƒ…å†µ"></a>éªŒè¯è‡ªå®šä¹‰çš„æƒ…å†µ</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processAnnotation</span><span class="params">()</span> </span>&#123;</div><div class="line">        Log.e(TAG, <span class="string">"btn id : "</span> + R.id.btnTest );</div><div class="line"></div><div class="line">        </div><div class="line">        Field[] fields  =  <span class="keyword">this</span>.getClass().getDeclaredFields();</div><div class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</div><div class="line">            <span class="keyword">if</span> (field.isAnnotationPresent(BindView.class)) &#123;</div><div class="line">                BindView bindView = field.getAnnotation(BindView.class);</div><div class="line">                <span class="keyword">int</span> viewID = bindView.value();</div><div class="line">                Log.e(TAG, <span class="string">"processAnnotation: "</span> + viewID );</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>å‘ç°æ‰“å°çš„ä¸¤ä¸ªå€¼æ˜¯ç›¸ç­‰çš„ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œä¸ºä¸€ä¸ªAndroidç¨‹åºå‘˜ï¼Œæ³¨è§£ï¼ˆAnnotationï¼‰ä¼šæ˜¯ä¸€ä¸ªè®©æˆ‘ä»¬äº‹åŠåŠŸå€çš„ä¸€ä¸ªå¼€å‘åˆ©å™¨ï¼Œå®ƒå¯ä»¥ç®€åŒ–ä»£ç ï¼ˆå¦‚ButterKnifeï¼‰ï¼Œå¯ä»¥çº¦æŸè¾“å…¥æ¡ä»¶ï¼ˆå¦‚support-annotationsï¼‰ï¼Œå¯ä»¥å°†è¾“å…¥æ¡ä»¶æ”¹ä¸ºé…ç½®ï¼ˆå¦‚Retrofit 2.0ï¼‰ç­‰ï¼Œå°±è®©æˆ‘ä»¬å¼€ä¸‹æ³¨è§£
    
    </summary>
    
      <category term="Android" scheme="http://ownwell.github.io/categories/Android/"/>
    
    
      <category term="æ³¨è§£" scheme="http://ownwell.github.io/tags/%E6%B3%A8%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>AndroidåŠ¨æ€åŠ è½½soæ–‡ä»¶</title>
    <link href="http://ownwell.github.io/2017/07/18/dynamic-load-so/"/>
    <id>http://ownwell.github.io/2017/07/18/dynamic-load-so/</id>
    <published>2017-07-17T16:29:19.000Z</published>
    <updated>2017-07-18T01:56:40.910Z</updated>
    
    <content type="html"><![CDATA[<p>éšç€ä¸šåŠ¡çš„å¢å¤§ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç ä¹Ÿéšä¹‹å¢å¤šï¼ŒåŒ…çš„å¤§å°æ˜¯æœ‰å¢æ— å‡ï¼Œæ‰€ä»¥é€‚å½“çš„æ—¶å€™æ€è€ƒä¸‹:æ€ä¹ˆåšå‡æ³•â€“å‡å°åŒ…çš„ä½“ç§¯ã€‚</p>
<p>ç»“åˆæœ€è¿‘åœ¨åšçš„å…¬å¸çš„é¡¹ç›®ï¼Œè§‰å¾—åŠ¨æ€åŠ è½½soæ–‡ä»¶æ˜¯ä¸€ä¸ªå¾ˆå¥½ç²¾ç®€apkåŒ…çš„æ–¹æ³•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè§†é¢‘æ’­æ”¾å™¨çš„SDKï¼ˆå¦‚IJKplayerï¼ŒVLC playerï¼‰ï¼Œä»–ä»¬çš„å„ç§è§†é¢‘çš„è§£ç å™¨ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡C/C++ç¼–è¯‘çš„soæ–‡ä»¶ï¼Œè¿™äº›soæ–‡ä»¶å…¶å®éƒ½ä¸å°ï¼Œè¿™æ ·å¯¼è‡´æˆ‘ä»¬ä»å¸‚åœºä¸Šä¸‹è½½çš„apkåŒ…å¾ˆå¤§ï¼Œæ‰€ä»¥èƒ½ä¸èƒ½è®©soæ–‡ä»¶ä¸éšapkä¸€èµ·å‘å¸ƒå‘¢ï¼Œè€Œæ˜¯æŒ‰éœ€ä¸‹è½½(åªæœ‰å½“éœ€è¦æ’­æ”¾è§†é¢‘æ—¶æ‰å»æœåŠ¡å™¨ä¸‹è½½ï¼Œç„¶åå†åœ¨æœ¬åœ°load)ã€‚<br><a id="more"></a><br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/so-fix.png" alt=""></p>
<h1 id="ä¸ºä»€ä¹ˆè¦åŠ¨æ€åŠ è½½"><a href="#ä¸ºä»€ä¹ˆè¦åŠ¨æ€åŠ è½½" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åŠ¨æ€åŠ è½½"></a>ä¸ºä»€ä¹ˆè¦åŠ¨æ€åŠ è½½</h1><p>å…¶å®åˆšæ‰å·²ç»è§£é‡Šäº†ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…apkå®‰è£…åŒ…è¿‡å¤§ï¼Œå› ä¸ºè¿™äº›soæ–‡ä»¶æ˜¯ä¾èµ–serverçš„ä¸‹å‘ï¼Œæœ¬åœ°åªæ˜¯loadçš„è¿‡ç¨‹ã€‚<br>å…¶æ¬¡ï¼ŒåŠ¨æ€åŠ è½½å¯ä»¥åŠ¨æ€å‡çº§soæ–‡ä»¶ï¼Œä¹Ÿæ˜¯åŠ¨æ€åŒ–çš„ä¸€éƒ¨åˆ†ã€‚å¯ä»¥åœ¨ä¸å‘ç‰ˆçš„æƒ…å†µä¸‹ï¼Œå‡çº§soæ–‡ä»¶ã€‚</p>
<blockquote>
<p>åŠ¨æ€åŠ è½½soæ–‡ä»¶ï¼Œå¿…é¡»è¿›è¡Œå®‰å…¨æ€§æ ¡éªŒï¼Œé¿å…ä¸å¿…è¦çš„å®‰å…¨äº‹æ•…ã€‚</p>
</blockquote>
<h1 id="åŠ¨æ€åŠ è½½soæ–‡ä»¶"><a href="#åŠ¨æ€åŠ è½½soæ–‡ä»¶" class="headerlink" title="åŠ¨æ€åŠ è½½soæ–‡ä»¶"></a>åŠ¨æ€åŠ è½½soæ–‡ä»¶</h1><h2 id="1-System-load-String-filePath"><a href="#1-System-load-String-filePath" class="headerlink" title="1. System.load(String filePath)"></a>1. System.load(String filePath)</h2><p>åŠ è½½soæ–‡ä»¶åˆ†ä¸ºåŠ¨æ€åŠ è½½å’Œé™æ€åŠ è½½ã€‚</p>
<ol>
<li><p>é™æ€åŠ è½½å°±æ˜¯é€šè¿‡<code>System.loadLibrary(Sting libname);</code>æ¥ç›´æ¥åŠ è½½ï¼Œå¯¹äºä¸€ä¸ªappå®ƒåªèƒ½åŠ è½½systemçš„å’Œæˆ‘ä»¬è‡ªå·±æ·»åŠ åˆ°jniLibsä¸‹çš„soæ–‡ä»¶ã€‚<br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/so_fix_libs_path.png" alt="å›¾2-1"></p>
<p>è¿™ä¸ªæ˜¯æˆ‘çš„demoé¡¹ç›®çš„è·¯å¾„ï¼Œé™æ€åŠ è½½å›å»è¿™äº›è·¯å¾„ä¸‹æ‰¾åˆ°å¯¹åº”çš„åº“ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</p>
</li>
<li><p>åŠ¨æ€åŠ è½½è¿™æ˜¯é€šè¿‡<code>System.load(String filePath)</code>æ¥åŠ è½½filePathå¯¹åº”è·¯å¾„ä¸‹çš„soæ–‡ä»¶ï¼Œè¿™ä¸ªè·¯å¾„ä¸å¯ä»¥æ˜¯å¤–ç½®SDcardç­‰æ‹“å±•è·¯å¾„ï¼Œå¿…é¡»æ˜¯/data/**{package}ä¸‹ã€‚</p>
</li>
</ol>
<p>æ‰€ä»¥ä¸‹å‘çš„soæ²¡æœ‰æƒé™æ”¾åˆ°å›¾2-1ä¸‹ï¼Œåªèƒ½é€šè¿‡åŠ è½½çš„soæ–‡ä»¶è·¯å¾„çš„æ–¹å¼æ¥åŠ¨æ€åŠ è½½soæ–‡ä»¶ã€‚</p>
<p>æ–¹æ¡ˆ1ï¼š å°†soæ–‡ä»¶copyåˆ°/data/**{package}ä¸‹ï¼Œsystem.load(filePath).</p>
<h2 id="2-æ”¯æŒé™æ€åŠ è½½"><a href="#2-æ”¯æŒé™æ€åŠ è½½" class="headerlink" title="2. æ”¯æŒé™æ€åŠ è½½"></a>2. æ”¯æŒé™æ€åŠ è½½</h2><p>ä½†æ˜¯æˆ‘ä»¬è¿™æ ·åšè¿˜æ˜¯è§£å†³ä¸äº†é—®é¢˜ï¼Œå› ä¸ºæœ‰äº›soæ–‡ä»¶åŠ è½½çš„è¿‡ç¨‹æ˜¯æ”¾åˆ°sdkxiaçš„ï¼Œå¦‚ç™¾åº¦åœ°å›¾sdkï¼Œå·²ç»å°è£…äº†åŠ è½½soæ–‡ä»¶ï¼ˆé™æ€åŠ è½½ï¼‰ï¼Œå³ä½¿ä½ å·²ç»å®ç°äº†æ–¹æ¡ˆ1ä»ç„¶æ‰”å‡º<code>UnsatisfiedLinkError</code>çš„å¼‚å¸¸ã€‚<br>è¦å¼„æ¸…è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±å¿…é¡»äº†è§£soçš„åŠ è½½è¿‡ç¨‹ï¼Œä»¥æˆ‘çš„æœ¬åœ°çš„android skdï¼ˆAndroidï¼‰ä¸ºä¾‹ã€‚<br>Systemæºç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadLibrary</span><span class="params">(String libname)</span> </span>&#123;</div><div class="line">              Runtime.getRuntime().loadLibrary0(VMStack.getCallingClassLoader(), libname);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>RunningTime<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">loadLibrary0</span><span class="params">(ClassLoader loader, String libname)</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (libname.indexOf((<span class="keyword">int</span>)File.separatorChar) != -<span class="number">1</span>) &#123;</div><div class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(</div><div class="line">  <span class="string">"Directory separator should not appear in library name: "</span> + libname);</div><div class="line">      &#125;</div><div class="line">      String libraryName = libname;</div><div class="line">      <span class="keyword">if</span> (loader != <span class="keyword">null</span>) &#123;</div><div class="line">      <span class="comment">// å»loadeä¸­æŸ¥æ‰¾libraryNameå‘½ä»¤çš„library</span></div><div class="line">          String filename = loader.findLibrary(libraryName);</div><div class="line">          <span class="keyword">if</span> (filename == <span class="keyword">null</span>) &#123;</div><div class="line">              <span class="comment">// It's not necessarily true that the ClassLoader used</span></div><div class="line">              <span class="comment">// System.mapLibraryName, but the default setup does, and it's</span></div><div class="line">              <span class="comment">// misleading to say we didn't find "libMyLibrary.so" when we</span></div><div class="line">              <span class="comment">// actually searched for "liblibMyLibrary.so.so".</span></div><div class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(loader + <span class="string">" couldn't find \""</span> +</div><div class="line">                                             System.mapLibraryName(libraryName) + <span class="string">"\""</span>);</div><div class="line">          &#125;</div><div class="line">          String error = doLoad(filename, loader);</div><div class="line">          <span class="keyword">if</span> (error != <span class="keyword">null</span>) &#123;</div><div class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(error);</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">return</span>;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      String filename = System.mapLibraryName(libraryName);</div><div class="line">      List&lt;String&gt; candidates = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">      String lastError = <span class="keyword">null</span>;</div><div class="line">      <span class="keyword">for</span> (String directory : getLibPaths()) &#123;</div><div class="line">          String candidate = directory + filename;</div><div class="line">          candidates.add(candidate);</div><div class="line"></div><div class="line">          <span class="keyword">if</span> (IoUtils.canOpenReadOnly(candidate)) &#123;</div><div class="line">              String error = doLoad(candidate, loader);</div><div class="line">              <span class="keyword">if</span> (error == <span class="keyword">null</span>) &#123;</div><div class="line">                  <span class="keyword">return</span>; <span class="comment">// We successfully loaded the library. Job done.</span></div><div class="line">              &#125;</div><div class="line">              lastError = error;</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (lastError != <span class="keyword">null</span>) &#123;</div><div class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(lastError);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedLinkError(<span class="string">"Library "</span> + libraryName + <span class="string">" not found; tried "</span> + candidates);</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>ä»£ç ä¸­çš„loaderæ˜¯<code>ClassLoader</code>çš„å¯¹è±¡ï¼Œå¯¹äºAndroidå®é™…ä¸Šæ˜¯<code>PathClassLoader</code>,è¿™ä¸ªæ„æ€å°±æ˜¯å½“æœ‰classLoaderæ—¶å°±é€šè¿‡<code>PathClassLoader</code>çš„<code>findLibrary(libraryName)</code>æ¥åŠ è½½ï¼ˆè¿™ä¸ªå¥½åƒåŠ è½½classï¼‰ï¼Œè‹¥æ— classLoaderå°±é€šè¿‡<code>mapLibraryName1ï¼ˆï¼‰</code></p>
<blockquote>
<p>å»ºè®®å¤§å®¶çœ‹ä¸‹nativeå±‚æ€ä¹ˆå®ç°çš„ï¼š<a href="https://www.v2ex.com/t/364978" target="_blank" rel="external">æ·±å…¥ç†è§£ System.loadLibrary</a></p>
</blockquote>
<p>æˆ‘ä»¬åŠ è½½soçœ‹classLoaderæ˜¯æ€ä¹ˆå®ç°çš„ï¼ŒAndroid 5.0çš„æºç æºç ï¼š<br><a href="https://android.googlesource.com/platform/libcore/+/android-5.0.0_r6/dalvik/src/main/java/dalvik/system/BaseDexClassLoader.java" target="_blank" rel="external">BaseDexClassLoader.javaçš„æºç </a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">findLibrary</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> pathList.findLibrary(name);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>pathListå°±æ˜¯æˆ‘ä»¬çš„DexPathListå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DexPathList</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEX_SUFFIX = <span class="string">".dex"</span>;</div><div class="line">    <span class="comment">/** class definition context */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClassLoader definingContext;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * List of dex/resource (class path) elements.</div><div class="line">     * Should be called pathElements, but the Facebook app uses reflection</div><div class="line">     * to modify 'dexElements' (http://b/7726934).</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Element[] dexElements;</div><div class="line">    <span class="comment">/** List of native library directories. */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> File[] nativeLibraryDirectories;</div><div class="line">     â€¦â€¦â€¦â€¦</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">findLibrary</span><span class="params">(String libraryName)</span> </span>&#123;</div><div class="line">        String fileName = System.mapLibraryName(libraryName);</div><div class="line">        <span class="keyword">for</span> (File directory : nativeLibraryDirectories) &#123;</div><div class="line">            String path = <span class="keyword">new</span> File(directory, fileName).getPath();</div><div class="line">            <span class="keyword">if</span> (IoUtils.canOpenReadOnly(path)) &#123;</div><div class="line">                <span class="keyword">return</span> path;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    â€¦â€¦â€¦â€¦</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çœ‹åˆ°äº†å§ï¼Œä¼šå…ˆæ‰¾systemä¸‹çš„soæ–‡ä»¶ï¼Œå†æ‰¾<code>nativeLibraryDirectories</code>ä¸‹çš„ï¼Œè€Œè¿™ä¸ª<code>nativeLibraryDirectories</code>å°±æ˜¯æˆ‘ä»¬çš„è‡ªå·±é¡¹ç›®ä¸­jniLibsä¸‹å¯¹åº”çš„soæ–‡ä»¶çš„è·¯å¾„ã€‚<br>å½“ä»¥å½“æˆ‘ä»¬é™æ€åŠ è½½æ—¶ï¼Œå…¶å®æ‰¾çš„soæ–‡ä»¶å°±æ˜¯<code>nativeLibraryDirectories</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»¥æ­¤ä½œä¸ºçªç ´å£ï¼Œåˆ©ç”¨åå°„ï¼Œå°†è¿™ä¸ªnativeLibraryDirectoriesçš„å¼€å§‹å¤„åŠ ä¸Šæˆ‘ä»¬è‡ªå·±æ”¾soçš„æ–‡ä»¶å¤¹ä¸‹ï¼ˆæ„Ÿè§‰åƒQQç©ºé—´å¯¹classåšpatchçš„æ–¹å¼å“¦ï¼Œå…¶å®æ›¿æ¢æ—§çš„soæ–‡ä»¶è¿™ç§å¯ä»¥å¯è¡Œçš„ï¼‰ã€‚<br>å¼€å§‹hookå•¦ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">PathClassLoader pathClassLoader = (PathClassLoader) context.getApplicationContext().getClassLoader();</div><div class="line">       <span class="keyword">try</span> &#123;</div><div class="line">           Object pathList = getPathList(pathClassLoader);</div><div class="line">                </div><div class="line">           <span class="comment">// æ‹¿åˆ°nativeLibraryDirectoriesçš„Field</span></div><div class="line">           Field nativeLibraryDirectoriesField = pathList.getClass().getDeclaredField(<span class="string">"nativeLibraryDirectories"</span>);</div><div class="line">           nativeLibraryDirectoriesField.setAccessible(<span class="keyword">true</span>);</div><div class="line">           File[] libPaths = (File[]) nativeLibraryDirectoriesField.get(pathList);</div><div class="line">           File[] envilLibPaths = <span class="keyword">new</span> File[libPaths.length + <span class="number">1</span>];</div><div class="line">           <span class="comment">// å°†å­˜æ”¾æˆ‘ä»¬è‡ªå·±soçš„æ–‡ä»¶å¤¹åŠ åˆ°ç¬¬ä¸€ä½</span></div><div class="line">           envilLibPaths[<span class="number">0</span>] = dir;</div><div class="line">           <span class="comment">// å°†åŸæ¥çš„è·¯å¾„è¿½åŠ åˆ°åé¢</span></div><div class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; libPaths.length; i++) &#123;</div><div class="line">               envilLibPaths[i + <span class="number">1</span>] = libPaths[i];</div><div class="line">           &#125;</div><div class="line">           <span class="comment">// å°†æ–°çš„nativeLibraryDirectoriesè®¾ç½®ç»™pathList</span></div><div class="line">           nativeLibraryDirectoriesField.set(pathList, envilLibPaths);</div><div class="line">       &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</div><div class="line">           e.printStackTrace();</div><div class="line">       &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</div><div class="line">           e.printStackTrace();</div><div class="line">       &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</div><div class="line">           e.printStackTrace();</div><div class="line">       &#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªä»£ç æ˜¯åœ¨14-22éƒ½æ˜¯okçš„ï¼Œä½†æ˜¯23æºç ä¸æ˜¯è¿™æ ·æ»´ï¼Œçœ‹æºç å§ï¼š<br><a href="https://android.googlesource.com/platform/libcore/+/android-6.0.1_r48/dalvik/src/main/java/dalvik/system/DexPathList.java" target="_blank" rel="external">23çš„æºç </a>å…ˆæ”¾è¿™,hookèµ·æ¥ä¹Ÿä¸éš¾ã€‚</p>
<blockquote>
<p>Android 23æºç å»ºè®®hook <code>nativeLibraryPathElements</code>è¿™ä¸ªè€Œä¸æ˜¯<code>nativeLibraryDirectories;</code></p>
</blockquote>
<p>æ–¹æ¡ˆ2ï¼šHook DexPathListçš„nativeLibraryPathElementsæˆ–è€…nativeLibraryDirectoriesï¼Œå°†æˆ‘ä»¬è‡ªå®šä¹‰å­˜soæ–‡ä»¶çš„æ–‡ä»¶å¤¹ä½œä¸ºä»–ä»¬çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p>
<h1 id="å‡ºç°çš„é—®é¢˜"><a href="#å‡ºç°çš„é—®é¢˜" class="headerlink" title="å‡ºç°çš„é—®é¢˜"></a>å‡ºç°çš„é—®é¢˜</h1><p>åˆšå¼€å§‹æˆ‘æŠŠæ‰€æœ‰è§†é¢‘ç›¸å…³çš„soæ–‡ä»¶æ‰”åˆ°æœ¬åœ°çš„ä¸€ä¸ªæ–‡ä»¶ä¸‹ï¼Œå†copyåˆ°/data/**{package}ä¸‹ï¼Œå±…ç„¶æŠ¥<code>32-bit instead of 64-bit</code> è¿™ä¸ªé”™è¯¯ï¼Œæˆ‘æŠŠsoå†æ”¾åˆ°jniLibs/armeabiä¸‹å†è·‘å¯ä»¥å•Šï¼Œåæ¥googleäº†ä¸‹å‘ç°æœ‰äººåœ¨<a href="https://github.com/singwhatiwanna/dynamic-load-apk/issues/113" target="_blank" rel="external">åŠ¨æ€åŒ–</a>æ—¶ä¹Ÿé‡åˆ°äº†ï¼Œå…¶ä¸­Anjon-githubæåˆ°äº†ä¸€ä¸ªæ–¹æ¡ˆï¼šåªè¦æ‰¾ä»»æ„ä¸€ä¸ª32ä½çš„soæ–‡ä»¶ï¼ˆå½“ç„¶è¶Šå°è¶Šå¥½äº†ï¼‰æ”¾åˆ°ä¸»ç¨‹åºä¸­å³å¯,äºæ˜¯æˆ‘æ‰¾äº†ä¸ª1kçš„soæ–‡ä»¶æ”¾åˆ°äº†é¡¹ç›®çš„jniLibs/armeabiä¸‹å±…ç„¶çœŸçš„å¯ä»¥ï¼Œè¿™ä¸ªåŸå› ä¸çŸ¥ä¸ºä½•ï¼Œè¿™ä¸ªæ¶‰åŠåˆ°nativeä»£ç ï¼Œæœ¬äººæŠ€æœ¯æœ‰é™æš‚æ—¶æ²¡æ‰¾åˆ°ç­”æ¡ˆï¼Œä¸çŸ¥é“å¤§å®¶æ˜¯å¦æ›´å¥½çš„è§£ç­”æˆ–è€…è§£å†³æ–¹æ³•ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;éšç€ä¸šåŠ¡çš„å¢å¤§ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç ä¹Ÿéšä¹‹å¢å¤šï¼ŒåŒ…çš„å¤§å°æ˜¯æœ‰å¢æ— å‡ï¼Œæ‰€ä»¥é€‚å½“çš„æ—¶å€™æ€è€ƒä¸‹:æ€ä¹ˆåšå‡æ³•â€“å‡å°åŒ…çš„ä½“ç§¯ã€‚&lt;/p&gt;
&lt;p&gt;ç»“åˆæœ€è¿‘åœ¨åšçš„å…¬å¸çš„é¡¹ç›®ï¼Œè§‰å¾—åŠ¨æ€åŠ è½½soæ–‡ä»¶æ˜¯ä¸€ä¸ªå¾ˆå¥½ç²¾ç®€apkåŒ…çš„æ–¹æ³•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè§†é¢‘æ’­æ”¾å™¨çš„SDKï¼ˆå¦‚IJKplayerï¼ŒVLC playerï¼‰ï¼Œä»–ä»¬çš„å„ç§è§†é¢‘çš„è§£ç å™¨ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡C/C++ç¼–è¯‘çš„soæ–‡ä»¶ï¼Œè¿™äº›soæ–‡ä»¶å…¶å®éƒ½ä¸å°ï¼Œè¿™æ ·å¯¼è‡´æˆ‘ä»¬ä»å¸‚åœºä¸Šä¸‹è½½çš„apkåŒ…å¾ˆå¤§ï¼Œæ‰€ä»¥èƒ½ä¸èƒ½è®©soæ–‡ä»¶ä¸éšapkä¸€èµ·å‘å¸ƒå‘¢ï¼Œè€Œæ˜¯æŒ‰éœ€ä¸‹è½½(åªæœ‰å½“éœ€è¦æ’­æ”¾è§†é¢‘æ—¶æ‰å»æœåŠ¡å™¨ä¸‹è½½ï¼Œç„¶åå†åœ¨æœ¬åœ°load)ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://ownwell.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://ownwell.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Robustçƒ­ä¿®å¤-ä½¿ç”¨å’Œé¡¹ç›®ä»‹ç»</title>
    <link href="http://ownwell.github.io/2017/05/24/Robust%E7%83%AD%E4%BF%AE%E5%A4%8D-%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/"/>
    <id>http://ownwell.github.io/2017/05/24/Robustçƒ­ä¿®å¤-å…¥é—¨ä½¿ç”¨/</id>
    <published>2017-05-24T11:11:44.000Z</published>
    <updated>2017-05-24T13:00:47.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/Meituan-Dianping/Robust" target="_blank" rel="external">Robust</a>æ˜¯ç¾å›¢æ¨å‡ºçš„ä¸€æ¬¾çƒ­ä¿®å¤æ¡†æ¶ï¼Œæˆ‘è®°çš„ä¹‹å‰æˆ‘ä»¬åˆ†äº«è¿‡ä¸€ç¯‡<a href="http://ownwell.github.io/2016/09/30/%E7%83%AD%E4%BF%AE%E5%A4%8D%E4%B9%8B%E7%BE%8E%E5%9B%A2%E6%96%B9%E6%A1%88/">çƒ­ä¿®å¤ä¹‹ç¾å›¢æ–¹æ¡ˆ</a>,çœ‹å®Œè¿™ç¯‡æ–‡ç« å°±åŠ¨æ‰‹å†™äº†ä¸ªDemoç‰ˆé¡¹ç›®ã€‚æœç„¶ç­‰äº†ä¸ä¹…ï¼Œä»Šå¹´ä¸‰æœˆä»½ç¾å›¢å°†å·²ç»è¶‹å‘äºç¨³å®šçš„<a href="https://github.com/Meituan-Dianping/Robust" target="_blank" rel="external">Robust</a>å¼€æºï¼Œåœ¨Andoidå¼€å‘ç•Œä¹Ÿæ˜¯ä¸€è‡´å¥½è¯„ã€‚</p>
<p>åé¢ä¼šé™†ç»­æ”¾å‡ºRobustçƒ­ä¿®å¤çš„ä»£ç åˆ†æã€‚<br>ä½œä¸ºå¼€ç¯‡ç¬¬ä¸€ç¯‡ï¼Œè¿™ç¯‡æ–‡ç« ä¼šä»‹ç»æ€ä¹ˆä½¿ç”¨ï¼Œä½¿ç”¨ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜å’Œä»¥åŠRobusté¡¹ç›®ä»‹ç»ã€‚<br><a id="more"></a></p>
<h1 id="çƒ­ä¿®å¤ä½¿ç”¨"><a href="#çƒ­ä¿®å¤ä½¿ç”¨" class="headerlink" title="çƒ­ä¿®å¤ä½¿ç”¨"></a>çƒ­ä¿®å¤ä½¿ç”¨</h1><h2 id="çƒ­ä¿®å¤çš„æ­¥éª¤"><a href="#çƒ­ä¿®å¤çš„æ­¥éª¤" class="headerlink" title="çƒ­ä¿®å¤çš„æ­¥éª¤"></a>çƒ­ä¿®å¤çš„æ­¥éª¤</h2><p>æŒ‰ç…§å®ƒçš„æ­¥éª¤ï¼š</p>
<ol>
<li>å¯¼å…¥Robustæ’ä»¶</li>
<li>æ‰“å‡ºåŸºç¡€åŒ…ï¼Œå°†ç”Ÿæˆçš„Robustç›¸å…³æ–‡ä»¶æ”¾åˆ°æŒ‡å®šç›®å½•ä¸‹</li>
<li>ä¿®æ”¹ä»£ç </li>
<li>æ·»åŠ è‡ªåŠ¨æ‰“è¡¥ä¸åŒ…æ’ä»¶</li>
<li>æ‰“å‡ºè¡¥ä¸åŒ…ï¼Œå¹¶å°†åŒ…æ”¾åˆ°æŒ‡å®šè·¯å¾„</li>
<li>åŸºç¡€åŒ…åŠ è½½è¡¥ä¸åŒ…å®ç°çƒ­ä¿®å¤</li>
</ol>
<h2 id="Robustä½¿ç”¨æ³¨æ„äº‹é¡¹"><a href="#Robustä½¿ç”¨æ³¨æ„äº‹é¡¹" class="headerlink" title="Robustä½¿ç”¨æ³¨æ„äº‹é¡¹"></a>Robustä½¿ç”¨æ³¨æ„äº‹é¡¹</h2><p>ä¸è¿‡åœ¨å®é™…æ“ä½œä¸­ï¼Œå‘ç°äº†å¦‚ä¸‹é—®é¢˜ï¼š<br><strong>1.</strong><br><code>auto-patch-plugin</code>åªèƒ½åœ¨æ‰“è¡¥ä¸åŒ…æ—¶æ‰“å¼€ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„ç¬¬5æ­¥ï¼Œæ‰“åŸºç¡€åŒ…æ—¶ï¼Œä¸è¦æ‰“å¼€ã€‚</p>
<p><strong>2.</strong> æ‰“å‡ºåŸºç¡€åŒ…åï¼Œéœ€è¦å°†ç”Ÿæˆçš„mappingæ–‡ä»¶ä»¥åŠbuild/outputs/robust/methodsMap.robustæ–‡ä»¶ã€‚<br>ä¸ºäº†æ›´å¥½ä½¿ç”¨å†™äº†ä¸ªGradelè„šæœ¬.  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function">task <span class="title">deleteFiles</span><span class="params">(type: Delete)</span> </span>&#123;</div><div class="line">    <span class="function">delete <span class="title">fileTree</span><span class="params">(<span class="string">'output'</span>)</span> </span>&#123;</div><div class="line">        include <span class="string">'**'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">copyFiles &#123;</div><div class="line">    description = <span class="string">'copy methodsMap to output file'</span></div><div class="line">    from <span class="string">'build/outputs/robust/methodsMap.robust'</span></div><div class="line">    into <span class="string">'robust/'</span></div><div class="line"></div><div class="line">    from <span class="string">'build/outputs/mapping/release/mapping.txt'</span></div><div class="line">    into <span class="string">'robust/'</span></div><div class="line"></div><div class="line">    from <span class="string">'build/outputs/apk/app-release.apk'</span></div><div class="line">    into <span class="string">'robust/'</span></div><div class="line">&#125;</div><div class="line"><span class="function">task <span class="title">copyFiles</span><span class="params">(type: Copy)</span> dependsOn deleteFiles</span></div></pre></td></tr></table></figure>
<p>æ‰€ä»¥åœ¨æ‰“åŸºç¡€åŒ…åï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">./gradlew copyFilesï¼ˆWindowsï¼š./gradlew.bat copyFilesï¼‰</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·åœ¨appä¸‹å°±æœ‰<br><code>methodsMap.robust</code><br> <code>mapping.txt</code><br> <code>app-release.apk</code>è¿™ä¸‰ä¸ªæ–‡ä»¶ã€‚     </p>
<p><strong>3.</strong> é…ç½®ä¸»é¡¹ç›®ä¸‹ä¸€å®šè¦é…ç½®<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">```java</div><div class="line">&lt;!--éœ€è¦çƒ­è¡¥çš„åŒ…åæˆ–è€…ç±»åï¼Œè¿™äº›åŒ…åä¸‹çš„æ‰€æœ‰ç±»éƒ½è¢«ä¼šæ’å…¥ä»£ç --&gt;</div><div class="line">&lt;packname name=&quot;hotfixPackage&quot;&gt;</div><div class="line">       &lt;name&gt;com.meituan&lt;/name&gt;</div><div class="line">       &lt;name&gt;com.sankuai&lt;/name&gt;</div><div class="line">       &lt;name&gt;com.dianping&lt;/name&gt;</div><div class="line">&lt;/packname&gt;</div><div class="line"></div><div class="line">   &lt;!--ä¸éœ€è¦çƒ­è¡¥çš„åŒ…åæˆ–è€…ç±»åï¼Œå¯ä»¥åœ¨éœ€è¦çƒ­è¡¥çš„åŒ…ä¸­å‰”é™¤æŒ‡å®šçš„ç±»æˆ–è€…åŒ…--&gt;</div><div class="line">   &lt;exceptPackname name=&quot;exceptPackage&quot;&gt;</div><div class="line">       &lt;name&gt;com.meituan.robust&lt;/name&gt;</div><div class="line">   &lt;/exceptPackname&gt;</div><div class="line"></div><div class="line">   &lt;!--è¡¥ä¸çš„åŒ…å--&gt;</div><div class="line">   &lt;patchPackname name=&quot;patchPackname&quot;&gt;</div><div class="line">       &lt;name&gt;com.meituan.robust.patch&lt;/name&gt;</div><div class="line">   &lt;/patchPackname&gt;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªéœ€è¦æ ¹æ®æˆ‘ä»¬çš„å®é™…æƒ…å†µæ¥é…ç½®ã€‚<code>hotfixPackage</code>ä¸‹æ‰€æœ‰ç±»éƒ½ä¼šæœ‰ä¸€æ¡©ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªç±»é‡Œé¢éƒ½ä¼šæœ‰ä¸€ä¸ªé™æ€çš„æ¥å£ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> ChangeQuickRedirect     changeQuickRedirect;</div></pre></td></tr></table></figure></p>
<h1 id="Robusté¡¹ç›®ä»‹ç»"><a href="#Robusté¡¹ç›®ä»‹ç»" class="headerlink" title="Robusté¡¹ç›®ä»‹ç»"></a>Robusté¡¹ç›®ä»‹ç»</h1><p>åœ¨Robusté¡¹ç›®ä¸‹æœ‰å››ä¸ªæ¨¡æ¿ï¼š<br>Robust<br> â€“ auto-patch-plugin<br> â€“ gradle-plugin<br> â€“ patch<br> â€“ autopatchbase   </p>
<p>auto-patch-plugin è¿™ä¸ªæ˜¯è‡ªåŠ¨æ‰“åŒ…çš„æ’ä»¶<br>gradle-plugin æ˜¯ä¸ºç±»ä¸­æ’æ¡©çš„æ’ä»¶<br>patch è¾…åŠ©ç®¡ç†å’ŒåŠ è½½è¡¥ä¸çš„åŸºç¡€ç±»<br>autopatchbase  æ˜¯Robustæœ€æœ€åŸºç¡€çš„ç±»ï¼Œè¿™ä¸ªé‡Œé¢æœ‰æˆ‘ä»¬çš„<code>ChangeQuickRedirect</code>è¿™ä¸ªæ¡©æ¥å£ã€‚å…¶ä»–ä¸‰ä¸ªæ¨¡å—éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªæ¨¡å—ã€‚<br>å…¶åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>ç¬¬ä¸€æ¬¡æ‰“åŸºç¡€åŒ…ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„<code>gradle-plugin</code>,ä¼šåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­å°†æˆ‘ä»¬éœ€è¦çš„ç±»æ’å…¥ä¸€ä¸ª<code>ChangeQuickRedirect</code>æ¡©æ¥å£çš„é™æ€å®ä¾‹ï¼Œæ¯ä¸ªå‡½æ•°å‰æ’å…¥å¦‚ä¸‹ä»£ç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(changeQuickRedirect != <span class="keyword">null</span>) &#123;    </div><div class="line">            <span class="comment">//PatchProxyä¸­å°è£…äº†è·å–å½“å‰classNameå’ŒmethodNameçš„é€»è¾‘ï¼Œå¹¶åœ¨å…¶å†…éƒ¨æœ€ç»ˆè°ƒç”¨äº†changeQuickRedirectçš„å¯¹åº”å‡½æ•°</span></div><div class="line">            <span class="keyword">if</span>(PatchProxy.isSupport(<span class="keyword">new</span> Object[<span class="number">0</span>], <span class="keyword">this</span>, changeQuickRedirect, <span class="keyword">false</span>)) &#123;     </div><div class="line">                <span class="keyword">return</span> ((Long)PatchProxy.accessDispatch(<span class="keyword">new</span> Object[<span class="number">0</span>], <span class="keyword">this</span>, changeQuickRedirect, <span class="keyword">false</span>)).longValue();    </div><div class="line">            &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹ä»£ç ï¼Œåœ¨æ”¹åŠ¨çš„ä»£ç å‰æ·»åŠ @Addæˆ–è€…@Modifyçš„æ³¨é‡Š</p>
</li>
<li>ä½¿ç”¨<code>auto-patch-plugin</code>æ’ä»¶ï¼Œæ¥ç”Ÿæˆç›¸å¯¹åº”çš„è¡¥ä¸ã€‚</li>
<li>åŠ è½½è¡¥ä¸ï¼Œé€šè¿‡è¡¥ä¸ä¸­çš„<code>com.meituan.robust.patch.PatchesInfoImpl</code>è·å–å“ªä¸ªç±»éœ€è¦æ’æ¡©å’Œæ’å…¥çš„æ¡©æ¥å£å¯¹åº”çš„å®ç°ç±»ã€‚</li>
</ol>
<p>ç°åœ¨ç•™ä¸‹å‡ ä¸ªç–‘é—®ï¼š</p>
<ol>
<li>å¦‚ä½•é€šè¿‡<code>gradle-plugin</code>ä¸ºéœ€è¦çš„ç±»æ’æ¡©ï¼Ÿ</li>
<li>æ‰“åŒ…è¿‡ç¨‹ä¸­ä¼šæœ‰ä»£ç æ··æ·†ï¼Œæ€ä¹ˆè§£å†³ä»£ç æ··æ·†å’Œå¯¹åº”çš„è¡¥ä¸é—®é¢˜</li>
<li>æ”¹å˜ä»£ç åï¼Œè¿™ä¸ªæ³¨è§£æœ‰ä»€ä¹ˆç”¨ï¼Œ<code>auto-patch-plugin</code>å¦‚ä½•é€šè¿‡å’Œä¹‹å‰çš„æ–‡ä»¶æ¯”è¾ƒï¼Œæ€ä¹ˆç”Ÿæˆè¡¥ä¸ã€‚</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://github.com/Meituan-Dianping/Robust&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Robust&lt;/a&gt;æ˜¯ç¾å›¢æ¨å‡ºçš„ä¸€æ¬¾çƒ­ä¿®å¤æ¡†æ¶ï¼Œæˆ‘è®°çš„ä¹‹å‰æˆ‘ä»¬åˆ†äº«è¿‡ä¸€ç¯‡&lt;a href=&quot;http://ownwell.github.io/2016/09/30/%E7%83%AD%E4%BF%AE%E5%A4%8D%E4%B9%8B%E7%BE%8E%E5%9B%A2%E6%96%B9%E6%A1%88/&quot;&gt;çƒ­ä¿®å¤ä¹‹ç¾å›¢æ–¹æ¡ˆ&lt;/a&gt;,çœ‹å®Œè¿™ç¯‡æ–‡ç« å°±åŠ¨æ‰‹å†™äº†ä¸ªDemoç‰ˆé¡¹ç›®ã€‚æœç„¶ç­‰äº†ä¸ä¹…ï¼Œä»Šå¹´ä¸‰æœˆä»½ç¾å›¢å°†å·²ç»è¶‹å‘äºç¨³å®šçš„&lt;a href=&quot;https://github.com/Meituan-Dianping/Robust&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Robust&lt;/a&gt;å¼€æºï¼Œåœ¨Andoidå¼€å‘ç•Œä¹Ÿæ˜¯ä¸€è‡´å¥½è¯„ã€‚&lt;/p&gt;
&lt;p&gt;åé¢ä¼šé™†ç»­æ”¾å‡ºRobustçƒ­ä¿®å¤çš„ä»£ç åˆ†æã€‚&lt;br&gt;ä½œä¸ºå¼€ç¯‡ç¬¬ä¸€ç¯‡ï¼Œè¿™ç¯‡æ–‡ç« ä¼šä»‹ç»æ€ä¹ˆä½¿ç”¨ï¼Œä½¿ç”¨ä¸­éœ€è¦æ³¨æ„çš„é—®é¢˜å’Œä»¥åŠRobusté¡¹ç›®ä»‹ç»ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Androidçƒ­ä¿®å¤" scheme="http://ownwell.github.io/categories/Android%E7%83%AD%E4%BF%AE%E5%A4%8D/"/>
    
    
      <category term="Android" scheme="http://ownwell.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ã€Androidã€‘çŠ¶æ€æ é¢œè‰²çš„é€‚é…</title>
    <link href="http://ownwell.github.io/2017/04/13/Android-%E7%8A%B6%E6%80%81%E6%A0%8F%E9%A2%9C%E8%89%B2%E7%9A%84%E9%80%82%E9%85%8D/"/>
    <id>http://ownwell.github.io/2017/04/13/Android-çŠ¶æ€æ é¢œè‰²çš„é€‚é…/</id>
    <published>2017-04-12T16:03:25.000Z</published>
    <updated>2017-04-19T05:57:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ä¸€ç›´å¿™ç€å†™ä¸šåŠ¡ï¼Œä¸€ç›´æ²¡ç²¾åŠ›æ›´æ–°åšå®¢ï¼Œè¶ç€æœ€è¿‘æœ‰ç‚¹ç©ºé—²äº‹ä»¶ï¼Œè§‰å¾—å¾ˆæœ‰å¿…è¦å†™ä¸€ç¯‡åšå®¢æ¡å›ä»¥å‰çš„é‚£ä¸ªçŠ¶æ€ã€‚å°±å†™ä¸€ä¸ªè‡ªå·±å½“æ—¶æ€»ç»“çš„ä¸€ä¸ªé€‚é…åŠŸèƒ½å§ï¼šå…³äºçŠ¶æ€æ çš„å­—ä½“/å›¾æ ‡é¢œè‰²é€‚é…ã€‚</p>
<p>éšç€Android6.0 Android7.0ç³»ç»Ÿçš„ç³»ç»Ÿå‡çº§ï¼Œå¼€å‘è€…æ¥è¯´é€‚é…çš„å®¹æ˜“ç¨‹åº¦è¶Šæ¥è¶Šä½ï¼Œæˆ‘ä»¬éœ€è¦å°†ç²¾åŠ›æ”¾åˆ°é€‚é…4.4+ä»¥ä¸Šï¼Œè€ŒAndroid4.4ç›¸å¯¹æ¥è¯´æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¨³å®šçš„ç‰ˆæœ¬ï¼Œå°¤å…¶æ˜¯åœ¨UIä¸Šå®ƒåˆå’ŒAndroid 6.0ã€Android7.0æ¥è¿‘ã€‚<br><a id="more"></a><br>å¯¹äºçŠ¶æ€æ çš„ï¼Œæˆ‘è®°å¾—ä¹‹å‰æˆ‘å†™è¿‡æ–‡ç« æ¥å®ç°ç€è‰²çš„ã€é€æ˜çš„ç­‰å„ç§æ ·å¼çš„é€‚é…çš„æ–‡ç« ï¼Œä»Šå¤©ä¸å†èµ˜è¿°ã€‚</p>
<p>æˆ‘ä»¬è¦è¯´çš„æ˜¯ä»Šå¤©çš„å…³äºçŠ¶æ€æ çš„å­—ä½“/å›¾æ ‡é¢œè‰²ã€‚</p>
<h1 id="çŠ¶æ€å­—ä½“é¢œè‰²æœ‰åŒºåˆ†"><a href="#çŠ¶æ€å­—ä½“é¢œè‰²æœ‰åŒºåˆ†" class="headerlink" title="çŠ¶æ€å­—ä½“é¢œè‰²æœ‰åŒºåˆ†"></a>çŠ¶æ€å­—ä½“é¢œè‰²æœ‰åŒºåˆ†</h1><p>å¯èƒ½å¯¹äºæˆ‘è¿™ä¸ªè¢«äººæˆä¸ºâ€MI Bodyâ€çš„ä¼ªç±³ç²‰æ¥è¯´ï¼Œæ‰‹é‡Œæ¡ç€MI 5ï¼Œå¬éŸ³ä¹ç”¨çš„å°ç±³è€³æœºï¼Œè¿˜æˆ´ç€å°ç±³æ‰‹ç¯ï¼Œå¯èƒ½è§‰å¾—å°ç±³æœ€ç»å…¸ä¹‹ä½œæ˜¯å°ç±³å®šåˆ¶çš„ç³»ç»Ÿâ€”MI UIã€‚</p>
<p>å½“ç„¶é™¤äº†Mi UIå…¶ä»–å‚å•†ä¹Ÿæœ‰å®šåˆ¶ï¼ŒFlymeï¼ŒEMUIï¼ŒColor OSä»¥åŠä¸€åŠ çš„æ°¢OSï¼ŒSmartisan OSç­‰ç­‰ï¼Œæ¯æ¬¾å®šåˆ¶ROMéƒ½æœ‰å…¶ç‹¬ç‰¹ä¹‹å¤„ï¼Œä¸è¿‡ä¸ªäººå·²ç»ä¹ æƒ¯äº†Mi UIã€‚<br>MI UIä¸€ä¸ªå¾ˆå¥½çš„ä½“éªŒå°±æ˜¯çŠ¶æ€çš„å­—ä½“èƒ½å¤Ÿå˜è‰²ï¼Œé»‘è‰²å˜ç™½è‰²ï¼Œç™½è‰²å˜é»‘è‰²ã€‚<br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/14920106163118.jpg" alt=""></p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/14920106348516.jpg" alt=""></p>
<p>æ˜¯ä¸æ˜¯å¾ˆæœ‰æ„æ€ï¼Œå…¶ä»–Android 6.0ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„Android Nä¹Ÿæ˜¯æ”¯æŒçš„ã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/14920119504831.jpg" alt=""></p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/14920118899908.jpg" alt=""></p>
<blockquote>
<p>çŒœæƒ³ï¼šGoogleä¸‹ä¸€æ­¥ä¼šä¸ä¼šæŠŠçŠ¶æ€æ çš„å­—ä½“å’Œå›¾æ ‡é¢œè‰²ä¹Ÿå¼€æ”¾èƒ½è®¾ç½®æˆå½©è‰²å‘¢ï¼Ÿ</p>
</blockquote>
<p>é‚£ä¹ˆå¦‚ä½•æ¥å®ç°å‘¢ï¼Œè¿™ç§é€‚é…å‘¢ï¼Ÿ</p>
<h1 id="é€‚é…çŠ¶æ€æ çš„å­—ä½“-å›¾æ ‡é¢œè‰²"><a href="#é€‚é…çŠ¶æ€æ çš„å­—ä½“-å›¾æ ‡é¢œè‰²" class="headerlink" title="é€‚é…çŠ¶æ€æ çš„å­—ä½“/å›¾æ ‡é¢œè‰²"></a>é€‚é…çŠ¶æ€æ çš„å­—ä½“/å›¾æ ‡é¢œè‰²</h1><p>ç”±äºå›½å†…çš„ROMå¦‚MI UIå’ŒFlymeå·²ç»ä¿®æ”¹è¿‡Androidçš„æºç ï¼Œä»–ä»¬åœ¨Android 4.4 åšäº†é€‚é…ï¼Œè€ŒåŸç”Ÿçš„ç³»ç»Ÿåˆ™æ˜¯åœ¨Android Mä¸Šæ‰èƒ½è®¾ç½®çŠ¶æ€æ å­—ä½“é¢œè‰²ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦è‡ªå·±å»ä¸€ä¸ªä¸ªåˆ¤æ–­é€‚é…ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">applay</span><span class="params">(Activity activity, <span class="keyword">boolean</span> isDarkFont)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">            IStatusBar statusBar = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">if</span> (OSUtils.isFlyme()) &#123;</div><div class="line">                statusBar = mStatusBars.get(StatusBarAdapter.FLYME);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (OSUtils.isMIUI()) &#123;</div><div class="line">                statusBar = mStatusBars.get(StatusBarAdapter.MIUI);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (OSUtils.isOSM()) &#123;</div><div class="line">                statusBar = mStatusBars.get(StatusBarAdapter.OS_M);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (statusBar != <span class="keyword">null</span>) &#123;</div><div class="line">                statusBar.setStatusBarLightMode(activity, isDarkFont);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="å°ç±³çš„MIUIï¼š"><a href="#å°ç±³çš„MIUIï¼š" class="headerlink" title="å°ç±³çš„MIUIï¼š"></a>å°ç±³çš„MIUIï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.view.Window;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.lang.reflect.Field;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * // å°ç±³</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> Cyning</div><div class="line"> * <span class="doctag">@since</span> 2017-04-05</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MiuiStatusbar</span> <span class="keyword">implements</span> <span class="title">IStatusBar</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è®¾ç½®çŠ¶æ€æ å­—ä½“å›¾æ ‡ä¸ºæ·±è‰²ï¼Œéœ€è¦MIUI6ä»¥ä¸Š</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> isFontColorDark æ˜¯å¦æŠŠçŠ¶æ€æ å­—ä½“åŠå›¾æ ‡é¢œè‰²è®¾ç½®ä¸ºæ·±è‰²</div><div class="line">     * <span class="doctag">@return</span> boolean æˆåŠŸæ‰§è¡Œè¿”å›true</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">setStatusBarLightMode</span><span class="params">(Activity activity, <span class="keyword">boolean</span> isFontColorDark)</span> </span>&#123;</div><div class="line">        Window window = activity.getWindow();</div><div class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span> (window != <span class="keyword">null</span>) &#123;</div><div class="line">                Class clazz = window.getClass();</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    <span class="keyword">int</span> darkModeFlag = <span class="number">0</span>;</div><div class="line">                    Class layoutParams = Class.forName(<span class="string">"android.view.MiuiWindowManager$LayoutParams"</span>);</div><div class="line">                    Field field = layoutParams.getField(<span class="string">"EXTRA_FLAG_STATUS_BAR_DARK_MODE"</span>);</div><div class="line">                    darkModeFlag = field.getInt(layoutParams);</div><div class="line">                    Method extraFlagField = clazz.getMethod(<span class="string">"setExtraFlags"</span>, <span class="keyword">int</span>.class, <span class="keyword">int</span>.class);</div><div class="line">                    <span class="keyword">if</span> (isFontColorDark) &#123;</div><div class="line">                        extraFlagField.invoke(window, darkModeFlag, darkModeFlag);<span class="comment">//çŠ¶æ€æ é€æ˜ä¸”é»‘è‰²å­—ä½“</span></div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        extraFlagField.invoke(window, <span class="number">0</span>, darkModeFlag);<span class="comment">//æ¸…é™¤é»‘è‰²å­—ä½“</span></div><div class="line">                    &#125;</div><div class="line">                    result = <span class="keyword">true</span>;</div><div class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTypeName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> StatusBarAdapter.MIUI;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="é­…æ—çš„Flyme"><a href="#é­…æ—çš„Flyme" class="headerlink" title="é­…æ—çš„Flyme"></a>é­…æ—çš„Flyme</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * // Flyme</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> Cyning</div><div class="line"> * <span class="doctag">@since</span> 2017-04-05</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MeizuStatusBar</span> <span class="keyword">implements</span> <span class="title">IStatusBar</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è®¾ç½®çŠ¶æ€æ å›¾æ ‡ä¸ºæ·±è‰²å’Œé­…æ—ç‰¹å®šçš„æ–‡å­—é£æ ¼</div><div class="line">     * å¯ä»¥ç”¨æ¥åˆ¤æ–­æ˜¯å¦ä¸ºFlymeç”¨æˆ·</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> isFontColorDark æ˜¯å¦æŠŠçŠ¶æ€æ å­—ä½“åŠå›¾æ ‡é¢œè‰²è®¾ç½®ä¸ºæ·±è‰²</div><div class="line">     * <span class="doctag">@return</span> boolean æˆåŠŸæ‰§è¡Œè¿”å›true</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">setStatusBarLightMode</span><span class="params">(Activity activity, <span class="keyword">boolean</span> isFontColorDark)</span> </span>&#123;</div><div class="line">        Window window = activity.getWindow();</div><div class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span> (window != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    WindowManager.LayoutParams lp = window.getAttributes();</div><div class="line">                    Field darkFlag = WindowManager.LayoutParams.class</div><div class="line">                            .getDeclaredField(<span class="string">"MEIZU_FLAG_DARK_STATUS_BAR_ICON"</span>);</div><div class="line">                    Field meizuFlags = WindowManager.LayoutParams.class</div><div class="line">                            .getDeclaredField(<span class="string">"meizuFlags"</span>);</div><div class="line">                    darkFlag.setAccessible(<span class="keyword">true</span>);</div><div class="line">                    meizuFlags.setAccessible(<span class="keyword">true</span>);</div><div class="line">                    <span class="keyword">int</span> bit = darkFlag.getInt(<span class="keyword">null</span>);</div><div class="line">                    <span class="keyword">int</span> value = meizuFlags.getInt(lp);</div><div class="line">                    <span class="keyword">if</span> (isFontColorDark) &#123;</div><div class="line">                        value |= bit;</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        value &amp;= ~bit;</div><div class="line">                    &#125;</div><div class="line">                    meizuFlags.setInt(lp, value);</div><div class="line">                    window.setAttributes(lp);</div><div class="line">                    result = <span class="keyword">true</span>;</div><div class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTypeName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> StatusBarAdapter.FLYME;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Android-M"><a href="#Android-M" class="headerlink" title="Android M"></a>Android M</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.os.Build;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * // Android M</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> Cyning</div><div class="line"> * <span class="doctag">@since</span> 2017-04-05</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OSM</span> <span class="keyword">implements</span> <span class="title">IStatusBar</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@return</span> if version is lager than M</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">setStatusBarLightMode</span><span class="params">(Activity activity, <span class="keyword">boolean</span> isFontColorDark)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;</div><div class="line">            <span class="keyword">if</span> (isFontColorDark) &#123;</div><div class="line">                activity.getWindow().getDecorView().setSystemUiVisibility( View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN|View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR);</div><div class="line"></div><div class="line"><span class="comment">//                int uiVisibility = activity.getWindow().getDecorView().getSystemUiVisibility();</span></div><div class="line"><span class="comment">//                activity.getWindow().getDecorView().setSystemUiVisibility(uiVisibility | View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR);</span></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">int</span> uiVisibility = activity.getWindow().getDecorView().getSystemUiVisibility();</div><div class="line">                activity.getWindow().getDecorView().setSystemUiVisibility(uiVisibility| View.SYSTEM_UI_FLAG_VISIBLE);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTypeName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> StatusBarAdapter.OS_M;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æºä»£ç æ”¾åˆ°githubä¸Šäº†<a href="https://github.com/ownwell/StatusBarUtils" target="_blank" rel="external">githubé¡¹ç›®åœ°å€</a>.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘ä¸€ç›´å¿™ç€å†™ä¸šåŠ¡ï¼Œä¸€ç›´æ²¡ç²¾åŠ›æ›´æ–°åšå®¢ï¼Œè¶ç€æœ€è¿‘æœ‰ç‚¹ç©ºé—²äº‹ä»¶ï¼Œè§‰å¾—å¾ˆæœ‰å¿…è¦å†™ä¸€ç¯‡åšå®¢æ¡å›ä»¥å‰çš„é‚£ä¸ªçŠ¶æ€ã€‚å°±å†™ä¸€ä¸ªè‡ªå·±å½“æ—¶æ€»ç»“çš„ä¸€ä¸ªé€‚é…åŠŸèƒ½å§ï¼šå…³äºçŠ¶æ€æ çš„å­—ä½“/å›¾æ ‡é¢œè‰²é€‚é…ã€‚&lt;/p&gt;
&lt;p&gt;éšç€Android6.0 Android7.0ç³»ç»Ÿçš„ç³»ç»Ÿå‡çº§ï¼Œå¼€å‘è€…æ¥è¯´é€‚é…çš„å®¹æ˜“ç¨‹åº¦è¶Šæ¥è¶Šä½ï¼Œæˆ‘ä»¬éœ€è¦å°†ç²¾åŠ›æ”¾åˆ°é€‚é…4.4+ä»¥ä¸Šï¼Œè€ŒAndroid4.4ç›¸å¯¹æ¥è¯´æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¨³å®šçš„ç‰ˆæœ¬ï¼Œå°¤å…¶æ˜¯åœ¨UIä¸Šå®ƒåˆå’ŒAndroid 6.0ã€Android7.0æ¥è¿‘ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://ownwell.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://ownwell.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Classloaderæºç æ¢ç©¶</title>
    <link href="http://ownwell.github.io/2016/12/04/classloader/"/>
    <id>http://ownwell.github.io/2016/12/04/classloader/</id>
    <published>2016-12-03T16:00:00.000Z</published>
    <updated>2017-05-24T07:19:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>Javaä¸­çš„æ‰€æœ‰çš„javaéƒ½éœ€è¦å…ˆç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œå†é€šè¿‡ç±»åŠ è½½å™¨æ¥åŠ è½½classï¼Œåœ¨å‰å‡ ç¯‡çš„çƒ­ä¿®å¤çš„æ–‡ç« éƒ½æåˆ°äº†ClassLoaderï¼Œè¶ç€å‘¨æœ«å°±å†™äº†è¿™ç¯‡å…³äºJava ClassLoaderçš„æ–‡ç« ï¼Œå¸Œæœ›èƒ½å¯¹çƒ­ä¿®å¤çš„ç›¸å…³çš„çŸ¥è¯†è¿›è¡Œè¡¥å……ã€‚ä¸ºäº†æ›´å¥½æŸ¥çœ‹æºç ï¼Œæœ¬æ–‡æ˜¯åŸºäºJava 7çš„æºç æ¥åˆ†æçš„ï¼Œå¦‚æœ‰ä¸æ­£å–è¯·æ‰”ç –å‘ŠçŸ¥ã€‚</p>
<a id="more"></a>
<h1 id="ClassLoader"><a href="#ClassLoader" class="headerlink" title="ClassLoader"></a>ClassLoader</h1><h2 id="ä»€ä¹ˆæ˜¯ClassLoader"><a href="#ä»€ä¹ˆæ˜¯ClassLoader" class="headerlink" title="ä»€ä¹ˆæ˜¯ClassLoader"></a>ä»€ä¹ˆæ˜¯ClassLoader</h2><p>åœ¨javaçš„æºç ä¸­ï¼Œå®˜æ–¹æ˜¯è¿™ä¹ˆç»™å‡ºå®šä¹‰çš„:</p>
<blockquote>
<p>A class loader is an object that is responsible for loading classes. Theclass ClassLoader is an abstract class.Given the binary name of a class,a class loader should attempt to locate or generate data that constitutes a definition for the class. A  typical strategy is to transform the name intoa file name and then read a  â€œclass fileâ€ of that name from a file system.</p>
</blockquote>
<p>æ„æ€å°±æ˜¯ï¼š</p>
<blockquote>
<p>class loader æ˜¯ä¸€ä¸ªè´Ÿè´£åŠ è½½classçš„å¯¹è±¡ï¼ŒClassLoader ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚</p>
<p>è‹¥æ˜¯ç»™å‡ºä¸€ä¸ªç±»çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œclass loaderå°±ä¼šå°è¯•å®šä½åˆ°ç›¸å…³çš„ä½ç½®æˆ–è€…ç”Ÿæˆè¿™ä¸ªç±»çš„æ•°æ®ã€‚</p>
<p>ä¸€ä¸ªå…¸å‹çš„ç­–ç•¥æ˜¯æŠŠäºŒè¿›åˆ¶åå­—è½¬æ¢æˆæ–‡ä»¶åï¼Œç„¶åä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–è¿™ä¸ªæ–‡ä»¶åçš„class fileã€‚</p>
</blockquote>
<h2 id="ClassLoaderåˆ†ç±»"><a href="#ClassLoaderåˆ†ç±»" class="headerlink" title="ClassLoaderåˆ†ç±»"></a>ClassLoaderåˆ†ç±»</h2><p>Javaåº”ç”¨ç¯å¢ƒä¸­ä¸åŒçš„classåˆ†åˆ«ç”±ä¸åŒçš„ClassLoaderè´Ÿè´£åŠ è½½ã€‚ä»ä¸€ä¸ªJVMå¯åŠ¨åˆ°åŠ è½½å’±ä»¬çš„ä¸»ç¨‹åºå…¥å£ï¼Œä»¥ä¸‹ClassLoaderæ˜¯å¿…é¡»è¦åŠ è½½çš„ã€‚</p>
<ol>
<li><p>Bootstrap ClassLoader è´Ÿè´£åŠ è½½javaåŸºç¡€ç±»ï¼Œä¸»è¦æ˜¯ %JRE_HOME/lib/ ç›®å½•ä¸‹çš„rt.jarã€resources.jarã€charsets.jarå’Œclassç­‰</p>
</li>
<li><p>Extension ClassLoader è´Ÿè´£åŠ è½½javaæ‰©å±•ç±»ï¼Œä¸»è¦æ˜¯ %JRE_HOME/lib/ext ç›®å½•ä¸‹çš„jarå’Œclass</p>
</li>
<li><p>App ClassLoader è´Ÿè´£åŠ è½½å½“å‰javaåº”ç”¨çš„classpathä¸­çš„æ‰€æœ‰ç±»ã€‚</p>
</li>
<li><p>Custom ClassLoader å½“ç„¶ç”±äºç±»åŠ è½½å™¨ä¹Ÿæ˜¯å¯ä»¥è‡ªå·±å®šä¹‰ï¼Œå› ä¸ºClassLoaderæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚</p>
</li>
</ol>
<p>å½“æˆ‘ä»¬å»loadä¸€ä¸ªclassæ—¶ï¼Œä¼šç»å†è¿™ä¹ˆæ›²æŠ˜çš„è·¯ç¨‹ï¼š</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1480842334056.png" width="789" id="#ddd"></p>
<p>ä¸ºä»€ä¹ˆåŠ è½½ä¸€ä¸ªclasséœ€è¦è¿™ä¹ˆéº»çƒ¦ï¼Œç›´æ¥åŠ è½½ä¸å°±è¡Œäº†ä¹ˆï¼Ÿ<br>è¿™å°±æ˜¯æˆ‘ä»¬ä¸‹é¢å°†è¦æåˆ°çš„<strong>ClassLoaderçš„åŒäº²å§”æ‰˜æ¨¡å‹</strong>ã€‚</p>
<h2 id="ClassLoaderçš„åŒäº²å§”æ‰˜æ¨¡å‹"><a href="#ClassLoaderçš„åŒäº²å§”æ‰˜æ¨¡å‹" class="headerlink" title="ClassLoaderçš„åŒäº²å§”æ‰˜æ¨¡å‹"></a>ClassLoaderçš„åŒäº²å§”æ‰˜æ¨¡å‹</h2><p>åœ¨ä»‹ç»ä¹‹å‰æˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥çœ‹ä¸‹ClassLoaderä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="keyword">boolean</span> resolve) &#123;</div><div class="line">        â€¦â€¦</div><div class="line"></div><div class="line">         <span class="keyword">try</span> &#123;</div><div class="line">               <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</div><div class="line">                        c = parent.loadClass(name, <span class="keyword">false</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        c = findBootstrapClassOrNull(name);</div><div class="line">                &#125;</div><div class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</div><div class="line">                    <span class="comment">// ClassNotFoundException thrown if class not found</span></div><div class="line">                    <span class="comment">// from the non-null parent class loader</span></div><div class="line">                &#125;</div><div class="line"></div><div class="line">          â€¦â€¦</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œä¸Šä»£ç å°è¯•æ‰“å°ä¸‹çœ‹çœ‹parentæ˜¯ä½•æ–¹ç¥åœ£å§:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        ClassLoader mClassLoader = Main.class.getClassLoader();</div><div class="line">        <span class="keyword">while</span> (mClassLoader != <span class="keyword">null</span>) &#123;</div><div class="line">            System.out.println(mClassLoader);</div><div class="line">            mClassLoader = mClassLoader.getParent();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ:</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1480844019934.png" width="362"></p>
<p>Launcher$AppClassLoader å°±æ˜¯åŠ è½½é¡¹ç›®æ–‡ä»¶çš„ClassLoaderï¼ŒExtClassLoaderæ˜¯AppClassLoaderçš„parentã€‚</p>
<p>åœ¨åŠ è½½ä¸€ä¸ªclassæ—¶ï¼Œä»–ä¼šå…ˆå»ä»–çš„parentçš„ClassLoaderæœ‰æ²¡æœ‰ï¼Œå®åœ¨æ²¡æœ‰æ‰è°ƒç”¨<code>&#39;findBootstrapClassOrNull</code>.<br>è¿™å°±æ˜¯æˆ‘ä»¬è¦è¯´çš„<strong>ClassLoaderçš„åŒäº²å§”æ‰˜æ¨¡å‹</strong><br>åœ¨<a href="#ddd">ä¸Šå›¾</a>ä»‹ç»ä¸­, å…ˆå§”æ‰˜çˆ¶ç±»è£…è½½å™¨å¯»æ‰¾ç›®æ ‡ç±»ï¼Œåªæœ‰åœ¨æ‰¾ä¸åˆ°çš„æƒ…å†µä¸‹æ‰ä»è‡ªå·±çš„ç±»è·¯å¾„ä¸­æŸ¥æ‰¾å¹¶è£…è½½ç›®æ ‡ç±»ã€‚<br>å¯æ˜¯ä¸ºä»€ä¹ˆéœ€è¦è¿™ç§åŒäº²å§”æ‰˜æ¨¡å‹å‘¢ï¼Œæˆ‘ä»¬ä¸æ˜¯è¯´å¥½çš„importå‘¢ï¼Ÿ</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1480847246096.png" width="400"></p>
<h1 id="å…³äºè‡ªå®šä¹‰ClassLoader"><a href="#å…³äºè‡ªå®šä¹‰ClassLoader" class="headerlink" title="å…³äºè‡ªå®šä¹‰ClassLoader"></a>å…³äºè‡ªå®šä¹‰ClassLoader</h1><p>è¯´äº†è¿™ä¹ˆå¤šClassLoader,å°±æ˜¯ä¸ºäº†æ›´å¥½çš„ä½¿ç”¨ï¼Œç”±äºä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å®šåˆ¶ClassLoaderï¼Œè¿™æ—¶å€™å°±éœ€è¦è‡ªå®šä¹‰ClassLoaderäº†.</p>
<p>è¿˜è®°å¾—ä¸ï¼ŒClassLoaderæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå½“ç»§æ‰¿ClassLoaderæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™ä¸€äº›æ–¹æ³•ã€‚ä¸»è¦å¯ä»¥æ‰©å±•çš„æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>findClass          å®šä¹‰æŸ¥æ‰¾Classçš„æ–¹å¼<br></li>
<li>defineClass        å°†ç±»æ–‡ä»¶å­—èŠ‚ç åŠ è½½ä¸ºjvmä¸­çš„class<br></li>
<li>findResource       å®šä¹‰æŸ¥æ‰¾èµ„æºçš„æ–¹å¼<br></li>
</ul>
<p>å¥½äº†ï¼Œç¿ èŠ±ä¸Šä»£ç ï¼Œè‡ªå·±ç”¨äº†20åˆ†é’Ÿå†™äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ClassLoaderï¼Œé‡Œé¢æœ‰æ³¨é‡Šå°±ä¸å†ä¸€ä¸€è§£é‡Šäº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.net.URL;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@Author</span>: cyning</div><div class="line"> * <span class="doctag">@Desc</span> : åŠ è½½æœ¬åœ°çš„æ–‡ä»¶</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String rootUrl;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomClassLoader</span><span class="params">(String rootUrl)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.rootUrl = rootUrl;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</div><div class="line">        Class clazz = <span class="keyword">null</span>;<span class="comment">//this.findLoadedClass(name); // çˆ¶ç±»å·²åŠ è½½</span></div><div class="line">        <span class="keyword">byte</span>[] classData = getClassData(name);  <span class="comment">//æ ¹æ®ç±»çš„äºŒè¿›åˆ¶åç§°,è·å¾—è¯¥classæ–‡ä»¶çš„å­—èŠ‚ç æ•°ç»„</span></div><div class="line">        <span class="keyword">if</span> (classData == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException();</div><div class="line">        &#125;</div><div class="line">        clazz = defineClass(name, classData, <span class="number">0</span>, classData.length);  <span class="comment">//å°†classçš„å­—èŠ‚ç æ•°ç»„è½¬æ¢æˆClassç±»çš„å®ä¾‹</span></div><div class="line">        <span class="comment">//&#125;</span></div><div class="line">        <span class="keyword">return</span> clazz;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span>  <span class="keyword">byte</span>[]  getClassData(String name) &#123;</div><div class="line">        InputStream is = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            String path = classNameToPath(name);</div><div class="line">            URL url = <span class="keyword">new</span> URL(path);</div><div class="line">            <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">4</span>];</div><div class="line">            <span class="keyword">int</span> len = -<span class="number">1</span>;</div><div class="line">            is = url.openStream();</div><div class="line">            ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</div><div class="line">            <span class="keyword">while</span>((len = is.read(buff)) != -<span class="number">1</span>) &#123;</div><div class="line">                baos.write(buff,<span class="number">0</span>,len);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> baos.toByteArray();</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">if</span> (is != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    is.close();</div><div class="line">                &#125; <span class="keyword">catch</span>(IOException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span>   String <span class="title">classNameToPath</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> rootUrl + <span class="string">"/"</span> + name.replace(<span class="string">"."</span>, <span class="string">"/"</span>) + <span class="string">".class"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ€ä¹ˆä½¿ç”¨å‘¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// æ–‡ä»¶è·¯å¾„</span></div><div class="line">            String rootUrl = <span class="string">"/Users/cyning/Downloads"</span>;</div><div class="line">            CustomClassLoader mCustomClassLoader = <span class="keyword">new</span> CustomClassLoader(rootUrl);</div><div class="line">            String classname = <span class="string">"com.ownwell.Test"</span>;</div><div class="line">            Class clazz = mCustomClassLoader.loadClass(classname);</div><div class="line">            Object object = clazz.newInstance();</div><div class="line">            Method mMethod  = clazz.getMethod(<span class="string">"add"</span>, <span class="keyword">int</span>.class, <span class="keyword">int</span>.class);<span class="comment">//ç„¶åæˆ‘ä»¬å°±å¯ä»¥ç”¨åå°„åšäº›äº‹æƒ…äº†</span></div><div class="line">            mMethod.invoke(object,<span class="number">1</span>,<span class="number">1</span>);</div><div class="line"></div><div class="line">            <span class="comment">//åå°„è°ƒç”¨Testä¸­çš„addæ–¹æ³•</span></div><div class="line">            System.out.println(clazz.getClassLoader());</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol>
<li>ClassLoaderæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå¯¹å¤–å…è®¸ç»§æ‰¿ã€‚</li>
<li>ClassLoaderæœ‰è‡ªå·±çš„åŒäº²å§”æ‰˜æ¨¡å‹ï¼Œä»ä¸‹åˆ°ä¸Šå±‚å±‚æ£€æŸ¥ã€‚</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Javaä¸­çš„æ‰€æœ‰çš„javaéƒ½éœ€è¦å…ˆç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œå†é€šè¿‡ç±»åŠ è½½å™¨æ¥åŠ è½½classï¼Œåœ¨å‰å‡ ç¯‡çš„çƒ­ä¿®å¤çš„æ–‡ç« éƒ½æåˆ°äº†ClassLoaderï¼Œè¶ç€å‘¨æœ«å°±å†™äº†è¿™ç¯‡å…³äºJava ClassLoaderçš„æ–‡ç« ï¼Œå¸Œæœ›èƒ½å¯¹çƒ­ä¿®å¤çš„ç›¸å…³çš„çŸ¥è¯†è¿›è¡Œè¡¥å……ã€‚ä¸ºäº†æ›´å¥½æŸ¥çœ‹æºç ï¼Œæœ¬æ–‡æ˜¯åŸºäºJava 7çš„æºç æ¥åˆ†æçš„ï¼Œå¦‚æœ‰ä¸æ­£å–è¯·æ‰”ç –å‘ŠçŸ¥ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Javaæºç " scheme="http://ownwell.github.io/categories/Java%E6%BA%90%E7%A0%81/"/>
    
    
      <category term="Java" scheme="http://ownwell.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>çƒ­ä¿®å¤ä¹‹ç¾å›¢æ–¹æ¡ˆ</title>
    <link href="http://ownwell.github.io/2016/09/30/%E7%83%AD%E4%BF%AE%E5%A4%8D%E4%B9%8B%E7%BE%8E%E5%9B%A2%E6%96%B9%E6%A1%88/"/>
    <id>http://ownwell.github.io/2016/09/30/çƒ­ä¿®å¤ä¹‹ç¾å›¢æ–¹æ¡ˆ/</id>
    <published>2016-09-30T11:49:24.000Z</published>
    <updated>2017-04-19T05:57:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ç ”ç©¶çƒ­ä¿®å¤çš„ä¸€äº›æ¡†æ¶ï¼Œå‘ç°ç›®å‰å¸‚é¢ä¸Šæœ‰å¾ˆå¤šçš„çƒ­ä¿®å¤çš„ä¸€äº›æ€æƒ³å’Œæ¡†æ¶ï¼Œæœ‰è…¾è®¯ã€é˜¿é‡Œã€ç¾å›¢ç­‰å¤§å‹APPä¸€äº›å®è·µè¿‡çš„ï¼Œæœ‰ä¸ºæˆ‘ä»¬å¤§å®¶æ‰©å±•æ€è·¯çš„Demoï¼Œä½†æ˜¯è¿™äº›çƒ­ä¿®å¤æŠ€æœ¯çš„æ´»è·ƒè€Œè“¬å‹ƒå‘å±•ï¼Œè®©æˆ‘ä»¬æœ‰æ›´å¤šçš„é€‰æ‹©ã€‚<br><a id="more"></a><br>ä½†æ˜¯æŒ‰ç…§å®ç°æ–¹å¼ä¸Šï¼ŒAndroidçƒ­è¡¥ä¸æŠ€æœ¯åº”è¯¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªæµæ´¾ï¼š</p>
<ul>
<li><p>Nativeï¼Œä»£è¡¨æœ‰é˜¿é‡Œçš„Dexposedã€<a href="https://github.com/alibaba/AndFix" target="_blank" rel="external">AndFix</a>ä¸è…¾è®¯çš„å†…éƒ¨æ–¹æ¡ˆKKFixï¼›     </p>
</li>
<li><p>Java, ä»£è¡¨æœ‰Qzoneçš„è¶…çº§è¡¥ä¸Dexæ’æ¡©çš„æ–¹å¼ã€<a href="https://github.com/jasonross/Nuwa" target="_blank" rel="external">å¤§ä¼—ç‚¹è¯„çš„nuwa</a>ã€<a href="https://github.com/dodola/RocooFix" target="_blank" rel="external">ç™¾åº¦é‡‘èçš„rocooFix</a>, é¥¿äº†ä¹ˆçš„<a href="https://github.com/eleme/Amigo/" target="_blank" rel="external">amigo</a>ä»¥åŠç¾å›¢çš„robustã€‚</p>
</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬ä¸åšæ‹“å±•ï¼ŒQzoneçš„è¶…çº§è¡¥ä¸Dexæ’æ¡©çš„æ–¹å¼ä¹‹å‰è®²è¿‡å•¦ï¼Œå°±ä¸åœ¨å•°å—¦ï¼Œä»Šå¤©æˆ‘ä»¬è¦åˆ†æçš„æ˜¯ç¾å›¢çš„<code>robust</code>.ç¾å›¢çš„<code>robust</code>æš‚æ—¶è¿˜æ²¡å¼€æºï¼Œä¸è¿‡ç¾å›¢å…¬å¸ƒäº†ä»–ä»¬çš„å®è·µæ€è·¯ â€”-<a href="http://tech.meituan.com/android_robust.html" target="_blank" rel="external">Androidçƒ­æ›´æ–°æ–¹æ¡ˆRobust</a>ã€‚</p>
<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p><code>Robustæ’ä»¶</code>å¯¹æ¯ä¸ªäº§å“ä»£ç çš„æ¯ä¸ªå‡½æ•°éƒ½åœ¨ç¼–è¯‘æ‰“åŒ…é˜¶æ®µè‡ªåŠ¨çš„æ’å…¥äº†ä¸€æ®µä»£ç ,è¿™æ®µä»£ç å®é™…ä¸Šç›¸å½“äºå¤šäº†ä¸ªåˆ†æ”¯ï¼Œå½“æ»¡è¶³è¿™äº›åˆ†æ”¯æ—¶æ‰§è¡Œè¿™æ®µæ–°åŠ å…¥çš„ä»£ç ã€‚</p>
<p>åœ¨å¼€å§‹ä¹‹å‰è¿˜æ˜¯ç»™å¤§å®¶è®²ä¸€ä¸ªè°æˆ˜ç‰‡ï¼š<br>å‰§æƒ…æ˜¯è¿™æ ·æ»´ï¼Œé‚£æ˜¯ä¸€ä¸ªæˆ˜äº‰å¹´ä»£ï¼ŒæŸçº¢è‰²ç‰¹åŠ¡æœºæ„åœ¨æ•Œæ–¹çš„å„ä¸ªè¿é˜Ÿéƒ½æœ‰ä¸€ä¸ªé—´è°çš„å‘ï¼Œå½“æœ‰å¤§æ´»åŠ¨å‘ç”Ÿæ—¶â€ä¸Šå¤´â€éƒ½ä¼šä¸‹å‘ä¸€ä¸ªæ›¿æ¢å‘½ä»¤åˆ°æ•Œæ–¹å„ä¸ªè¿é˜Ÿé‡Œã€‚å½“é—´è°æ”¶åˆ°ä¿¡æ¯åï¼Œçœ‹åˆ°æ»¡è¶³â€ä¸Šå¤´â€ç»™å‡ºçš„ä¿¡æ¯ï¼ˆè¿é˜Ÿåç§°ã€å¯¹åº”çš„ä»£ç ï¼‰å’Œè‡ªå·±çš„ä¸€æ¨¡ä¸€æ ·æ—¶æ—¶ï¼Œå°±æ„å‘³ç€è‡ªå·±éœ€è¦å®Œæˆä¸Šçº§ç»™çš„ä»»åŠ¡ï¼ŒåŒæ—¶æ¥åº”åŒå¿—æ¥ä¼ªè£…å®Œæˆâ€ä¸Šå¤´â€ä¸‹å‘çš„ä»»åŠ¡ã€‚å¯¹äºé‚£äº›ä¸æ»¡è¶³ä¸Šå¤´ç»™äºˆçš„ä¿¡æ¯çš„é—´è°ï¼Œä»åŸåœ°å¾…å‘½.</p>
<p><code>Robustæ’ä»¶</code>çƒ­ä¿®å¤å…¶å®å’Œè¿™ä¸ªè°æˆ˜çš„å‰§æƒ…ä¸€æ ·ä¸€æ ·æ»´ï¼Œä¸Šå¤´ä¸‹å‘çš„ä¿¡æ¯ï¼Œä¼šå‘Šè¯‰æˆ‘ä»¬ä¸‹å‘çš„è¿é˜Ÿåç§°å’Œæ¥åº”æˆ‘ä»¬å»å®æ–½çš„äººï¼Œè¿™äº›ä½ç½®ä¿¡æ¯å…¶å®å°±æ˜¯å‡ºé—®é¢˜çš„é‚£ä¸ªç±»ï¼Œéœ€è¦æ‰“è¡¥ä¸ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>è¡¥ä¸ç±»</strong>ï¼Œæœ‰äººæ¥æ›¿å§åº•å®æ–½ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>é”²å­ç±»</strong>ã€‚</p>
<p>å¥½äº†å›å½’ä»£ç ï¼Œæ¥çœ‹ä¸‹ç¾å›¢æŠ€æœ¯å›¢é˜Ÿçš„å¤§æ¦‚æ€è·¯ã€‚</p>
<p>æ—§ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getIndex</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">100L</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p><span id="qw">è¢«å¤„ç†æˆå¦‚ä¸‹çš„å®ç°</span><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> ChangeQuickRedirect     changeQuickRedirect;    </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getIndex</span><span class="params">()</span> </span>&#123;    </div><div class="line">        <span class="keyword">if</span>(changeQuickRedirect != <span class="keyword">null</span>) &#123;    </div><div class="line">            <span class="comment">//PatchProxyä¸­å°è£…äº†è·å–å½“å‰classNameå’ŒmethodNameçš„é€»è¾‘ï¼Œå¹¶åœ¨å…¶å†…éƒ¨æœ€ç»ˆè°ƒç”¨äº†changeQuickRedirectçš„å¯¹åº”å‡½æ•°</span></div><div class="line">            <span class="keyword">if</span>(PatchProxy.isSupport(<span class="keyword">new</span> Object[<span class="number">0</span>], <span class="keyword">this</span>, changeQuickRedirect, <span class="keyword">false</span>)) &#123;     </div><div class="line">                <span class="keyword">return</span> ((Long)PatchProxy.accessDispatch(<span class="keyword">new</span> Object[<span class="number">0</span>], <span class="keyword">this</span>, changeQuickRedirect, <span class="keyword">false</span>)).longValue();    </div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">100L</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p><code>ChangeQuickRedirect</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ¯ä¸ªç±»ä¸­éƒ½æœ‰è¿™ä¸ªé™æ€å˜é‡ï¼Œè¿™å°±ç›¸å½“äºé‚£ä¸ªå§åº•ï¼Œä¸è¿‡ä»–æ˜¯ä¸ªæ¥å£.</p>
<p>ä¸‹å‘è¡¥ä¸ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PatchesInfoImpl</span> <span class="keyword">implements</span> <span class="title">PatchesInfo</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;PatchedClassInfo&gt; <span class="title">getPatchedClassesInfo</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;PatchedClassInfo&gt; patchedClassesInfos = <span class="keyword">new</span> ArrayList&lt;PatchedClassInfo&gt;();</div><div class="line">        PatchedClassInfo patchedClass = <span class="keyword">new</span> PatchedClassInfo(<span class="string">"com.meituan.sample.d"</span>, StatePatch.class.getCanonicalName());</div><div class="line">        patchedClassesInfos.add(patchedClass);</div><div class="line">        <span class="keyword">return</span> patchedClassesInfos;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>ä¸Šè¿°ä»£ç å°±æ˜¯è§£é‡Š com.meituan.sample.dï¼ˆæ··æ·†åçš„ï¼‰éœ€è¦éœ€è¦ä¿®å¤ï¼Œå¹¶ä¸”æ’å…¥çš„é”²å­ç±»StatePatch.class.getCanonicalName()</p>
</blockquote>
<p>å½“appåŠ è½½æ—¶é€šè¿‡<code>PatchesInfoImpl</code>è¿™ä¸ªç±»ä¸­çš„getPatchedClassesInfoçš„ä¿¡æ¯ï¼Œæ¥è·å–é‚£äº›éœ€è¦æ‰“è¡¥ä¸ï¼ˆè€Œä¸æ˜¯æ¯ä¸ªç±»éƒ½æ‰“è¡¥ä¸ï¼Œè¿™å°±ç›¸å½“äºä¸‹å‘è¡¥ä¸ç±»ï¼‰ï¼Œä»¥åŠå°†è¡¥ä¸é”²å­æ›¿æ¢ä¹‹å‰ç±»çš„é”²å­ï¼ˆå®é™…ä¸Šå°±æ˜¯ç”¨æˆ‘ä»¬ä¸‹å‘çš„ChangeQuickRedirectæ¥æ›¿æ¢è¡¥ä¸ç±»çš„ChangeQuickRedirectçš„é™æ€å˜é‡ã€‚ï¼‰</p>
<p>Stateç±»çš„é”²å­ç±» StatePatch.java  è¿™å°±æ˜¯æˆ‘ä»¬è¯´çš„éœ€è¦èµ‹å€¼ç»™patchç±»çš„é”²å­ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StatePatch</span> <span class="keyword">implements</span> <span class="title">ChangeQuickRedirect</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">accessDispatch</span><span class="params">(String methodSignature, Object[] paramArrayOfObject)</span> </span>&#123;</div><div class="line">        String[] signature = methodSignature.split(<span class="string">":"</span>);</div><div class="line">        <span class="keyword">if</span> (TextUtils.equals(signature[<span class="number">1</span>], <span class="string">"a"</span>)) &#123;<span class="comment">//long getIndex() -&gt; a</span></div><div class="line">            <span class="keyword">return</span> <span class="number">106</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSupport</span><span class="params">(String methodSignature, Object[] paramArrayOfObject)</span> </span>&#123;</div><div class="line">        String[] signature = methodSignature.split(<span class="string">":"</span>);</div><div class="line">        <span class="keyword">if</span> (TextUtils.equals(signature[<span class="number">1</span>], <span class="string">"a"</span>)) &#123;<span class="comment">//long getIndex() -&gt; a</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªå¤§æ¦‚å°±æ˜¯åˆ¤æ–­å½“å‰æ–¹æ³•æ˜¯ä¸æ˜¯aï¼ˆlong getIndex() æ··æ·†åçš„ï¼‰ï¼Œè¦æ˜¯å°±æ‰§è¡Œ<code>accessDispatch()</code>,è¿™ä¸ªæ˜¯å§è¿”å›å€¼ç»™æ”¹æˆäº†106ã€‚<br>å¤§æ¦‚æµç¨‹å›¾:<br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/meituan_patch.png" alt=""></p>
<h1 id="åˆæ­¥å®ç°"><a href="#åˆæ­¥å®ç°" class="headerlink" title="åˆæ­¥å®ç°"></a>åˆæ­¥å®ç°</h1><p>ç”±äºåªæ˜¯åŸç†æ€§è°ƒç ”ï¼ŒåŠ ä¸Šç°åœ¨ç¾å›¢æå‡ºè¿™ä¸ªçƒ­ä¿®åä¸€ç›´æœªæ”¾å‡ºæºç ï¼Œæˆ‘æŒ‰æºä¸ä½è‡ªå·±æ¨¡ä»¿å®ç°äº†ä¸€ä¸ªdemoï¼Œå¯ä»¥åˆ†äº«ç»™å¤§å®¶ã€‚</p>
<h1 id="å…³é”®ä»£ç å®ç°"><a href="#å…³é”®ä»£ç å®ç°" class="headerlink" title="å…³é”®ä»£ç å®ç°"></a>å…³é”®ä»£ç å®ç°</h1><ul>
<li><a href="#PatchedClassInfo">PatchedClassInfo</a> å­˜æ”¾ä¸‹å‘patchç±»å’Œé”²å­ç±»</li>
<li><a href="#PatchProxy">PatchProxy å·¥å…·ç±»</a><br>é€šè¿‡ä¸Šä¸‹æ–‡è·å–æ–¹æ³•çš„åç§°å’Œå‚æ•°ï¼Œä»¥åŠæ‰§è¡ŒChangeQuickRedirectä¸­çš„æ–¹æ³•ï¼Œ<a href="#qw">å‚çœ‹ä¹‹å‰çš„å®ç°getIndex()</a>çš„ç¬¬5è¡Œã€ç¬¬6è¡Œã€‚</li>
<li><a href="">loadDex()</a></li>
</ul>
<p><span id="PatchedClassInfo">PatchedClassInfo.java</span><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PatchedClassInfo</span> </span>&#123;</div><div class="line"></div><div class="line">    String clazz;<span class="comment">//patchç±»</span></div><div class="line">    String pathRedicIMpl;<span class="comment">//é”²å­ç±»</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PatchedClassInfo</span><span class="params">(String clazz, String pathRedicIMpl)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.clazz = clazz;</div><div class="line">        <span class="keyword">this</span>.pathRedicIMpl = pathRedicIMpl;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getClazz</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> clazz;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPathRedicIMpl</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> pathRedicIMpl;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><span id="PatchProxy">PatchProxy.java</span><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PatchProxy</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> param</div><div class="line">     * <span class="doctag">@param</span> object classçš„å®ä¾‹å¯¹è±¡</div><div class="line">     * <span class="doctag">@param</span> changeQuickRedirect</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSupport</span><span class="params">( Object object, ChangeQuickRedirect changeQuickRedirect, Object... param)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span> (changeQuickRedirect != <span class="keyword">null</span>)&#123;</div><div class="line">            String  methodSignature  = <span class="keyword">new</span> Throwable().getStackTrace()[<span class="number">1</span>].getMethodName();</div><div class="line">            Object[] paramArrayOfObject = param;</div><div class="line">            <span class="keyword">return</span> changeQuickRedirect.isSupport(methodSignature,paramArrayOfObject);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> Object <span class="title">accessDispatch</span><span class="params">(Object object, ChangeQuickRedirect changeQuickRedirect, Object... param)</span></span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (changeQuickRedirect != <span class="keyword">null</span>)&#123;</div><div class="line">            String  methodSignature = <span class="keyword">new</span> Throwable().getStackTrace()[<span class="number">1</span>].getMethodName();</div><div class="line">            Object[] paramArrayOfObject = param;</div><div class="line">            <span class="keyword">return</span> changeQuickRedirect.accessDispatch(methodSignature,paramArrayOfObject);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><span id="loaddex">loadDex()</span><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadDex</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//åŠ è½½patch.jar</span></div><div class="line">        File dexPath = <span class="keyword">new</span> File(getDir(<span class="string">"dex"</span>, Context.MODE_PRIVATE), <span class="string">"patch.jar"</span>);</div><div class="line"><span class="comment">//        æ–°å»ºä¸€ä¸ªclassloader</span></div><div class="line">        DexClassLoader cl = <span class="keyword">new</span> DexClassLoader(dexPath.getAbsolutePath(),</div><div class="line">                dexPath.getAbsolutePath(), <span class="keyword">null</span>, getClassLoader());</div><div class="line">        Class libProviderClazz = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// ä»patch.java åŠ è½½ä¸‹å‘ç±»</span></div><div class="line">            libProviderClazz = cl.loadClass(<span class="string">"com.baidu.meituanhotfix.dex.PatchesInfoImpl"</span>);</div><div class="line"></div><div class="line">            PatchesInfo patchesInfo = (PatchesInfo) libProviderClazz.newInstance();</div><div class="line"></div><div class="line">            <span class="comment">// è·å–ä¸‹å‘ä¿¡æ¯ ï¼Œè¿™æ˜¯ä¸€ä¸ªlist æ¯ä¸€æ¡å­˜æ”¾patchç±»å’Œæ¯ä¸ªpatchçš„æ¥”å­ç±»</span></div><div class="line">            patchs = patchesInfo.getPatchedClassesInfo();</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (PatchedClassInfo cls : patchs) &#123;</div><div class="line"></div><div class="line"><span class="comment">//                patchç±»</span></div><div class="line">                Class hostClazz = getClassLoader().loadClass(cls.getClazz());</div><div class="line"><span class="comment">//                patchç±»å¯¹åº”çš„æ¥”å­ç±»</span></div><div class="line">                Class implClazz = cl.loadClass(cls.getPathRedicIMpl());</div><div class="line"><span class="comment">//                å®ä¾‹åŒ–æ¥”å­ç±»</span></div><div class="line">                ChangeQuickRedirect impl = (ChangeQuickRedirect) implClazz.newInstance();</div><div class="line"></div><div class="line"><span class="comment">//                å°†åˆšæ‰å®ä¾‹åŒ–ä¹‹åçš„èµ‹å€¼ç»™patch</span></div><div class="line">                Field[] fields = hostClazz.getFields();</div><div class="line">                <span class="keyword">if</span> (fields != <span class="keyword">null</span> &amp;&amp; fields.length &gt; <span class="number">0</span>) &#123;</div><div class="line">                    Field field = hostClazz.getField(<span class="string">"changeQuickRedirect"</span>);</div><div class="line">                    field.set(hostClazz, impl);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>é¡¹ç›®å·²ç»å¼€æºåˆ°github <a href="https://github.com/ownwell/MeituanHotFix" target="_blank" rel="external">MeituanHotFix</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åœ¨ç ”ç©¶çƒ­ä¿®å¤çš„ä¸€äº›æ¡†æ¶ï¼Œå‘ç°ç›®å‰å¸‚é¢ä¸Šæœ‰å¾ˆå¤šçš„çƒ­ä¿®å¤çš„ä¸€äº›æ€æƒ³å’Œæ¡†æ¶ï¼Œæœ‰è…¾è®¯ã€é˜¿é‡Œã€ç¾å›¢ç­‰å¤§å‹APPä¸€äº›å®è·µè¿‡çš„ï¼Œæœ‰ä¸ºæˆ‘ä»¬å¤§å®¶æ‰©å±•æ€è·¯çš„Demoï¼Œä½†æ˜¯è¿™äº›çƒ­ä¿®å¤æŠ€æœ¯çš„æ´»è·ƒè€Œè“¬å‹ƒå‘å±•ï¼Œè®©æˆ‘ä»¬æœ‰æ›´å¤šçš„é€‰æ‹©ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://ownwell.github.io/categories/Android/"/>
    
    
      <category term="Androidçƒ­ä¿®å¤" scheme="http://ownwell.github.io/tags/Android%E7%83%AD%E4%BF%AE%E5%A4%8D/"/>
    
  </entry>
  
  <entry>
    <title>Androidçƒ­ä¿®å¤--å®ç°åŸç†</title>
    <link href="http://ownwell.github.io/2016/08/30/android-hot-fix-introduce/"/>
    <id>http://ownwell.github.io/2016/08/30/android-hot-fix-introduce/</id>
    <published>2016-08-30T09:18:11.000Z</published>
    <updated>2017-05-24T07:19:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>å…³äºçƒ­ä¿®å¤å…¶å®å¾ˆæ—©éƒ½æƒ³åŠ¨æ‰‹å†™ï¼Œä¸è¿‡ç”±äºæ²¡ç ”ç©¶è¿‡å…·ä½“çš„å®è·µï¼Œä¸æ•¢ä¹±è°ˆã€‚<br>é‚£ä¹ˆä½•ä¸ºçƒ­ä¿®å¤å‘¢ï¼Ÿæ‰€è°“çƒ­ä¿®å¤ï¼Œæ— éæ˜¯çº¿ä¸Šå‡ºäº†bugï¼Œå¼€å‘äººå‘˜å¯ä»¥å‘è¡¥ä¸ï¼Œåº”ç”¨ç¨‹åºé»˜é»˜ä¸‹è½½å¥½å¯¹åº”é—®é¢˜çš„è¡¥ä¸ï¼Œä¿®å¤è¿™ä¸ªbugã€‚è¿™ç§çƒ­ä¿®å¤å…¶å®å¾ˆé€‚åˆclient-serverçš„æ¨¡å¼ï¼Œå½“ç„¶äº†å®¢æˆ·ç«¯è‚¯å®šä¹Ÿæ˜¯é€‚ç”¨çš„ã€‚</p>
<a id="more"></a>
<p>çƒ­ä¿®å¤/çƒ­éƒ¨ç½² æœ€æ—©ä½¿ç”¨åœ¨webåç«¯çš„ï¼Œè‡³äºå®¢æˆ·ç«¯çƒ­ä¿®å¤ï¼Œæœ€æ—©å¬åˆ°çƒ­ä¿®å¤æ˜¯2014å¹´ï¼Œå½“æ—¶åœ¨é˜¿é‡ŒæŠ€æœ¯å˜‰å¹´ååˆ†äº«ä¼šä¸Šï¼Œé˜¿é‡Œåˆ†äº«çš„æ’ä»¶åŒ–éƒ¨ç½²ä¸“é¢˜ä¸­è®²åˆ°å…¶ä¸­çš„çƒ­ä¿®å¤ã€‚åè€Œåœ¨å»å¹´ï¼ˆ2015å¹´ï¼‰ï¼Œå‡ºäº†å¾ˆå¤šçƒ­ä¿®å¤å’Œæ’ä»¶åŒ–çš„æ¡†æ¶ï¼Œå¯ä»¥è¯´æ˜¯æ’ä»¶åŒ–/çƒ­éƒ¨ç½²å…ƒå¹´ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬è½åäº†åŠå¹´ï¼Œæ‰€ä»¥èµ¶å¿«è¡¥ä¸Šçƒ­ä¿®å¤è¿™ä¸€ç« ã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1472549584377.png" width="350"></p>
<h1 id="ä¸ºä»€ä¹ˆéœ€è¦çƒ­ä¿®å¤"><a href="#ä¸ºä»€ä¹ˆéœ€è¦çƒ­ä¿®å¤" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦çƒ­ä¿®å¤"></a>ä¸ºä»€ä¹ˆéœ€è¦çƒ­ä¿®å¤</h1><p>ä¸Šå‘¨å»ç™¾åº¦ï¼Œå’Œ<a href="http://blog.csdn.net/lmj623565791/" target="_blank" rel="external">é¸¿æ´‹</a>æœ‰è¿‡äº¤æµï¼Œå½“æ—¶ï¼Œé¸¿æ´‹å¤§ç¥è¯´ï¼šçƒ­ä¿®å¤åªèƒ½åœ¨å›½å†…ç©ï¼Œå›½å¤–éƒ½æ˜¯Google playã€‚<br>çš„ç¡®ï¼Œç›®å‰çƒ­ä¿®å¤å°½ç®¡æœ‰å¾ˆå¤šå‘ï¼Œåšäº†å¥½å¤šå·¥ä½œï¼Œå¯èƒ½åƒåŠ›ä¸è®¨å¥½ï¼Œå„ç§é€‚é…å¯èƒ½è¿˜æ˜¯æ²¡ä¿®å¤çº¿ä¸Šçš„æœ‰äº›Bugã€‚ä¸è¿‡å‘¢ï¼Œå¯¹äºä¸€ä¸ªäº§å“æœ‰çƒ­ä¿®å¤æ¯•ç«Ÿæ˜¯ä»¶å¥½äº‹ã€‚å°¤å…¶æ˜¯å¯¹äºä¸€ä¸ªæœ‰ä¼—å¤šç”¨æˆ·çš„appï¼ˆå¦‚æ”¯ä»˜å®ã€å¾®ä¿¡ã€æ‰‹æ·˜ç­‰ï¼‰ï¼Œä¸€ä¸ªbugä¸åªæ˜¯å½±å“åˆ°å‡ ä¸ªå‡ åä¸ªç”¨æˆ·ï¼Œä¸€äº›åˆ›ä¸šå…¬å¸çš„APPï¼Œå´©æºƒæˆ–è€…bugå¯èƒ½ç›´æ¥å¯¼è‡´ç”¨æˆ·å¸è½½å’Œæ°¸ä¸ä½¿ç”¨ï¼Œæ‰€ä»¥ï¼Œå°±å†²å®ƒæœ‰ä¸ç”¨å‘ç‰ˆä¹Ÿå¯ä»¥è§£å†³æˆ‘ä»¬çº¿ä¸Šçš„bugï¼Œæˆ‘ä»¬çš„appä¹Ÿè¦é€‚å½“è€ƒè™‘åŠ å…¥çƒ­ä¿®å¤ã€‚</p>
<blockquote>
<p>åœ¨IOSä¸Šï¼Œæœ‰JsPatchã€æœ‰waxPatchï¼Œæœ‰äº›æ¸¸æˆå…¬å¸è‡ªå·±æäº†ä¸€ä¸ªluaå¼•æ“æ”¾åˆ°åº”ç”¨é‡Œï¼Œæä¸€äº›ç±»ä¼¼åŠ¨æ€éƒ¨ç½²çš„ä¸œè¥¿ã€‚<br>ä¹Ÿå¯ä»¥é‡‡ç”¨å…¶ä»–æ–¹æ¡ˆï¼Œå¦‚RNï¼Œé˜¿é‡Œçš„Weexç­‰æ–¹æ¡ˆã€‚</p>
</blockquote>
<h1 id="çƒ­ä¿®å¤"><a href="#çƒ­ä¿®å¤" class="headerlink" title="çƒ­ä¿®å¤"></a>çƒ­ä¿®å¤</h1><p>çƒ­ä¿®å¤ï¼Œè¿™ä¸ªè¯æ˜¯åœ¨å»å¹´QQç©ºé—´å¼€å‘å›¢é˜Ÿï¼Œå‘è¡¨çš„ä¸€ç¯‡æ–‡ç« <a href="https://mp.weixin.qq.com/s?__biz=MzI1MTA1MzM2Nw==&amp;mid=400118620&amp;idx=1&amp;sn=b4fdd5055731290eef12ad0d17f39d4a&amp;scene=1&amp;srcid=1106Imu9ZgwybID13e7y2nEi#wechat_redirect" target="_blank" rel="external">å®‰å“Appçƒ­è¡¥ä¸åŠ¨æ€ä¿®å¤æŠ€æœ¯ä»‹ç»</a>å‡ºç°åï¼Œåœ¨â€æ±Ÿæ¹–â€ä¸Šå¼•èµ·äº†â€åŠ¨è¡ã€‚Androidç¨‹åºå‘˜å¥”èµ°ç›¸å‘Šâ€“â€œæˆ‘ä»¬ç»ˆäºæ‰¾åˆ°æ¢¦å¯ä»¥æ±‚çš„å®ç°çƒ­ä¿®å¤çš„ç†è®ºæ”¯æŒâ€ã€‚</p>
<blockquote>
<p>å¯èƒ½è¿˜æœ‰å…¶ä»–æ–¹æ¡ˆå¦‚é˜¿é‡Œçš„And-Fix,ClassLoaderçš„æ›¿ä»£æ–¹æ¡ˆã€‚<a href="#å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </a>ä¸‹æœ‰and-fixå’ŒClassLoaderçš„æ–‡ç« ï¼Œè®°å¾—ç‚¹å¼€é˜…è¯» ã€‚å…¶ä¸­ <a href="http://blog.zhaiyifan.cn/" target="_blank" rel="external">markzhai</a>ä¹Ÿæåˆ°äº†ç°åœ¨classLoaderæ›¿æ¢æ–¹æ¡ˆå·²ç»æˆè¿™ä¸€å¹´å¤šæ¥æ–°çš„å˜åŒ–ã€‚</p>
</blockquote>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzI1MTA1MzM2Nw==&amp;mid=400118620&amp;idx=1&amp;sn=b4fdd5055731290eef12ad0d17f39d4a&amp;scene=1&amp;srcid=1106Imu9ZgwybID13e7y2nEi#wechat_redirect" target="_blank" rel="external">å®‰å“Appçƒ­è¡¥ä¸åŠ¨æ€ä¿®å¤æŠ€æœ¯ä»‹ç»</a>å»ºè®®å¤§å®¶å¤šçœ‹å‡ éï¼Œä¸€éè¿œè¿œä¸å¤Ÿçš„ã€‚</p>
<p>è¿™ä¸ªé“¾æ¥ä½ ä¸€å®šè¦<a href="https://mp.weixin.qq.com/s?__biz=MzI1MTA1MzM2Nw==&amp;mid=400118620&amp;idx=1&amp;sn=b4fdd5055731290eef12ad0d17f39d4a&amp;scene=1&amp;srcid=1106Imu9ZgwybID13e7y2nEi#wechat_redirect" target="_blank" rel="external">ç‚¹å¼€</a>ã€‚<br>è¿™ä¸ªé“¾æ¥ä½ ä¸€å®šè¦<a href="https://mp.weixin.qq.com/s?__biz=MzI1MTA1MzM2Nw==&amp;mid=400118620&amp;idx=1&amp;sn=b4fdd5055731290eef12ad0d17f39d4a&amp;scene=1&amp;srcid=1106Imu9ZgwybID13e7y2nEi#wechat_redirect" target="_blank" rel="external">ç‚¹å¼€</a>ã€‚<br>è¿™ä¸ªé“¾æ¥ä½ ä¸€å®šè¦<a href="https://mp.weixin.qq.com/s?__biz=MzI1MTA1MzM2Nw==&amp;mid=400118620&amp;idx=1&amp;sn=b4fdd5055731290eef12ad0d17f39d4a&amp;scene=1&amp;srcid=1106Imu9ZgwybID13e7y2nEi#wechat_redirect" target="_blank" rel="external">ç‚¹å¼€</a>ã€‚<br>é‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼ï¼ï¼ï¼ï¼ï¼</p>
<p>è®°å¾—çœ‹ä¸‹ï¼Œ ä»–æ˜¯çƒ­ä¿®å¤çš„å§‹ç¥–çº§çš„æ–‡ç« ï¼Œä¹Ÿæ˜¯æœ¬æ–‡é‡ç‚¹æŠ„è¢­å¯¹è±¡ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“Androidç³»ç»Ÿä¹Ÿæ˜¯ä»¿ç…§javaæäº†ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œä¸è¿‡å®ƒä¸å«JVMï¼Œå®ƒå«Dalvik/ART VM<a href="http://geyubin.iteye.com/blog/1513918" target="_blank" rel="external">ä»–ä»¬è¿˜æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«</a>çš„ï¼ˆè¿™æ˜¯ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹, ç‚¹å¼€æ˜¯ä¸ªæ‹“å±•é˜…è¯»)ã€‚æˆ‘ä»¬åªéœ€è¦çŸ¥é“ï¼ŒDalvik/ART VM è™šæ‹ŸæœºåŠ è½½ç±»å’Œèµ„æºä¹Ÿæ˜¯è¦ç”¨åˆ°<code>ClassLoader</code>ï¼Œä¸è¿‡Jvmé€šè¿‡<code>ClassLoader</code>åŠ è½½çš„classå­—èŠ‚ç ï¼Œè€ŒDalvik/ART VMé€šè¿‡<code>ClassLoader</code>åŠ è½½åˆ™æ˜¯dexã€‚</p>
<h2 id="ClassLoader"><a href="#ClassLoader" class="headerlink" title="ClassLoader"></a>ClassLoader</h2><p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1472552007400.png" width="300"></p>
<p>åœ¨Androidä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ClassLoaderå…³ç³»å¦‚ä¸Šå›¾ï¼Œå…¶ä¸­<a href="https://android.googlesource.com/platform/libcore/+/android-5.0.0_r6/dalvik/src/main/java/dalvik/system/BaseDexClassLoader.java" target="_blank" rel="external">BaseDexClassLoader</a>ã€‚</p>
<p>å…¶ä¸­DexClasså¯ä»¥åŠ è½½apk,jar,åŠdexæ–‡ä»¶ï¼Œä½†PathClassLoaderåªèƒ½åŠ è½½å·²å®‰è£…åˆ°ç³»ç»Ÿä¸­ï¼ˆå³/data/appç›®å½•ä¸‹ï¼‰çš„apkæ–‡ä»¶ã€‚</p>
<h2 id="DexåŠ è½½æ–¹å¼"><a href="#DexåŠ è½½æ–¹å¼" class="headerlink" title="DexåŠ è½½æ–¹å¼"></a>DexåŠ è½½æ–¹å¼</h2><p>å°±è®©æˆ‘ä»¬æ¥ç¨å¾®å¯»æ‰¾ä¸‹çƒ­ä¿®å¤çš„çªç ´å£ã€‚</p>
<p>å…ˆæ¥ç…ç…<code>BaseDexClassLoader</code>çš„æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">**</div><div class="line"> * Base <span class="class"><span class="keyword">class</span> <span class="title">for</span> <span class="title">common</span> <span class="title">functionality</span> <span class="title">between</span> <span class="title">various</span> <span class="title">dex</span>-<span class="title">based</span></span></div><div class="line"> * &#123;<span class="meta">@link</span> ClassLoader&#125; implementations.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDexClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DexPathList pathList;</div><div class="line"></div><div class="line">   â€¦â€¦</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</div><div class="line">        List&lt;Throwable&gt; suppressedExceptions = <span class="keyword">new</span> ArrayList&lt;Throwable&gt;();</div><div class="line">        Class c = pathList.findClass(name, suppressedExceptions);</div><div class="line">        <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</div><div class="line">            ClassNotFoundException cnfe = <span class="keyword">new</span> ClassNotFoundException(<span class="string">"Didn't find class \""</span> + name + <span class="string">"\" on path: "</span> + pathList);</div><div class="line">            <span class="keyword">for</span> (Throwable t : suppressedExceptions) &#123;</div><div class="line">                cnfe.addSuppressed(t);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">throw</span> cnfe;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> c;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<hr>
<p><a href="https://android.googlesource.com/platform/libcore/+/android-5.0.0_r6/dalvik/src/main/java/dalvik/system/DexPathList.java" target="_blank" rel="external">5.0çš„DexPathList</a>éƒ¨åˆ†ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DexPathList</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEX_SUFFIX = <span class="string">".dex"</span>;  </div><div class="line"></div><div class="line">     <span class="keyword">private</span> <span class="keyword">final</span> Element[] dexElements;</div><div class="line"></div><div class="line">    <span class="comment">/** List of native library directories. */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> File[] nativeLibraryDirectories;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Constructs an instance.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> definingContext the context in which any as-yet unresolved</div><div class="line">     * classes should be defined</div><div class="line">     * <span class="doctag">@param</span> dexPath list of dex/resource path elements, separated by</div><div class="line">     * &#123;<span class="doctag">@code</span> File.pathSeparator&#125;</div><div class="line">     * <span class="doctag">@param</span> libraryPath list of native library directory path elements,</div><div class="line">     * separated by &#123;<span class="doctag">@code</span> File.pathSeparator&#125;</div><div class="line">     * <span class="doctag">@param</span> optimizedDirectory directory where optimized &#123;<span class="doctag">@code</span> .dex&#125; files</div><div class="line">     * should be found and written to, or &#123;<span class="doctag">@code</span> null&#125; to use the default</div><div class="line">     * system directory for same</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DexPathList</span><span class="params">(ClassLoader definingContext, String dexPath,</span></span></div><div class="line">            String libraryPath, File optimizedDirectory) &#123;</div><div class="line">        <span class="keyword">if</span> (definingContext == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"definingContext == null"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (dexPath == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"dexPath == null"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (optimizedDirectory != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (!optimizedDirectory.exists())  &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</div><div class="line">                        <span class="string">"optimizedDirectory doesn't exist: "</span></div><div class="line">                        + optimizedDirectory);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (!(optimizedDirectory.canRead()</div><div class="line">                            &amp;&amp; optimizedDirectory.canWrite())) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</div><div class="line">                        <span class="string">"optimizedDirectory not readable/writable: "</span></div><div class="line">                        + optimizedDirectory);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">this</span>.definingContext = definingContext;</div><div class="line">        ArrayList&lt;IOException&gt; suppressedExceptions = <span class="keyword">new</span> ArrayList&lt;IOException&gt;();</div><div class="line">        <span class="keyword">this</span>.dexElements = makeDexElements(splitDexPath(dexPath), optimizedDirectory,</div><div class="line">                                           suppressedExceptions);</div><div class="line">        <span class="keyword">if</span> (suppressedExceptions.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">this</span>.dexElementsSuppressedExceptions =</div><div class="line">                suppressedExceptions.toArray(<span class="keyword">new</span> IOException[suppressedExceptions.size()]);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            dexElementsSuppressedExceptions = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">this</span>.nativeLibraryDirectories = splitLibraryPath(libraryPath);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">public</span> Class <span class="title">findClass</span><span class="params">(String name, List&lt;Throwable&gt; suppressed)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (Element element : dexElements) &#123;</div><div class="line">            DexFile dex = element.dexFile;</div><div class="line">            <span class="keyword">if</span> (dex != <span class="keyword">null</span>) &#123;</div><div class="line">                Class clazz = dex.loadClassBinaryName(name, definingContext, suppressed);</div><div class="line">                <span class="keyword">if</span> (clazz != <span class="keyword">null</span>) &#123;</div><div class="line">                    <span class="keyword">return</span> clazz;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (dexElementsSuppressedExceptions != <span class="keyword">null</span>) &#123;</div><div class="line">            suppressed.addAll(Arrays.asList(dexElementsSuppressedExceptions));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<hr>
<p>DexFileéƒ¨åˆ†æºç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DexFile</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">long</span> mCookie;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String mFileName;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CloseGuard guard = CloseGuard.get();</div><div class="line"></div><div class="line">    â€¦â€¦</div><div class="line">    <span class="function"><span class="keyword">public</span> Class <span class="title">loadClass</span><span class="params">(String name, ClassLoader loader)</span> </span>&#123;</div><div class="line">        String slashName = name.replace(<span class="string">'.'</span>, <span class="string">'/'</span>);</div><div class="line">        <span class="keyword">return</span> loadClassBinaryName(slashName, loader, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> Class <span class="title">loadClassBinaryName</span><span class="params">(String name, ClassLoader loader, List&lt;Throwable&gt; suppressed)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> defineClass(name, loader, mCookie, suppressed);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Class <span class="title">defineClass</span><span class="params">(String name, ClassLoader loader, <span class="keyword">long</span> cookie,</span></span></div><div class="line">                                     List&lt;Throwable&gt; suppressed) &#123;</div><div class="line">        Class result = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            result = defineClassNative(name, loader, cookie);</div><div class="line">        &#125; <span class="keyword">catch</span> (NoClassDefFoundError e) &#123;</div><div class="line">            <span class="keyword">if</span> (suppressed != <span class="keyword">null</span>) &#123;</div><div class="line">                suppressed.add(e);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</div><div class="line">            <span class="keyword">if</span> (suppressed != <span class="keyword">null</span>) &#123;</div><div class="line">                suppressed.add(e);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    â€¦â€¦</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> Class <span class="title">defineClassNative</span><span class="params">(String name, ClassLoader loader, <span class="keyword">long</span> cookie)</span></span></div><div class="line">            <span class="keyword">throws</span> ClassNotFoundException, NoClassDefFoundError;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶ä¸­5.0çš„DexPathListæºç ä¸­çš„<code>dexElements</code>ï¼ˆLine 4ï¼‰å°±æ˜¯æˆ‘ä»¬Elementï¼ˆä¿å­˜æœ‰dexä¿¡æ¯ï¼‰çš„æ•°ç»„ã€‚å½“éœ€è¦å¯»æ‰¾ä¸€ä¸ªclassæ—¶ï¼Œ<code>BaseDexClassLoader</code>ä¼šå…ˆè°ƒç”¨<code>BaseDexClassLoader</code>ä¸­çš„pathListçš„findClassæ–¹æ³•ï¼Œè€ŒpathListå®é™…ä¸Šæ˜¯ä¸€ä¸ª<code>DexPathList</code>å¯¹è±¡ï¼ŒæŸ¥çœ‹<code>DexPathList</code>çš„æºç å‘ç°ï¼ŒfindClassæ–¹å¼å…¶å®æ˜¯å»éå†dexElementsä¸­çš„elementå…ƒç´ ï¼Œé€šè¿‡DexFileçš„å¯¹è±¡å»loadClassã€‚</p>
<p>çƒ­ä¿®å¤å°±æ˜¯åˆ©ç”¨<code>dexElements</code>çš„é¡ºåºæ¥åšæ–‡ç« ï¼Œå½“ä¸€ä¸ªè¡¥ä¸çš„patch.dexæ”¾åˆ°äº†<code>dexElements</code>çš„ç¬¬ä¸€ä½ï¼Œé‚£ä¹ˆå½“åŠ è½½ä¸€ä¸ªbugç±»æ—¶ï¼Œå‘ç°åœ¨patch.dexä¸­ï¼Œåˆ™ç›´æ¥åŠ è½½è¿™ä¸ªç±»ï¼ŒåŸæ¥çš„bugç±»å¯èƒ½å°±è¢«è¦†ç›–äº†ã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1472568213083.png" width="500"></p>
<p>å‘ç‰ˆåå‘ç°class1.dexä¸­çš„Bug.classæœ‰ä¸€ä¸ªbug,ä¿®å¤åæœ‰ä¸€ä¸ªä¿®å¤å¥½çš„patch.dex.</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1472568240996.png" width="500"></p>
<h2 id="CLASS-ISPREVERIFIEDé—®é¢˜"><a href="#CLASS-ISPREVERIFIEDé—®é¢˜" class="headerlink" title="CLASS_ISPREVERIFIEDé—®é¢˜"></a>CLASS_ISPREVERIFIEDé—®é¢˜</h2><p>æ ¹æ®QQç©ºé—´è°ˆåˆ°çš„åœ¨è™šæ‹Ÿæœºå¯åŠ¨çš„æ—¶å€™ï¼Œåœ¨verifyé€‰é¡¹è¢«æ‰“å¼€çš„æ—¶å€™ï¼Œå¦‚æœstaticæ–¹æ³•ã€privateæ–¹æ³•ã€æ„é€ å‡½æ•°ç­‰ï¼Œå…¶ä¸­çš„ç›´æ¥å¼•ç”¨ï¼ˆç¬¬ä¸€å±‚å…³ç³»ï¼‰åˆ°çš„ç±»éƒ½åœ¨åŒä¸€ä¸ªdexæ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆè¯¥ç±»å°±ä¼šè¢«æ‰“ä¸ŠCLASS_ISPREVERIFIEDæ ‡å¿—ï¼Œä¸”ä¸€æ—¦ç±»è¢«æ‰“ä¸ŠCLASS_ISPREVERIFIEDæ ‡å¿—å…¶ä»–dexå°±ä¸èƒ½å†å»æ›¿æ¢è¿™ä¸ªç±»ã€‚æ‰€ä»¥ä¸€å®šè¦æƒ³åŠæ³•å»é˜»æ­¢ç±»è¢«æ‰“ä¸ŠCLASS_ISPREVERIFIEDæ ‡å¿—ã€‚</p>
<p>ä¸ºäº†é˜»æ­¢ç±»è¢«æ‰“ä¸ŠCLASS_ISPREVERIFIEDæ ‡å¿—ï¼ŒQQç©ºé—´å¼€å‘å›¢é˜Ÿæå‡ºäº†ä¸€ä¸ªæ–¹æ³•æ˜¯å…ˆå°†ä¸€ä¸ªé¢„å¤‡å¥½çš„hack.dexåŠ å…¥åˆ°<code>dexElements</code>çš„ç¬¬ä¸€é¡¹ï¼Œè®©åé¢çš„dexçš„æ‰€æœ‰ç±»éƒ½å¼•ç”¨hack.dexå…¶ä¸­çš„ä¸€ä¸ªç±»ï¼Œè¿™æ ·åŸæ¥çš„class1.dexã€class2.dexã€class3.dexä¸­çš„æ‰€æœ‰ç±»éƒ½å¼•ç”¨äº†hack.dexçš„ç±»ï¼Œæ‰€ä»¥å…¶ä¸­çš„éƒ½ä¸ä¼šæ‰“ä¸ŠCLASS_ISPREVERIFIEDæ ‡å¿—ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å‚è€ƒ<a href="https://github.com/dodola/HotFix" target="_blank" rel="external">dodola/HotFix</a>é¡¹ç›®æ¥è¯´æ˜ã€‚</p>
<p>appä¸­æœ‰ä¸€ä¸ªLoadBugClassç±»ï¼Œä»–å¼•ç”¨äº†BugClassç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoadBugClass</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBugString</span><span class="params">()</span> </span>&#123;</div><div class="line">        BugClass bugClass = <span class="keyword">new</span> BugClass();</div><div class="line">        <span class="keyword">return</span> bugClass.bug();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶ä¸­BugClasså‡ºç°äº†bugã€‚æŒ‰ç…§åˆšæ‰çš„ç†è®ºLoadBugClassä¼šè¢«æ‰“æˆCLASS_ISPREVERIFIEDæ ‡å¿—ã€‚ä¸ºäº†é˜»æ­¢å®ƒæ‰“ä¸ŠCLASS_ISPREVERIFIEDæ ‡å¿—ï¼Œéœ€è¦åœ¨ä»–çš„æ„é€ å‡½æ•°é‡Œæ·»åŠ hack.dexä¸€ä¸ªç±»å¼•ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">LoadBugClass()&#123;</div><div class="line">      â€¦â€¦â€¦â€¦</div><div class="line"></div><div class="line">      System.out.println(dodola.hackdex.AntilazyLoad.class)</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>å…¶ä¸­<code>AntilazyLoad</code>å°±æ˜¯hack.dexçš„ç±»ã€‚è¿™æ ·å¤„ç†ä¸ä¼šå¢åŠ æ–¹æ³•æ•°ï¼Œå¯¹ä»£ç çš„ä¾µå…¥è¾ƒå°‘ã€‚</p>
<p>å¥½äº†è¿™èŠ‚ä»‹ç»äº†Androidçƒ­ä¿®å¤çš„å®ç°åŸç†ï¼Œä¸‹ä¸€ç¯‡ä¼šç»“åˆ<a href="https://github.com/jasonross/Nuwa" target="_blank" rel="external">jasonross/Nuwa</a>å’Œ<a href="https://github.com/dodola/HotFix" target="_blank" rel="external">dodola/HotFix</a>æ¥è°ˆä¸€ä¸‹ä»–ä»¬çš„å®è·µã€‚</p>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><hr>
<ol>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzI1MTA1MzM2Nw==&amp;mid=400118620&amp;idx=1&amp;sn=b4fdd5055731290eef12ad0d17f39d4a&amp;scene=1&amp;srcid=1106Imu9ZgwybID13e7y2nEi#wechat_redirect" target="_blank" rel="external">QQç©ºé—´ â€“ å®‰å“Appçƒ­è¡¥ä¸åŠ¨æ€ä¿®å¤æŠ€æœ¯ä»‹ç»</a></li>
<li><a href="http://my.oschina.net/853294317/blog/308583" target="_blank" rel="external">Android dexåˆ†åŒ…æ–¹æ¡ˆ</a></li>
<li><a href="http://www.kymjs.com/code/2016/05/08/01" target="_blank" rel="external">å¼ æ¶› â€“ Android çƒ­ä¿®å¤ï¼Œæ²¡ä½ æƒ³çš„é‚£ä¹ˆéš¾</a></li>
<li><a href="http://blog.csdn.net/lmj623565791/article/details/49883661" target="_blank" rel="external">é¸¿æ´‹ â€“Android çƒ­è¡¥ä¸åŠ¨æ€ä¿®å¤æ¡†æ¶å°ç»“</a></li>
<li><a href="http://blog.hwangjr.com/2016/03/02/Android-HotFix%E6%96%B9%E6%A1%88/" target="_blank" rel="external">Android HotFixæ–¹æ¡ˆ</a></li>
<li>classLoader æ›¿æ¢æ–¹æ¡ˆ <a href="http://weishu.me/2016/04/05/understand-plugin-framework-classloader/" target="_blank" rel="external">Android æ’ä»¶åŒ–åŸç†è§£æâ€”â€”æ’ä»¶åŠ è½½æœºåˆ¶</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å…³äºçƒ­ä¿®å¤å…¶å®å¾ˆæ—©éƒ½æƒ³åŠ¨æ‰‹å†™ï¼Œä¸è¿‡ç”±äºæ²¡ç ”ç©¶è¿‡å…·ä½“çš„å®è·µï¼Œä¸æ•¢ä¹±è°ˆã€‚&lt;br&gt;é‚£ä¹ˆä½•ä¸ºçƒ­ä¿®å¤å‘¢ï¼Ÿæ‰€è°“çƒ­ä¿®å¤ï¼Œæ— éæ˜¯çº¿ä¸Šå‡ºäº†bugï¼Œå¼€å‘äººå‘˜å¯ä»¥å‘è¡¥ä¸ï¼Œåº”ç”¨ç¨‹åºé»˜é»˜ä¸‹è½½å¥½å¯¹åº”é—®é¢˜çš„è¡¥ä¸ï¼Œä¿®å¤è¿™ä¸ªbugã€‚è¿™ç§çƒ­ä¿®å¤å…¶å®å¾ˆé€‚åˆclient-serverçš„æ¨¡å¼ï¼Œå½“ç„¶äº†å®¢æˆ·ç«¯è‚¯å®šä¹Ÿæ˜¯é€‚ç”¨çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://ownwell.github.io/categories/Android/"/>
    
    
      <category term="hot-fix" scheme="http://ownwell.github.io/tags/hot-fix/"/>
    
  </entry>
  
  <entry>
    <title>Androidä¸‹å¤šå½©çš„StatusViewçš„å®ç°</title>
    <link href="http://ownwell.github.io/2016/08/26/android-status-bar/"/>
    <id>http://ownwell.github.io/2016/08/26/android-status-bar/</id>
    <published>2016-08-26T13:34:57.000Z</published>
    <updated>2017-05-24T07:19:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä¸Šä¸€ä¸ªåšæ–‡ <a href="http://ownwell.github.io/2016/08/11/Anroid%E6%B2%89%E6%B5%B8%E5%BC%8F%E7%8A%B6%E6%80%81%E6%A0%8F/">Anroidæ²‰æµ¸å¼çŠ¶æ€æ </a>ä¸­æåˆ°äº†ï¼Œç”»äº†ä¸€ä¸ªå›¾ï¼Œè¿™ä¸ªå›¾ç®€å•å°†æˆ‘ä»¬çš„çŠ¶æ€æ åˆ†ä¸ºä¸åŒçš„2ä¸ªç»´åº¦æ¥çœ‹çŠ¶æ€æ ã€‚å…¶ä¸­æ¶‰åŠçš„æ¦‚å¿µæˆ‘ä¸åœ¨èµ˜è¯‰ï¼Œè¯·è¿”åˆ°<a href="http://ownwell.github.io/2016/08/11/Anroid%E6%B2%89%E6%B5%B8%E5%BC%8F%E7%8A%B6%E6%80%81%E6%A0%8F/">Anroidæ²‰æµ¸å¼çŠ¶æ€æ </a>å†å»è®¤è¯†ä¸‹è¿™å‡ ä¸ªæ¦‚å¿µã€‚æœ¬æ–‡ä¸­æåˆ°çš„<strong>[ä¸ŠèŠ‚]</strong>å°±æ˜¯<a href="http://ownwell.github.io/2016/08/11/Anroid%E6%B2%89%E6%B5%B8%E5%BC%8F%E7%8A%B6%E6%80%81%E6%A0%8F/">Anroidæ²‰æµ¸å¼çŠ¶æ€æ </a>è¿™ç¯‡æ–‡ç« ã€‚**<br><a id="more"></a></p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1470997766590.png" alt="å›¾1"></p>
<h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>ç”±äº[ä¸ŠèŠ‚]æåˆ°äº†åŸºæœ¬çš„å®ç°æ–¹æ³•å’Œä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œä½†æ˜¯æ²¡æœ‰å®é™…æ“ä½œå’Œæ¼”ç¤ºï¼Œé‚£æˆ‘ä»¬ç°åœ¨å°±æ¥ä¸€æ­¥æ­¥æ¥å»å®ç°æˆ‘ä»¬æåˆ°çš„ä¸‰ç§çŠ¶æ€æ çš„å®ç°è¿‡ç¨‹ã€‚</p>
<h2 id="å…¨å±æ¨¡å¼ä¸‹çš„é€æ˜çŠ¶æ€æ "><a href="#å…¨å±æ¨¡å¼ä¸‹çš„é€æ˜çŠ¶æ€æ " class="headerlink" title="å…¨å±æ¨¡å¼ä¸‹çš„é€æ˜çŠ¶æ€æ "></a>å…¨å±æ¨¡å¼ä¸‹çš„é€æ˜çŠ¶æ€æ </h2><p>å…¨å±æ¨¡å¼ä¸‹çš„é€æ˜çŠ¶æ€æ ï¼Œå…¶ä»–appå®ç°è¿™æ ·æ–¹å¼æˆ‘ä»¬è‚¯å®šè§è¿‡ï¼Œå¦‚æˆ‘ä»¬çš„å¯åŠ¨é¡µå¾ˆå¤šæƒ…å†µä¸‹å°±æ˜¯å…¨å±æ¨¡å¼ï¼Œä½†æ˜¯è¿™ä¸ªè¿˜æ˜¯å’Œæˆ‘ä»¬è¯´çš„ä¸å¤ªä¸€æ ·ï¼Œä¸è¿‡ä»Šå¤©æˆ‘ä»¬ä»‹ç»çš„è¿™ä¸ªæ˜¯é€æ˜çŠ¶æ€æ ï¼Œä½†æ˜¯ä»ç„¶åˆæœ‰å‡ºå…¥ã€‚</p>
<p>å¦‚ä¸‹å›¾æ˜¯ç½‘æ˜“æ–°é—»çš„å¯åŠ¨é¡µï¼š</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1472219319760.png" width="350"></p>
<p>ä½†æ˜¯ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•ˆæœï¼Œè¿™ç§æ˜¯å…¨å±æ¨¡å¼æ—¶ï¼Œå½“å‰é¡µé¢è·å–ç„¦ç‚¹å°±æ˜¾ç¤ºä¸€ä¸ªæœ‰ä¸€å®šé€æ˜åº¦çš„æš—è‰²çŠ¶æ€æ ã€‚</p>
<blockquote>
<p>ç½‘æ˜“æ–°é—»è¿™ç§æ‰æ˜¯çœŸæ­£çš„æµ¸å…¥å¼çŠ¶æ€æ ,è¿™ä¸ªæ²‰æµ¸å¼è®©éƒ­ç¥è®²çš„å¾ˆé€å½» â€“<a href="http://blog.csdn.net/guolin_blog/article/details/51763825" target="_blank" rel="external">AndroidçŠ¶æ€æ å¾®æŠ€å·§ï¼Œå¸¦ä½ çœŸæ­£ç†è§£æ²‰æµ¸å¼æ¨¡å¼</a></p>
</blockquote>
<hr>
<p>æˆ‘ä»¬å¸Œæœ›çš„æ˜¯å°ç±³å¤©æ°”çš„è¿™ç§ï¼š<br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1472220275729.png" width="350"></p>
<p>å†…å®¹éƒ¨åˆ†å¯ä»¥å»¶ä¼¸åˆ°çŠ¶æ€æ ï¼Œä¸”çŠ¶æ€æ æ˜¯é€æ˜çš„ï¼Œæ— èƒŒæ™¯è‰²ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å…¨å±æ¨¡å¼ã€‚    </p>
<p>æŒ‰ç…§æˆ‘ä»¬ä¸ŠèŠ‚æ‹¿æ¥å®è·µä¸‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">setFullSreen</span><span class="params">(Activity activity)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">            <span class="comment">// è®¾ç½®é€æ˜çŠ¶æ€æ ,è¿™æ ·æ‰èƒ½è®© ContentView å‘ä¸Š</span></div><div class="line">            activity.getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘å°†ä¸€ä¸ªå›¾ç‰‡é“ºæ»¡contentViewã€‚<br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1472221242655.png" width="350"></p>
<p>è¿™ä¸ªæˆªå›¾æ˜¯åœ¨4.4ä¸Šå®Œæˆçš„ã€‚</p>
<p>ä½†æ˜¯åœ¨6.0ä¸Šçš„æ•ˆæœè¿˜å·®å¼ºäººæ„ï¼š</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1472221930580.png" width="350"></p>
<p>è¿™ä¸ªæ˜¯åœ¨æˆ‘çš„N5æ‰‹æœºä¸Šè·‘çš„ï¼Œä¸Šé¢æœ‰ç°è‰²çš„é˜´å½±ã€‚ä¸æ˜¯å®Œå…¨é€æ˜ï¼Œå’Œæˆ‘ä»¬çš„å°ç±³å¤©æ°”ä¸å¤ªä¸€æ ·ï¼Œå¥½äº†è¿˜æ˜¯ç”¨åˆ°ä¸ŠèŠ‚çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">setFullSreen</span><span class="params">(Activity activity)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</div><div class="line">            Window window = activity.getWindow();</div><div class="line">            window.clearFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS</div><div class="line">                    | WindowManager.LayoutParams.FLAG_TRANSLUCENT_NAVIGATION);</div><div class="line">            window.getDecorView().setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN| View.SYSTEM_UI_FLAG_LAYOUT_STABLE);</div><div class="line">            window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);</div><div class="line">            window.setStatusBarColor(Color.TRANSPARENT);</div><div class="line">        &#125;<span class="keyword">else</span></div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">            <span class="comment">// è®¾ç½®é€æ˜çŠ¶æ€æ ,è¿™æ ·æ‰èƒ½è®© ContentView å‘ä¸Š</span></div><div class="line">            activity.getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥ä½¿å¾—çŠ¶æ€æ ä¹Ÿé€æ˜äº†ã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1472222580320.png" width="350"></p>
<h2 id="å½©è‰²çŠ¶æ€æ "><a href="#å½©è‰²çŠ¶æ€æ " class="headerlink" title="å½©è‰²çŠ¶æ€æ "></a>å½©è‰²çŠ¶æ€æ </h2><p>å¯èƒ½æœ‰äº›äººä¼šè¿·æƒ‘ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è®¾ç½®å½©è‰²çŠ¶æ€æ ï¼Œåœ¨5.0å¯ä»¥ç›´æ¥è®¾ç½®ä¸»é¢˜æ¥è®¾ç½®çš„ï¼Œæˆ‘è¦å‘Šè¯‰ä½ çš„æ˜¯æˆ‘ä»¬å¸Œæœ›4.4ä¸Šä¹Ÿæœ‰å½©è‰²çš„çŠ¶æ€æ ã€‚ä¸ŠèŠ‚æˆ‘ä»¬æåˆ°äº†å½©è‰²çŠ¶æ€æ çš„å®ç°æ–¹æ³•ï¼šå°±æ˜¯å…ˆè®¾ç½®ä¸ºå±å¹•æ¨¡å¼ä¸‹çš„é€æ˜çŠ¶æ€æ ï¼Œå†åœ¨é€æ˜çŠ¶æ€æ çš„å‚ç›´ä¸‹æ–¹æ”¾ç½®ä¸€ä¸ªå’ŒçŠ¶æ€æ åŒæ ·é«˜å®½çš„viewï¼Œæˆ‘ä»¬æ“ä½œä»–è¿™ä¸ªç©ºç™½viewçš„é¢œè‰²ï¼Œå³å¯å®ç°å½©è‰²çŠ¶æ€æ ã€‚</p>
<p>å…·ä½“å®ç°æ˜¯å‚è€ƒ<a href="http://jaeger.itscoder.com/" target="_blank" rel="external">çŒ´å­</a>çš„ä¸€ä¸ªå¼€æºé¡¹ç›®<a href="https://github.com/laobie/StatusBarUtil" target="_blank" rel="external">StatusBarUtil</a>é‡Œçš„ä¸­ä»£ç ï¼Œå¯èƒ½ç•¥æœ‰æ”¹åŠ¨ï¼Œå·²ç»å‘ŠçŸ¥çŒ´å­ï¼Œå¾—åˆ°ä»–æœ¬äººæˆæƒã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">/**</span></div><div class="line">  *è®¾ç½®å½©è‰²çš„çŠ¶æ€æ </div><div class="line">  *</div><div class="line">  * <span class="doctag">@param</span> activity</div><div class="line">  * <span class="doctag">@param</span> color çŠ¶æ€æ éœ€è¦è®¾ç½®çš„èƒŒæ™¯é¢œè‰²</div><div class="line">  * <span class="doctag">@param</span> statusBarAlpha çŠ¶æ€æ éœ€è¦è®¾ç½®çš„èƒŒæ™¯é¢œè‰²çš„é€æ˜åº¦</div><div class="line">  */</div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(Activity activity, @ColorInt <span class="keyword">int</span> color, <span class="keyword">int</span> statusBarAlpha)</span></span>&#123;</div><div class="line"></div><div class="line">     <span class="comment">//å…ˆè®¾ç½®çš„å…¨å±æ¨¡å¼</span></div><div class="line">     setFullSreen(activity);</div><div class="line">     <span class="comment">//åœ¨é€æ˜çŠ¶æ€æ çš„å‚ç›´ä¸‹æ–¹æ”¾ç½®ä¸€ä¸ªå’ŒçŠ¶æ€æ åŒæ ·é«˜å®½çš„view</span></div><div class="line">     addStatusBarBehind(activity,color,statusBarAlpha);</div><div class="line"></div><div class="line"></div><div class="line"> &#125;</div><div class="line"> <span class="comment">/**</span></div><div class="line">  * æ·»åŠ äº†ä¸€ä¸ªçŠ¶æ€æ (å®é™…ä¸Šæ˜¯ä¸ªview)ï¼Œæ”¾åœ¨äº†çŠ¶æ€æ çš„å‚ç›´ä¸‹æ–¹</div><div class="line">      */</div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addStatusBarBehind</span><span class="params">(Activity activity, @ColorInt <span class="keyword">int</span> color, <span class="keyword">int</span> statusBarAlpha)</span> </span>&#123;</div><div class="line">     <span class="comment">//è·å–windowphoneä¸‹çš„decorView</span></div><div class="line">     ViewGroup decorView = (ViewGroup) activity.getWindow().getDecorView();</div><div class="line">     <span class="keyword">int</span>       count     = decorView.getChildCount();</div><div class="line">     <span class="comment">//åˆ¤æ–­æ˜¯å¦å·²ç»æ·»åŠ äº†statusBarView</span></div><div class="line">     <span class="keyword">if</span> (count &gt; <span class="number">0</span> &amp;&amp; decorView.getChildAt(count - <span class="number">1</span>) <span class="keyword">instanceof</span> StatusBarView) &#123;</div><div class="line">         decorView.getChildAt(count - <span class="number">1</span>).setBackgroundColor(calculateStatusColor(color, statusBarAlpha));</div><div class="line">     &#125; <span class="keyword">else</span> &#123;</div><div class="line">         <span class="comment">//æ–°å»ºä¸€ä¸ªå’ŒçŠ¶æ€æ é«˜å®½çš„view</span></div><div class="line">         StatusBarView statusView = createStatusBarView(activity, color, statusBarAlpha);</div><div class="line">         decorView.addView(statusView);</div><div class="line">     &#125;</div><div class="line">     setRootView(activity);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">  * è®¾ç½®æ ¹å¸ƒå±€å‚æ•°</div><div class="line">  */</div><div class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setRootView</span><span class="params">(Activity activity)</span> </span>&#123;</div><div class="line">     ViewGroup rootView = (ViewGroup) ((ViewGroup) activity.findViewById(android.R.id.content)).getChildAt(<span class="number">0</span>);</div><div class="line">     <span class="comment">//rootviewä¸ä¼šä¸ºçŠ¶æ€æ æµå‡ºçŠ¶æ€æ ç©ºé—´</span></div><div class="line">     ViewCompat.setFitsSystemWindows(rootView,<span class="keyword">false</span>);</div><div class="line">     rootView.setClipToPadding(<span class="keyword">true</span>);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"></div><div class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> StatusBarView <span class="title">createStatusBarView</span><span class="params">(Activity activity, <span class="keyword">int</span> color, <span class="keyword">int</span> alpha)</span> </span>&#123;</div><div class="line">     <span class="comment">// ç»˜åˆ¶ä¸€ä¸ªå’ŒçŠ¶æ€æ ä¸€æ ·é«˜çš„çŸ©å½¢</span></div><div class="line">     StatusBarView statusBarView = <span class="keyword">new</span> StatusBarView(activity);</div><div class="line">     LinearLayout.LayoutParams params =</div><div class="line">             <span class="keyword">new</span> LinearLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, getStatusBarHeight(activity));</div><div class="line">     statusBarView.setLayoutParams(params);</div><div class="line">     statusBarView.setBackgroundColor(calculateStatusColor(color, alpha));</div><div class="line">     <span class="keyword">return</span> statusBarView;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">  * è·å–çŠ¶æ€æ é«˜åº¦</div><div class="line">  *</div><div class="line">  * <span class="doctag">@param</span> context context</div><div class="line">  * <span class="doctag">@return</span> çŠ¶æ€æ é«˜åº¦</div><div class="line">  */</div><div class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getStatusBarHeight</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">     <span class="comment">// è·å¾—çŠ¶æ€æ é«˜åº¦</span></div><div class="line">     <span class="keyword">int</span> resourceId = context.getResources().getIdentifier(<span class="string">"status_bar_height"</span>, <span class="string">"dimen"</span>, <span class="string">"android"</span>);</div><div class="line">     <span class="keyword">return</span> context.getResources().getDimensionPixelSize(resourceId);</div><div class="line"> &#125;</div><div class="line"> <span class="comment">/**</span></div><div class="line">  * è®¡ç®—çŠ¶æ€æ é¢œè‰²</div><div class="line">  *</div><div class="line">  * <span class="doctag">@param</span> color colorå€¼</div><div class="line">  * <span class="doctag">@param</span> alpha alphaå€¼</div><div class="line">  * <span class="doctag">@return</span> æœ€ç»ˆçš„çŠ¶æ€æ é¢œè‰²</div><div class="line">  */</div><div class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calculateStatusColor</span><span class="params">(<span class="keyword">int</span> color, <span class="keyword">int</span> alpha)</span> </span>&#123;</div><div class="line">     <span class="keyword">float</span> a = <span class="number">1</span> - alpha / <span class="number">255f</span>;</div><div class="line">     <span class="keyword">int</span> red = color &gt;&gt; <span class="number">16</span> &amp; <span class="number">0xff</span>;</div><div class="line">     <span class="keyword">int</span> green = color &gt;&gt; <span class="number">8</span> &amp; <span class="number">0xff</span>;</div><div class="line">     <span class="keyword">int</span> blue = color &amp; <span class="number">0xff</span>;</div><div class="line">     red = (<span class="keyword">int</span>) (red * a + <span class="number">0.5</span>);</div><div class="line">     green = (<span class="keyword">int</span>) (green * a + <span class="number">0.5</span>);</div><div class="line">     blue = (<span class="keyword">int</span>) (blue * a + <span class="number">0.5</span>);</div><div class="line">     <span class="keyword">return</span> <span class="number">0xff</span> &lt;&lt; <span class="number">24</span> | red &lt;&lt; <span class="number">16</span> | green &lt;&lt; <span class="number">8</span> | blue;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>å…¶ä¸­çŠ¶æ€æ çš„viewå°±æ˜¯ä¸€ä¸ªç®€å•çš„viewï¼Œè´´å‡ºæ¥çš„è¿™ä¸ªç±»å§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StatusBarView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StatusBarView</span><span class="params">(Context context, AttributeSet attrs,<span class="keyword">int</span> style)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs,style);</div><div class="line">    &#125;    </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StatusBarView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StatusBarView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> æå®šï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥åŠ¨æ€æ”¹å˜çŠ¶æ€æ çš„é¢œè‰²äº†ã€‚</p>
<blockquote>
<p>calculateStatusColor æ–¹æ³•ä¸­çš„alphaæ˜¯0-255çš„ï¼Œ0çš„æ—¶å€™å…¶å®æ˜¯ä¸é€æ˜çš„ï¼Œå½“è®¾ç½®255ç›¸å½“äºstatusviewèƒŒæ™¯é€æ˜ï¼Œå³ä¸ºé»˜è®¤è‰²é»‘è‰²ã€‚</p>
</blockquote>
<p>å¯ç”¨çš„å‡½æ•°æ˜¯<code>public static void setColor(Activity activity, @ColorInt int color, int statusBarAlpha)</code>å’Œ<code>setFullSreen</code></p>
<h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>Nowç°åœ¨è¿™ä¸ªå·¥å…·ç±»å°±ç®—æ˜¯OKï¼Œå¯¹äºä»£ç çš„ä¾µå…¥åŸºæœ¬ä¸Šä¸ºé›¶ï¼Œç›´æ¥æ‹¿æ¥å½“å·¥å…·ç±»ï¼Œä¸ç”¨æ”¹ä¸»é¢˜ï¼Œç®€å•æ˜“å®¹ç”¨ã€‚ä¹Ÿä¸ºå¤§å®¶æä¾›ä¸€ä¸ªæ€è·¯ï¼Œè¿™ä¸ªåªæ˜¯å®ç°çš„åŸºæœ¬åŠŸèƒ½ï¼Œä¸€äº›å¤æ‚çš„å®šåˆ¶çš„æƒ…å†µï¼Œå¯ä»¥éšæœºåº”å˜ï¼Œè‡ªç”±ç»„åˆä½¿ç”¨ã€‚<a href="https://github.com/laobie/StatusBarUtil" target="_blank" rel="external">çŒ´å­çš„StatusBarUtil</a>å¯ä»¥å‚è€ƒä¸‹ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶å¤šæissuesï¼Œä½¿è¿™ä¸ªé¡¹ç›®æ›´åŠ å®Œå–„ã€‚</p>
<p>å®ç°çŠ¶æ€æ ï¼Œæ— éæ˜¯å°†4.4-5.0 å’Œ5.0+çš„åˆ†åˆ«å®ç°ï¼Œå½“ç„¶é…åˆdecorviewå’Œ ViewCompat.setFitsSystemWindows(view,boolean)ä½¿ç”¨æ•ˆæœæ›´ä½³ã€‚</p>
<h1 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h1><p>åœ¨æ”¹å˜çŠ¶æ€æ é¢œè‰²æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯é»˜è®¤çš„çŠ¶æ€æ å­—ä½“é¢œè‰²éƒ½æ˜¯é»‘è‰²çš„ï¼Œä½†æ˜¯è‹¥æ˜¯èƒŒæ™¯ä¸ºæš—è‰²ï¼Œä¸Šé¢çš„æ—¶é—´ã€ç”µé‡ç­‰è¿˜ç­‰çœ‹åˆ°å¾ˆæ¸…æ™°ï¼Œä½†æ˜¯è‹¥æ˜¯é‡åˆ°äº†å…¨å±æ¨¡å¼ä¸‹çŠ¶æ€æ å‚ç›´ä¸‹æ–¹çš„viewæ˜¯ç™½è‰²çš„æˆ–è€…æ¥è¿‘ç™½è‰²ï¼Œé‚£å²‚ä¸æ˜¯çœ‹ä¸è§çŠ¶æ€æ ä¸Šçš„å­—ä¹ˆï¼Ÿ</p>
<p>æ˜¯çš„ï¼<br>æ‰€ä»¥æœ‰äººæå‡ºéœ€è¦æ”¹çŠ¶æ€æ çš„å­—ä½“é¢œè‰²äº†ï¼Œè¿™ä¸ªåœ¨çŸ¥ä¹ä¸Šç«äº†ä¸€é˜µï¼Œæ‰€ä»¥æŠŠè¿™ä¸ªæ‹“å±•éƒ¨åˆ†ç•™ä¸€ä¸ªçŸ¥ä¹çš„é“¾æ¥ â€”-<a href="http://www.zhihu.com/question/31994153" target="_blank" rel="external">androidå¼€å‘ï¼Œä¿®æ”¹çŠ¶æ€æ å­—ä½“é¢œè‰²?</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ä¸Šä¸€ä¸ªåšæ–‡ &lt;a href=&quot;http://ownwell.github.io/2016/08/11/Anroid%E6%B2%89%E6%B5%B8%E5%BC%8F%E7%8A%B6%E6%80%81%E6%A0%8F/&quot;&gt;Anroidæ²‰æµ¸å¼çŠ¶æ€æ &lt;/a&gt;ä¸­æåˆ°äº†ï¼Œç”»äº†ä¸€ä¸ªå›¾ï¼Œè¿™ä¸ªå›¾ç®€å•å°†æˆ‘ä»¬çš„çŠ¶æ€æ åˆ†ä¸ºä¸åŒçš„2ä¸ªç»´åº¦æ¥çœ‹çŠ¶æ€æ ã€‚å…¶ä¸­æ¶‰åŠçš„æ¦‚å¿µæˆ‘ä¸åœ¨èµ˜è¯‰ï¼Œè¯·è¿”åˆ°&lt;a href=&quot;http://ownwell.github.io/2016/08/11/Anroid%E6%B2%89%E6%B5%B8%E5%BC%8F%E7%8A%B6%E6%80%81%E6%A0%8F/&quot;&gt;Anroidæ²‰æµ¸å¼çŠ¶æ€æ &lt;/a&gt;å†å»è®¤è¯†ä¸‹è¿™å‡ ä¸ªæ¦‚å¿µã€‚æœ¬æ–‡ä¸­æåˆ°çš„&lt;strong&gt;[ä¸ŠèŠ‚]&lt;/strong&gt;å°±æ˜¯&lt;a href=&quot;http://ownwell.github.io/2016/08/11/Anroid%E6%B2%89%E6%B5%B8%E5%BC%8F%E7%8A%B6%E6%80%81%E6%A0%8F/&quot;&gt;Anroidæ²‰æµ¸å¼çŠ¶æ€æ &lt;/a&gt;è¿™ç¯‡æ–‡ç« ã€‚**&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://ownwell.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://ownwell.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Gitflowå·¥ä½œæµ</title>
    <link href="http://ownwell.github.io/2016/08/17/git-work-flow/"/>
    <id>http://ownwell.github.io/2016/08/17/git-work-flow/</id>
    <published>2016-08-17T13:13:23.000Z</published>
    <updated>2017-05-24T07:19:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç°åœ¨çš„ç‰ˆæœ¬æ§åˆ¶è¶Šæ¥è¶Šé‡è¦ï¼Œè¿˜è®°å¾—æ¯•ä¸šé‚£ä¼šå†™æ¯•ä¸šè®¾è®¡ä¸€ä¸ªä¸ªç‰ˆæœ¬ï¼Œæå¾—å¤´æ˜è„‘æ¶¨ï¼Œä¸è¿‡å½“æ—¶å·²ç»æ¥è§¦äº†ç‰ˆæœ¬è¿­ä»£åœ¨è‡ªå·±çš„æœºå™¨ä¸Šéƒ¨ç½²äº†ä¸€ä¸ªSVN Serverï¼Œç”¨ç¨‹åºå‘˜çš„æ–¹å¼è½»æ¾è§£å†³ä¸€ä¸ªä¸ªç‰ˆæœ¬ã€‚</p>
<p><img src="http://img3.imgtn.bdimg.com/it/u=1698758481,31368498&amp;fm=21&amp;gp=0.jpg" alt="æ¯•ä¸šè®¾è®¡"><br><a id="more"></a><br>æ¯•ä¸šåç”¨è¿‡SVNï¼Œåœ¨è¶…æ˜Ÿæ—¶ç”¨å¾—å°±æ˜¯SVNï¼Œåæ¥åœ¨ä¸–ç•Œé‚¦ç”¨çš„æ˜¯Gitï¼Œå¯¹äºç‰ˆæœ¬æ§åˆ¶æ¥è¯´é‚£ç§éƒ½æ— æ‰€è°“ï¼Œä¸è¿‡å¯¹äºç”¨è¿‡Gitçš„äººæ¥è¯´ï¼ŒGitåœ¨åˆ†æ”¯å’Œåˆ†å¸ƒå¼ç‰ˆæœ¬è¿™å—å’ŒSVNè¿˜æ˜¯æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œä¸è¿‡å°±å†²Gitä¼˜ç§€åˆ†æ”¯ç®¡ç†è¿™å—å¾ˆé€‚åˆå®¢æˆ·ç«¯çš„å¼€å‘ï¼Œç‰ˆæœ¬è¿­ä»£å¿«ã€å›¢é˜Ÿäººæ•°ä¸å¤šï¼Œç”¨èµ·Gitæ›´èƒ½æé«˜è‡ªå·±çš„æ•ˆç‡ã€‚æœ‰äº†å¤©ä¹¦ç¬¬å…­éƒ¨ï¼Œæˆ‘ä»¬è¿˜æ€•å¼ å°å‡¡ä¹ˆï¼Ÿ</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1471440527718.png" width="200"></p>
<h1 id="æ¨è"><a href="#æ¨è" class="headerlink" title="æ¨è"></a>æ¨è</h1><p>è‡³äºGitçš„åŸºç¡€å‘½ä»¤æˆ‘æ¨èå‡ ä¸ªæ¯”è¾ƒå¥½çš„ç½‘ç«™ï¼š</p>
<ol>
<li><a href="http://git-scm.com/book/zh" target="_blank" rel="external">Pro Gitå®˜ç½‘</a></li>
<li><a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="external">å»–é›ªå³°çš„Gitæ•™ç¨‹</a></li>
<li><a href="http://www.ixirong.com/2014/11/19/the-way-to-learn-git/" target="_blank" rel="external">Gitå…¥é—¨æŒ‡å—ä½¿ç”¨èµ„æ–™æ±‡æ€»åŠæ–‡ç« æ¨è</a></li>
<li><a href="http://backlogtool.com/git-guide/cn/" target="_blank" rel="external">å›¾æ–‡å¹¶èŒ‚-çŒ´å­éƒ½èƒ½æ‡‚çš„gitå…¥é—¨æ•™ç¨‹</a></li>
<li><a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="external">A successful Git branching model</a></li>
</ol>
<p>å…¶ä¸­<a href="http://www.ixirong.com/2014/11/19/the-way-to-learn-git/" target="_blank" rel="external">Gitå…¥é—¨æŒ‡å—ä½¿ç”¨èµ„æ–™æ±‡æ€»åŠæ–‡ç« æ¨è</a>æåˆ°äº†<code>git flow</code>â€“<a href="https://github.com/nvie/gitflow" target="_blank" rel="external">é¡¹ç›®åœ°å€</a>,<code>git flow</code>å…¶å®æ˜¯ä¸ºäº†æ›´å¥½çš„åˆ©ç”¨Gitåˆ†æ”¯å¯¹git å‘½ä»¤çš„ä¸€ä¸ªå°è£…ï¼Œçœæ—¶çœåŠ›ï¼Œä¸ä¿¡æ¥å¼ å›¾ã€‚</p>
<h1 id="git-flow"><a href="#git-flow" class="headerlink" title="git flow"></a>git flow</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Git Flowæ¨¡å‹ä¸­å®šä¹‰äº†ä¸»åˆ†æ”¯å’Œè¾…åŠ©åˆ†æ”¯ä¸¤ç±»åˆ†æ”¯ã€‚å…¶ä¸­ä¸»åˆ†æ”¯ç”¨äºç»„ç»‡ä¸è½¯ä»¶å¼€å‘ã€éƒ¨ç½²ç›¸å…³çš„æ´»åŠ¨ï¼›è¾…åŠ©åˆ†æ”¯ç»„ç»‡ä¸ºäº†è§£å†³ç‰¹å®šçš„é—®é¢˜è€Œè¿›è¡Œçš„å„ç§å¼€å‘æ´»åŠ¨ã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1471443465028.png" width="500"></p>
<p><a href="http://7xj9f0.com1.z0.glb.clouddn.com/md/1471441229112.png" target="_blank" rel="external">å¦å¤–çš„ä¸€ä¸ª</a></p>
<h2 id="masteråˆ†æ”¯"><a href="#masteråˆ†æ”¯" class="headerlink" title="masteråˆ†æ”¯"></a><code>masteråˆ†æ”¯</code></h2><p> ä¸»åˆ†æ”¯ï¼Œæ˜¯ä½ å‘ç‰ˆçš„releaseæ—¶æ‰“çš„tagï¼Œæ˜¯ç¨³å®šç‰ˆæœ¬ï¼Œæ¯ä¸€ä¸ªç‰ˆæœ¬éƒ½è¦æ‰“ä¸€ä¸ªversion tagã€‚</p>
<h2 id="developåˆ†æ”¯"><a href="#developåˆ†æ”¯" class="headerlink" title="developåˆ†æ”¯"></a><code>developåˆ†æ”¯</code></h2><p> developåˆ†æ”¯ï¼Œä¸»åˆ†æ”¯å¼€å‘åˆ†æ”¯ï¼Œæ€»æ˜¯æˆ‘ä»¬æœ€æ–°ç‰ˆæœ¬ï¼Œè™½ç„¶ä¸ç¨³å®šï¼Œä½†æ˜¯æœ‰æˆ‘ä»¬æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå½“å¼€å‘å®Œï¼ŒQAé€šè¿‡ï¼Œç‰ˆæœ¬è¿­ä»£å®Œæ¯•ï¼Œå°†<code>develop</code> <code>merge</code>å›ä¸»åˆ†æ”¯ã€‚</p>
<h2 id="è¾…åŠ©åˆ†æ”¯"><a href="#è¾…åŠ©åˆ†æ”¯" class="headerlink" title="è¾…åŠ©åˆ†æ”¯"></a>è¾…åŠ©åˆ†æ”¯</h2><ol>
<li><code>releaseåˆ†æ”¯</code> releaseåˆ†æ”¯æ˜¯ä¸ºå‘å¸ƒæ–°çš„äº§å“ç‰ˆæœ¬è€Œè®¾è®¡çš„ã€‚åœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šçš„ä»£ç å…è®¸åšå°çš„ç¼ºé™·ä¿®æ­£ã€å‡†å¤‡å‘å¸ƒç‰ˆæœ¬æ‰€éœ€çš„å„é¡¹è¯´æ˜ä¿¡æ¯ï¼ˆç‰ˆæœ¬å·ã€å‘å¸ƒæ—¶é—´ã€ç¼–è¯‘æ—¶é—´ç­‰ç­‰ï¼‰ã€‚</li>
<li><code>featureåˆ†æ”¯</code>ï¼šæ˜¯developçš„åŠŸèƒ½åˆ†æ”¯ï¼Œå¦‚æœ‰å‡ ä¸ªåŒäº‹åŒæ—¶å¼€å‘ï¼Œéœ€è¦åˆ‡æ¢æˆå‡ ä¸ªå°åŠŸèƒ½ï¼Œæ¯ä¸ªäººéƒ½éœ€è¦ä»ä»developä¸­æ‹‰å‡ºä¸€ä¸ªfeatureåˆ†æ”¯ï¼Œä½†æ˜¯æ¯ä¸ªfeatureé¢—ç²’è¦å°½é‡å°ï¼Œå› ä¸ºå®ƒéœ€è¦æˆ‘ä»¬èƒ½å°½æ—©mergeä¼šdevelopåˆ†æ”¯ï¼Œå¦åˆ™å†²çªè§£å†³èµ·æ¥å°±æ²¡å®Œæ²¡äº†ã€‚åŒæ—¶ï¼Œå½“ä¸€ä¸ªåŠŸèƒ½å› ä¸ºå„ç§åŸå› ä¸å¼€å‘äº†æˆ–è€…æ”¾å¼ƒäº†ï¼Œè¿™ä¸ªåˆ†æ”¯ç›´æ¥åºŸå¼ƒï¼Œä¸å½±å“å…¶ä»–developåˆ†æ”¯ã€‚</li>
<li><code>hot-fix</code>åˆ†æ”¯ï¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„åˆ†æ”¯ï¼Œå¦‚å›¾æ˜¯ä»masteråˆ†æ”¯ä¸Šåˆ†å‡ºæ¥çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œå¦‚å‘ç‰ˆåå‘ç°æœ‰ä¸ªç´§æ€¥ä¿®å¤çš„bugï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ°hot-fixåˆ†æ”¯ï¼Œä¿®æ”¹å®Œbugï¼Œç»“æŸäº†è¿™ä¸ª<code>hot-fix</code>ï¼Œå›åˆå¹¶ä¿®æ”¹çš„å†…å®¹åˆ°<code>develop</code>åˆ†æ”¯å’Œ<code>mastar</code>åˆ†æ”¯ã€‚</li>
</ol>
<blockquote>
<p>å¸¸ç”¨çš„åˆ†æ”¯çº¦å®šï¼š</p>
<p>ç”¨äºæ–°å»ºå‘å¸ƒåˆ†æ”¯çš„åˆ†æ”¯: develop<br>ç”¨äºåˆå¹¶çš„åˆ†æ”¯: master<br>åˆ†æ”¯å‘½å: release-<em> æˆ– release/</em></p>
</blockquote>
<p>æˆªäº†ä¸€ä¸ª<a href="http://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html" target="_blank" rel="external">git-flow å¤‡å¿˜æ¸…å•</a>ç½‘ç«™ä¸Šçš„å›¾ã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1471442358943.png" width="670"></p>
<h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><h3 id="åˆ›å»ºå¼€å‘åˆ†æ”¯"><a href="#åˆ›å»ºå¼€å‘åˆ†æ”¯" class="headerlink" title="åˆ›å»ºå¼€å‘åˆ†æ”¯"></a>åˆ›å»ºå¼€å‘åˆ†æ”¯</h3><p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1471443398542.png" width="275"></p>
<p><a href="http://backlogtool.com/git-guide/cn/reference/branch.html#sec2" target="_blank" rel="external">åˆ›å»ºä¸€ä¸ªæœ¬åœ°åˆ†æ”¯</a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git branch develop</div><div class="line">git push -u origin develop</div></pre></td></tr></table></figure></p>
<p>æˆ–è€…<a href="http://backlogtool.com/git-guide/cn/reference/remote.html#sec4" target="_blank" rel="external">checkoutä¸€ä»½åˆ°æœ¬åœ°</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout -b develop origin/develop</div></pre></td></tr></table></figure>
<h3 id="åˆå§‹åŒ–git-flow"><a href="#åˆå§‹åŒ–git-flow" class="headerlink" title="åˆå§‹åŒ–git flow"></a>åˆå§‹åŒ–git flow</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git flow init</div></pre></td></tr></table></figure>
<h3 id="featureåˆ†æ”¯"><a href="#featureåˆ†æ”¯" class="headerlink" title="featureåˆ†æ”¯"></a>featureåˆ†æ”¯</h3><p>å¼€å§‹åˆ›å»ºæ–°çš„éœ€æ±‚åˆ†æ”¯</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git flow feature start feature1 #è¿™æ—¶é¡¹ç›®ä¼šè‡ªåŠ¨åˆ‡æ¢ feature/feature1åˆ†æ”¯</div></pre></td></tr></table></figure>
<p>æäº¤æ—¥å¿—åˆ°æœ¬åœ°ä»“åº“<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git commit -a -m <span class="string">"ä¿®æ”¹æ—¥å¿—"</span></div></pre></td></tr></table></figure></p>
<p>å®Œæˆå¼€å‘åˆ†æ”¯åˆå¹¶develop(è‡ªåŠ¨)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git flow feature finish feature1</div></pre></td></tr></table></figure></p>
<p>å‘å¸ƒåˆ°è¿œç¨‹å¼€å‘åˆ†æ”¯<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push origin develop</div></pre></td></tr></table></figure></p>
<h3 id="hotfixåˆ†æ”¯"><a href="#hotfixåˆ†æ”¯" class="headerlink" title="hotfixåˆ†æ”¯"></a>hotfixåˆ†æ”¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">æ›´æ–°masteråˆ†æ”¯</div><div class="line">git pull origin masterï¼ˆæ›´æ–°masteråˆ†æ”¯ä¸ºæœ€æ–°ï¼‰    </div><div class="line"></div><div class="line"> åˆ‡æ¢åˆ°masteråˆ†æ”¯</div><div class="line">git checkout master</div><div class="line"></div><div class="line">ç”Ÿæˆä¸€ä¸ªhotfixåˆ†æ”¯</div><div class="line">git flow hotfix start hfx     </div><div class="line"></div><div class="line"> é€šçŸ¥ç›¸å…³å¾—å·¥ç¨‹å¸ˆå’Œæµ‹è¯•äººå‘˜hotfixåˆ†æ”¯åç§°   </div><div class="line"></div><div class="line"> æœ€ç»ˆæµ‹è¯•å®Œæˆåæ‹‰å›åˆ†æ”¯æœ€æ–°ä»£ç </div><div class="line">git pull origin hotfix/hfx</div><div class="line"></div><div class="line">æœ€ç»ˆä¿®æ”¹å’Œæµ‹è¯•å®Œæˆåï¼Œç»“æŸhot fixä»¥ä¾›å‘å¸ƒ</div><div class="line">git flow hot fix finish hfx</div><div class="line"></div><div class="line"> å‘å¸ƒæœ€ç»ˆçš„masteråˆ†æ”¯</div><div class="line">git push origin master</div></pre></td></tr></table></figure>
<hr>
<p>å‚è€ƒæ–‡ç« </p>
<ol>
<li><a href="http://www.ituring.com.cn/article/56870" target="_blank" rel="external">åŸºäºgitçš„æºä»£ç ç®¡ç†æ¨¡å‹â€”â€”git flow</a></li>
<li><a href="http://backlogtool.com/" target="_blank" rel="external">çŒ´å­éƒ½èƒ½æ‡‚å¾—gitå…¥é—¨</a></li>
<li><a href="http://blog.jobbole.com/76867/" target="_blank" rel="external">Gitå·¥ä½œæµæŒ‡å—ï¼šGitflowå·¥ä½œæµ</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç°åœ¨çš„ç‰ˆæœ¬æ§åˆ¶è¶Šæ¥è¶Šé‡è¦ï¼Œè¿˜è®°å¾—æ¯•ä¸šé‚£ä¼šå†™æ¯•ä¸šè®¾è®¡ä¸€ä¸ªä¸ªç‰ˆæœ¬ï¼Œæå¾—å¤´æ˜è„‘æ¶¨ï¼Œä¸è¿‡å½“æ—¶å·²ç»æ¥è§¦äº†ç‰ˆæœ¬è¿­ä»£åœ¨è‡ªå·±çš„æœºå™¨ä¸Šéƒ¨ç½²äº†ä¸€ä¸ªSVN Serverï¼Œç”¨ç¨‹åºå‘˜çš„æ–¹å¼è½»æ¾è§£å†³ä¸€ä¸ªä¸ªç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img3.imgtn.bdimg.com/it/u=1698758481,31368498&amp;amp;fm=21&amp;amp;gp=0.jpg&quot; alt=&quot;æ¯•ä¸šè®¾è®¡&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Tools" scheme="http://ownwell.github.io/categories/Tools/"/>
    
    
      <category term="Git" scheme="http://ownwell.github.io/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>Anroidæ²‰æµ¸å¼çŠ¶æ€æ </title>
    <link href="http://ownwell.github.io/2016/08/11/Anroid%E6%B2%89%E6%B5%B8%E5%BC%8F%E7%8A%B6%E6%80%81%E6%A0%8F/"/>
    <id>http://ownwell.github.io/2016/08/11/Anroidæ²‰æµ¸å¼çŠ¶æ€æ /</id>
    <published>2016-08-11T06:21:50.000Z</published>
    <updated>2017-05-24T07:19:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>Metarial Designæ˜¯2014å¹´Google IOä¸­Googleé‡ç‚¹æåˆ°çš„ä¸€ä¸ªç‚¹ï¼Œåœ¨è¿‡å»çš„ä¸¤å¹´æ—¶å…‰é‡Œï¼Œè¶Šæ¥è¶Šå¤šçš„å…¬å¸å·²ç»è®¤å¯äº†MDè®¾è®¡è§„èŒƒã€‚åœ¨<a href="https://dribbble.com/" target="_blank" rel="external">dribbble</a>ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œè¶Šæ¥è¶Šå¤šçš„è®¾è®¡å¸ˆå¼€å§‹æŠ•å…¥åˆ°MDè®¾è®¡å®è·µä¸­ï¼ŒMDè®¾è®¡è§„èŒƒç»ˆäºæœ‰åº•æ°”å¯ä»¥å’ŒIOSçš„è®¾è®¡è§„èŒƒå¯¹æŠ—å•¦ï¼ï¼ï¼Androidç¨‹åºå‘˜å¯ä»¥å¾ˆå«åš£æ»´å‘Šè¯‰è®¾è®¡å¸ˆè¿™å°±æ˜¯Androidçš„è®¾è®¡è§„èŒƒã€‚<br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1471272644394.png" width="300"><br><a id="more"></a></p>
<p>å¾ˆå°‘å†™Material Designçš„ä¸œè¥¿ï¼Œä»Šå¤©è¶ç€æ‰‹çƒ­ï¼Œåœ¨MaterialåŒ–è´¢ç»APPçš„æ—¶å€™ï¼Œçœ‹äº†äº›é€æ˜çŠ¶æ€æ /æ²‰æµ¸å¼çŠ¶æ€æ çš„ä¸œè¥¿ï¼Œè§‰å¾—è‡ªå·±å¯èƒ½è¿˜æœ‰å¾ˆå¤šä¸è¶³ä¹‹å¤„åªæ˜¯å¸Œæœ›èƒ½åˆ†äº«å‡ºæ¥ï¼Œä¸€æ–¹é¢æ˜¯è‡ªå·±çš„å­¦ä¹ æˆæœï¼Œå¦ä¸€æ–¹é¢æ˜¯å¸Œæœ›å¤§å®¶æŒ‡æ­£è‡ªå·±åœ¨ç†è§£çš„ä¸åˆ°ä½æˆ–è€…é”™è¯¯ã€‚</p>
<p>å…ˆæ”¾ä¸€å¼ æˆ‘çš„äº”å„¿å­æ‰‹æœºåŸç”Ÿçš„çŸ­ä¿¡æˆªå›¾ï¼š</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1470896523109.png" width="136" alt="å›¾1"></p>
<p>ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ˜¯çŠ¶æ€æ ã€å†…å®¹Viewã€å¯¼èˆªæ ï¼ˆæœ‰äº›æœºå™¨ä¸Šä¸ä¸€å®šæœ‰å¯¼èˆªæ è¿™ä¸ªè™šæ‹Ÿæ ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°çŠ¶æ€æ æ˜¯å½©è‰²çš„ï¼Œä¸æ˜¯ä»¥å‰é‚£ç§é»‘ä¹ä¹çš„çŠ¶æ€æ ï¼Œç°åœ¨ä½ ä¹Ÿå¯ä»¥å®šåˆ¶è‡ªå·±çš„çŠ¶æ€æ äº†(è¿™ä¸ªåº”è¯¥æ˜¯è·ŸIOSå­¦çš„å§ï¼Œä¸è¿‡è¿™ä¸ªå€¼å¾—å­¦ä¹ )ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å°±æ¥çœ‹ä¸‹æˆ‘æ‰‹æœºä¸Šè£…çš„APPçš„ä¸€äº›æˆªå›¾ï¼š<br><span id="pic2"><br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1470968884672.png" width="308" alt="å›¾2"><br></span><br>è¿™ä¸ªäº”ä¸ªåº”ç”¨åˆ†åˆ«æ˜¯ç½‘æ˜“æ–°é—»ã€è±Œè±†èšã€å¾®ä¿¡ã€å°ç±³å¤©æ°”ã€å°æ°”å¤©æ°”ã€‚</p>
<p>&emsp;&emsp;å…³äºè¿™ä¸ªçŠ¶æ€æ å˜è‰²åˆ°åº•å«ã€ŒImmersive Modeã€/ã€ŒTranslucent Barsã€æœ‰å…´è¶£å¯ä»¥å» <a href="http://www.zhihu.com/question/27040217" target="_blank" rel="external">ä¸ºä»€ä¹ˆåœ¨å›½å†…ä¼šæœ‰å¾ˆå¤šç”¨æˆ·æŠŠ ï½¢é€æ˜æ ï½£ï¼ˆTranslucent Barsï¼‰ç§°ä½œ ï½¢æ²‰æµ¸å¼é¡¶æ ï½£ï¼Ÿ</a>ä»¥åŠ<a href="https://www.zhihu.com/question/24908570" target="_blank" rel="external">ä½•ä¸ºæ²‰æµ¸æ¨¡å¼ï¼Œæ²‰æµ¸å¼é¡¶æ ï¼Œå˜è‰²é¾™çŠ¶æ€æ </a>ï¼Œè¿™ä¸ªå†å²åŸå› æˆ‘ä»¬å°±æ²¡æ³•å»è¯´å¤§å®¶é”™è¯¯ï¼Œæ‰€æœ‰å°±é”™è¯´é”™æœ‰äº†æ²‰æµ¸å¼çŠ¶æ€æ ä¸€è¯´ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°çŠ¶æ€æ ä¹Ÿå¯ä»¥æŒ‰ç…§æˆ‘ä»¬çš„éœ€è¦å®šåˆ¶çš„å¾ˆç‚«é…·ï¼ŒDo not you think soã€‚</p>
<p>åœ¨5.0ä¹‹åæˆ‘ä»¬æ˜¯å¯ä»¥é€šè¿‡v7åŒ…ä¸‹çš„<code>Theme.AppCompat</code>ä¸€äº›åˆ—ä¸»é¢˜ä¸ºAPPçš„é¡µé¢è®¾ç½®Activityçš„çš„çŠ¶æ€æ ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"BaseAppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="comment">&lt;!-- Customize your theme here. --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimary"</span>&gt;</span>@color/colorPrimary<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;</span>@color/colorPrimaryDark<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorAccent"</span>&gt;</span>@color/colorAccent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsTranslucent"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯ä¸ºäº†ä½¿Android 4.4 å’ŒAndroid 5+å¹³å°çš„ç»Ÿä¸€ï¼Œæˆ‘ä»¬æ”¾å¼ƒè¿™æ ·æ–¹å¼ï¼Œä¸è¿‡è¿™æ ·ç®€å•å¤„ç†ä¹Ÿæ˜¯v7 compatç»™å¤§å®¶çš„ä¸€ä¸ªç¦åˆ©ã€‚</p>
<p>ä¸ºäº†æ›´å¥½çš„æ“ä½œæˆ‘ä»¬çš„çŠ¶æ€æ StatusBarï¼Œæˆ‘ä»¬éœ€è¦å®šåˆ¶è‡ªå·±çš„çŠ¶æ€æ ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¾ç½®çŠ¶æ€æ çš„é¢œè‰²ï¼Œå¯ä»¥éšæ—¶æ”¹å˜çŠ¶æ€æ çš„é€æ˜åº¦ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±æ¥å®šåˆ¶ä¸€å¥—å¯è¡Œçš„æ–¹æ¡ˆã€‚</p>
<h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><ol>
<li><p><strong>å…¨å±æ¨¡å¼å’Œç€è‰²æ¨¡å¼</strong><br>æ ¹æ®å†…å®¹å»¶ä¼¸çš„è§’åº¦å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šå…¨å±æ¨¡å¼å’Œç€è‰²æ¨¡å¼ã€‚å…¶ä¸­,<a href="#pic2">å›¾2</a> ä¸­å‰ä¸‰ä¸ªé¡µé¢éƒ½æ˜¯çŠ¶æ€æ å›ºå®šåœ¨ä¸Šæ–¹ï¼Œæ— è®ºä¸‹é¢æ€ä¹ˆæ»‘åŠ¨ï¼Œå†…éƒ¨Viewéƒ½æ˜¯é‚£ä¸€å—å›ºå®šçš„å¤§å°åŒºåŸŸæ»‘åŠ¨ï¼Œç”±äºçŠ¶æ€æ æ˜¯å›ºå®šåœ¨ä¸€å®šä½ç½®ä¸”æœ‰ç€è‰²ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç€è‰²æ¨¡å¼ï¼Œè€Œ<a href="#pic2">å›¾2</a>ä¸­åä¸¤ä¸ªé¡µé¢æˆªå›¾ä¸­ï¼Œå†…å®¹Viewå’ŒçŠ¶æ€æ åƒæ”¾åœ¨ä¸€ä¸ª<code>FrameLayout</code>ä¸€æ ·ï¼Œæ˜¯å±‚å å…³ç³»å¹¶ä¸”çŠ¶æ€æ æ˜¯é€æ˜ï¼Œå†…å®¹Viewå¯ä»¥å»¶ä¼¸åˆ°çŠ¶æ€æ ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå…¨å±æ¨¡å¼ã€‚</p>
</li>
<li><p><strong>é€æ˜çŠ¶æ€æ å’Œå½©è‰²çŠ¶æ€æ </strong><br>æ ¹æ®çŠ¶æ€æ çš„é¢œè‰²ï¼Œå¯ä»¥åˆ†ä¸ºçŠ¶æ€æ é€æ˜å’Œä¸é€æ˜ï¼ˆç½‘æ˜“æ–°é—»ã€å°ç±³å¤©æ°”éƒ½æ˜¯é€æ˜ï¼Œè€Œè±Œè±†èšã€wechatéƒ½æ˜¯ä¸é€æ˜ï¼‰ã€‚<br>ä»¥ä¸Šä¸¤ç§åˆ†ä¸ºæ˜¯ä¸åŒç»´åº¦çš„ï¼Œä»ä¸åŒç»´åº¦æ¥çœ‹å¯ä»¥ç»„åˆå¦‚ä¸‹å›¾:</p>
</li>
</ol>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1470997766590.png" width="300"></p>
<h3 id="setFitsSystemWindows"><a href="#setFitsSystemWindows" class="headerlink" title="setFitsSystemWindows"></a>setFitsSystemWindows</h3><p>åœ¨android docæ˜¯è¿™ä¹ˆæè¿°çš„ï¼š</p>
<blockquote>
<p>void setFitsSystemWindows (boolean fitSystemWindows)<br>Sets whether or not this view should account for system screen decorations such as the status bar and inset its content; that is, controlling whether the default implementation of fitSystemWindows(Rect) will be executed. See that method for more details.</p>
<p>Note that if you are providing your own implementation of fitSystemWindows(Rect), then there is no need to set this flag to true â€“ your implementation will be overriding the default implementation that checks this flag.</p>
</blockquote>
<p>å¤§æ¦‚æ„æ€æ˜¯ï¼š<code>setFitsSystemWindows</code>ç”¨æ¥è®¾ç½®å½±å“ç³»ç»Ÿçš„å·¥å…·æ å¦‚çŠ¶æ€æ ï¼Œå†³å®šäº†è¿™ä¸ªviewæ˜¯å¦æ’å…¥åˆ°å®ƒçš„ContentViewã€‚å½“æ‚¨è®¾ç½®äº†fitSystemWindows(Rect)è€Œæ²¡æœ‰å°†<code>setFitsSystemWindows</code>è®¾ç½®ä¸ºtrueï¼Œä½ å¯¹fitSystemWindows(Rect)è®¾ç½®æ˜¯æ— æ•ˆçš„.</p>
<p>è¯¥å±æ€§è®¾ç½®ä¸ºtrueæ—¶,ä¼šé¢„ç•™å‡ºçŠ¶æ€æ çš„ç©ºé—´ã€‚</p>
<p>ç”±äºè¿™ä¸ªå®åœ¨API14(4.0)ä¹‹åçš„å‡½æ•°ï¼Œä¸ºäº†å…¼å®¹ä½ç‰ˆæœ¬ï¼Œæ‰æœ‰V4é‡Œé¢çš„<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ViewCompat.setFitsSystemWindows(rootView,<span class="keyword">false</span>);</div></pre></td></tr></table></figure></p>
<h2 id="é€æ˜çŠ¶æ€æ "><a href="#é€æ˜çŠ¶æ€æ " class="headerlink" title="é€æ˜çŠ¶æ€æ "></a>é€æ˜çŠ¶æ€æ </h2><p>ç”±äºAndroid 4.4æ‰åŠ å…¥é€æ˜çŠ¶æ€æ ï¼ŒAndroid 5.0ä¹‹åå¯ä»¥ç›´æ¥è®¾ç½®çŠ¶æ€æ å’Œå¯¼èˆªæ ï¼Œè€Œä¸æ˜¯ä¹‹å‰çš„é»‘ä¹ä¹çš„çŠ¶æ€æ ï¼Œä½†æ˜¯ï¼Œåœ¨4.4ä»¥ä¸‹çš„ç³»ç»Ÿä¸Šï¼Œæƒ³è‡ªå·±å®šä¹‰çŠ¶æ€æ å°±æ— èƒ½ä¸ºåŠ›äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°†Android 4.4å’ŒAndroid5.0è§†ä¸ºè¾¹ç•Œã€‚</p>
<h3 id="Android-4-4è®¾ç½®é€æ˜çŠ¶æ€æ "><a href="#Android-4-4è®¾ç½®é€æ˜çŠ¶æ€æ " class="headerlink" title="Android 4.4è®¾ç½®é€æ˜çŠ¶æ€æ "></a>Android 4.4è®¾ç½®é€æ˜çŠ¶æ€æ </h3><p>è®¾ç½®æ–¹æ³•æœ‰ä¸¤ç§:</p>
<p> <strong>ä»£ç </strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">            <span class="comment">// è®¾ç½®çŠ¶æ€æ é€æ˜</span></div><div class="line">             activity.getWindow()</div><div class="line">                .setFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS, WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>XML</strong></p>
<p> åœ¨values-v19æ–‡ä»¶å¤¹ä¸‹ï¼Œä¸ºactivityçš„Style æ·»åŠ ä¸€ä¸ªå±æ€§ï¼š</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> <span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"@style/BaseAppTheme"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowTranslucentStatus"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<p>è¿™æ ·è®¾ç½®çš„ç»“æœæ˜¯contentviewçš„ä½ç½®çš„ä¸Šç§»ï¼ŒçŠ¶æ€æ é€æ˜ã€‚</p>
<h3 id="Android-5-0-é€æ˜çŠ¶æ€æ "><a href="#Android-5-0-é€æ˜çŠ¶æ€æ " class="headerlink" title="Android 5.0+é€æ˜çŠ¶æ€æ "></a>Android 5.0+é€æ˜çŠ¶æ€æ </h3><p>ä¸è¿‡å¯¹äº5.0ç³»ç»Ÿï¼Œä¸Šé¢çš„è®¾ç½®åçš„ç»“æœå¯èƒ½ä¸æ˜¯é€æ˜å“¦ï¼ˆåœ¨åŸç”Ÿæœºå™¨æ˜¯ä¸é€æ˜çš„ï¼Œä½†æ˜¯åœ¨å°ç±³çš„æ˜¯é€æ˜çš„ï¼Œä¼°è®¡MIUIåšäº†ä¸€äº›ä¼˜åŒ–å·¥ä½œï¼‰</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1470904408961.png" width="135"></p>
<p>è‹¥æ˜¯è¦å®Œå…¨é€æ˜ï¼Œå°±éœ€è¦çœ‹é¢å¤–å¤„ç†ï¼Œåœ¨å†…å®¹å»¶ä¼¸åˆ°çŠ¶æ€æ ä¸€èŠ‚æœ‰ä»‹ç»ã€‚</p>
<p>å½“ç„¶äº†ä½ ä¹Ÿå¯ä»¥ç”¨5.0çš„<code>setStatusBarColor</code></p>
<p><span id="5status">å…¨å±æ¨¡å¼çš„é€æ˜çŠ¶æ€æ </span></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Window window = activity.getWindow();</div><div class="line"><span class="comment">//è®¾ç½®é€æ˜çŠ¶æ€æ ,è¿™æ ·æ‰èƒ½è®© ContentView å‘ä¸Š</span></div><div class="line">window.addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</div><div class="line"></div><div class="line"><span class="comment">//éœ€è¦è®¾ç½®è¿™ä¸ª flag æ‰èƒ½è°ƒç”¨ setStatusBarColor æ¥è®¾ç½®çŠ¶æ€æ é¢œè‰²</span></div><div class="line">window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);</div><div class="line"><span class="comment">//è®¾ç½®çŠ¶æ€æ é¢œè‰²</span></div><div class="line">window.setStatusBarColor(statusColor);</div><div class="line"></div><div class="line"><span class="comment">//ä¸ºäº†è®¾ç½®å…¨å±</span></div><div class="line">ViewGroup mContentView = (ViewGroup) activity.findViewById(Window.ID_ANDROID_CONTENT);</div><div class="line">View mChildView = mContentView.getChildAt(<span class="number">0</span>);</div><div class="line"><span class="keyword">if</span> (mChildView != <span class="keyword">null</span>) &#123;</div><div class="line">    <span class="comment">//æ³¨æ„ä¸æ˜¯è®¾ç½® ContentView çš„ FitsSystemWindows, è€Œæ˜¯è®¾ç½® ContentView çš„ç¬¬ä¸€ä¸ªå­ View . ä½¿å…¶ä¸ä¸ºç³»ç»Ÿ View é¢„ç•™ç©ºé—´.</span></div><div class="line">    ViewCompat.setFitsSystemWindows(mChildView, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ViewCompat.setFitsSystemWindows(mChildView, false)ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸ºfalseå°±æ˜¯å…¨å±æ¨¡å¼ï¼Œè€Œè®¾ç½®æˆtrueã€‚åƒä¸Šè¿°å®ä¾‹ä¸­ï¼Œ ViewCompat.setFitsSystemWindows(mChildView, false)å°±æ˜¯è¯´mChildViewå¯ä»¥ç›´æ¥å»¶ä¼¸åˆ°phoneWindowçš„é¡¶éƒ¨ï¼Œç›¸å½“äºå°ç±³å¤©æ°”çš„é‚£ç§æ•ˆæœã€‚</p>
</blockquote>
<h2 id="å½©è‰²çŠ¶æ€æ "><a href="#å½©è‰²çŠ¶æ€æ " class="headerlink" title="å½©è‰²çŠ¶æ€æ "></a>å½©è‰²çŠ¶æ€æ </h2><p>æœ‰é€æ˜çŠ¶æ€æ ï¼Œå°±æœ‰å½©è‰²çŠ¶æ€æ ã€‚<br>åœ¨5.0+è®¾ç½®çŠ¶æ€æ å¾ˆç®€å•å°±å‚ç…§<a href="#5status">å…¨å±æ¨¡å¼çš„é€æ˜çŠ¶æ€æ </a>ä¸­çš„ä»£ç åšä¿®æ”¹<code>window.setStatusBarColor(int color)</code>ï¼Œè€Œå¯¹äºAndroid 4.4â€“5.0çš„æ€ä¹ˆåŠå‘¢ï¼ŒAndroid4.4æ˜¯æä¾›<code>setStatusBarColor</code>è¿™ä¸ªæ–¹æ³•çš„ã€‚</p>
<p>æˆ‘ä»¬å°±æƒ³åˆ°äº†åœ¨ä¸Šé¢æåˆ°çš„å…¨å±é€æ˜çŠ¶æ€æ çš„åŸºç¡€ä¸ŠåŠ ä¸€ä¸ªå’ŒçŠ¶æ€æ ä¸€æ ·é«˜åº¦çš„ç©ºç™½Viewæ”¾åˆ°é¡¶éƒ¨ã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1471188010910.png" width="350"></p>
<p>å¥½äº†è¯´å¹²å°±å¹²ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    	activity.getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</div><div class="line"> <span class="comment">//æ·»åŠ ä¸€ä¸ªç©ºç™½çš„viewåˆ°æ‰‹æœºå±å¹•çš„é¡¶éƒ¨</span></div><div class="line">addStatusBarBehind(activity, color, statusBarAlpha);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public static void addStatusBarBehind(Activity activity, int color, int statusBarAlpha) &#123;</div><div class="line">        ViewGroup decorView = (ViewGroup) activity.getWindow().getDecorView();</div><div class="line">        int       count     = decorView.getChildCount();</div><div class="line">        if (count &gt; 0 &amp;&amp; decorView.getChildAt(count - 1) instanceof StatusBarView) &#123;</div><div class="line">            decorView.getChildAt(count - 1).setBackgroundColor(calculateStatusColor(color, statusBarAlpha));</div><div class="line">        &#125; else &#123;</div><div class="line">            StatusBarView statusView = createStatusBarView(activity, color, statusBarAlpha);</div><div class="line">            decorView.addView(statusView);</div><div class="line">        &#125;</div><div class="line">        setRootView(activity);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="å…¨å±æ¨¡å¼"><a href="#å…¨å±æ¨¡å¼" class="headerlink" title="å…¨å±æ¨¡å¼"></a>å…¨å±æ¨¡å¼</h2><p>å…¨å±æ¨¡å¼ï¼Œå†…å®¹å»¶ä¼¸åˆ°çŠ¶æ€æ ç±»ä¼¼ä¸å°ç±³å¤©æ°”çš„APPï¼Œå…ˆè€ƒè™‘ä¸‹æ€ä¹ˆåšï¼Ÿ</p>
<blockquote>
<p>ç­”æ¡ˆï¼šå°†å†…å®¹ç§»åˆ°çŠ¶æ€æ ä¸‹ï¼Œå¹¶ä¸”çŠ¶æ€æ èƒŒæ™¯é€æ˜.</p>
</blockquote>
<h3 id="Android4-4â€“5-0"><a href="#Android4-4â€“5-0" class="headerlink" title="Android4.4â€“5.0"></a>Android4.4â€“5.0</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">          <span class="comment">// è®¾ç½®çŠ¶æ€æ é€æ˜</span></div><div class="line">          activity.getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</div><div class="line">          <span class="comment">//  è®¾ç½®æ ¹å¸ƒå±€çš„å‚æ•°</span></div><div class="line">          ViewGroup rootView = (ViewGroup) ((ViewGroup) activity.findViewById(android.R.id.content)).getChildAt(<span class="number">0</span>);</div><div class="line">          ViewCompat.setFitsSystemWindows(rootView,<span class="keyword">false</span>);</div><div class="line">          rootView.setClipToPadding(<span class="keyword">true</span>);</div><div class="line">      &#125;</div></pre></td></tr></table></figure>
<p>å…¶å®å°±å…ˆå°†çŠ¶æ€æ è®¾ç½®äº†é€æ˜<code>activity.getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS)</code>,è€Œåå¯ä»¥ç›´æ¥è®¾ç½®å†…å®¹çš„æ ¹Viewæ¥ç›´æ¥è®¾ç½®<code>ViewCompat.setFitsSystemWindows(rootView,false)</code>,è¿™æ ·å°±å¯ä»¥ç›´æ¥è®²æ ¹rootViewç›´æ¥é¡¶ä¸Šå»ï¼Œå’ŒçŠ¶æ€æ çš„é¡¶éƒ¨å¯¹é½ã€‚</p>
<h3 id="Android-5-0"><a href="#Android-5-0" class="headerlink" title="Android 5.0+"></a>Android 5.0+</h3><p>åœ¨Android 4.4ä¸Šè®¾ç½®é€æ˜çŠ¶æ€æ ï¼Œåœ¨5.0ä¸Šä¾ç„¶å¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼Œåˆ©ç”¨5.0å®ç°çš„<a href="#5status">å…¨å±æ¨¡å¼çš„é€æ˜çŠ¶æ€æ </a>ä¸è¿‡çŠ¶æ€æ å®é™…ä¸Šå¹¶ä¸å®Œå…¨ä¸ºé€æ˜è‰²ï¼Œä¼šæœ‰äº›è®¸ç°è‰²ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸ªä½¿æˆ‘ä»¬èƒ½æ¥å—çš„ï¼Œå¦‚å¾®ä¿¡ã€QQç­‰éƒ½æ˜¯çŠ¶æ€æ é¢œè‰²æš—ä¸ä¸‹é¢çš„Toolbarçš„ã€‚</p>
<p>è‹¥æ˜¯èƒ½é€šè¿‡Activityçš„Themeçš„<code>colorPrimaryDark</code>è®¾çŠ¶æ€æ é¢œè‰²é¢œè‰²è®¾ç½®ï¼Œä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯è‹¥ä½ mustå®ç°é€æ˜é¢çŠ¶æ€æ ï¼Œä¹Ÿåªèƒ½å‡ºç‹ æ‹›äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Window window = activity.getWindow();</div><div class="line"></div><div class="line">window.clearFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS|</div><div class="line">| WindowManager.LayoutParams.FLAG_TRANSLUCENT_NAVIGATION);</div><div class="line">window.getDecorView().setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN| View.SYSTEM_UI_FLAG_LAYOUT_STABLE);           window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);</div><div class="line">window.setStatusBarColor(Color.TRANSPARENT);</div></pre></td></tr></table></figure>
<p><code>setSystemUiVisibility</code>è¿™ä¸ªå¯ä»¥å‚è€ƒ<a href="https://developer.android.com/training/system-ui/immersive.html?hl=zh-cn#nonsticky" target="_blank" rel="external">Using Immersive Full-Screen Mode</a>ã€‚</p>
<hr>
<p>è¿™æ ·çš„ç»„åˆï¼Œè®©æˆ‘ä»¬å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚æ¥å®šåˆ¶è‡ªå·±çš„çŠ¶æ€æ ï¼Œéšåä¼šå¼€æºè‡ªå·±å°è£…çš„å¼€æºåº“å·¥ä¾›å¤§å®¶å‚è€ƒã€‚</p>
<hr>
<p>å…·ä½“å®ç°è¯·å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="http://ownwell.github.io/2016/08/26/android-status-bar/">Androidä¸‹å¤šå½©çš„StatusViewçš„å®ç°</a></p>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><ol>
<li><a href="https://developer.android.com/training/system-ui/immersive.html?hl=zh-cn#nonsticky" target="_blank" rel="external">Using Immersive Full-Screen Mode</a></li>
</ol>
<ol>
<li><p><a href="http://blog.csdn.net/sbsujjbcy/article/details/48391863" target="_blank" rel="external">Androidå®ç°æ²‰æµ¸å¼çŠ¶æ€æ </a></p>
</li>
<li><p><a href="http://niorgai.github.io/2016/03/20/Android-transulcent-status-bar/" target="_blank" rel="external">Android-transulcent-status-bar</a></p>
</li>
<li><p><a href="http://www.jianshu.com/p/2ef52f357aa0" target="_blank" rel="external">AndroidçŠ¶æ€æ åˆé›†-ç®¡ä½ é€ä¸é€æ˜</a></p>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Metarial Designæ˜¯2014å¹´Google IOä¸­Googleé‡ç‚¹æåˆ°çš„ä¸€ä¸ªç‚¹ï¼Œåœ¨è¿‡å»çš„ä¸¤å¹´æ—¶å…‰é‡Œï¼Œè¶Šæ¥è¶Šå¤šçš„å…¬å¸å·²ç»è®¤å¯äº†MDè®¾è®¡è§„èŒƒã€‚åœ¨&lt;a href=&quot;https://dribbble.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;dribbble&lt;/a&gt;ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œè¶Šæ¥è¶Šå¤šçš„è®¾è®¡å¸ˆå¼€å§‹æŠ•å…¥åˆ°MDè®¾è®¡å®è·µä¸­ï¼ŒMDè®¾è®¡è§„èŒƒç»ˆäºæœ‰åº•æ°”å¯ä»¥å’ŒIOSçš„è®¾è®¡è§„èŒƒå¯¹æŠ—å•¦ï¼ï¼ï¼Androidç¨‹åºå‘˜å¯ä»¥å¾ˆå«åš£æ»´å‘Šè¯‰è®¾è®¡å¸ˆè¿™å°±æ˜¯Androidçš„è®¾è®¡è§„èŒƒã€‚&lt;br&gt;&lt;img src=&quot;http://7xj9f0.com1.z0.glb.clouddn.com/md/1471272644394.png&quot; width=&quot;300&quot;&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://ownwell.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Realmåˆ†äº«ç›´æ’­ç¬”è®°</title>
    <link href="http://ownwell.github.io/2016/07/28/realm-note/"/>
    <id>http://ownwell.github.io/2016/07/28/realm-note/</id>
    <published>2016-07-28T14:53:51.000Z</published>
    <updated>2017-04-19T05:57:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©å¾ˆå¹¸è¿ï¼Œçœ‹åˆ°äº†å¾å·è€å¸ˆå‘çš„ä¸€æ¡æ¶ˆæ¯ï¼Œè¯´ä¸‹åˆï¼Œç¾¤é‡Œè¯·å¤§ç¥è®²Realmï¼Œå°±æŠ¥åå‚åŠ äº†ã€‚<br><a id="more"></a><br>s</p>
<p>å¹²è´§å¤ªå¤šï¼Œä¸æ•¢ç‹¬äº«ã€‚è™½ç„¶å½¢å¼ç®€å•ï¼Œä½†æ˜¯å†…å®¹ä¸å°‘ï¼Œç°åœ¨æˆ‘å°±åˆ†äº«å‡ºæ¥æ‰€æœ‰å†…å®¹çš„æˆªå›¾ï¼š</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1469717889374.png" alt="image"></p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1469717935563.png" alt="image"></p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1469717973648.png" alt="image"></p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1469717988310.png" alt="image"></p>
<p>æœ‰æ—¶é—´ä¼šæ•´ç†æˆæ–‡å­—ï¼Œæœ‰å–œæ¬¢è¿™ç§ç±»ä¼¼ç›´æ’­çš„åŒå­¦å¯ä»¥åŠ å¾å·è€å¸ˆçš„å¾®ä¿¡(pockry001)ï¼š</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©å¾ˆå¹¸è¿ï¼Œçœ‹åˆ°äº†å¾å·è€å¸ˆå‘çš„ä¸€æ¡æ¶ˆæ¯ï¼Œè¯´ä¸‹åˆï¼Œç¾¤é‡Œè¯·å¤§ç¥è®²Realmï¼Œå°±æŠ¥åå‚åŠ äº†ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://ownwell.github.io/categories/Android/"/>
    
    
      <category term="Realm" scheme="http://ownwell.github.io/tags/Realm/"/>
    
  </entry>
  
  <entry>
    <title>[Androoid]å¼€æºè‡ªå·±çš„é¡¹ç›®åˆ°JCenter</title>
    <link href="http://ownwell.github.io/2016/07/14/push-library-to-jcenter/"/>
    <id>http://ownwell.github.io/2016/07/14/push-library-to-jcenter/</id>
    <published>2016-07-14T03:15:17.000Z</published>
    <updated>2017-05-24T07:19:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿï¼Œæ¨¡å—ä¸æ¨¡å—ä¹‹é—´ï¼Œå°½å¯èƒ½çš„ä½¿å…¶ç‹¬ç«‹å­˜åœ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®©æ¯ä¸ªæ¨¡å—ï¼Œå°½å¯èƒ½çš„ç‹¬ç«‹å®ŒæˆæŸä¸ªç‰¹å®šçš„å­åŠŸèƒ½ã€‚æ¨¡å—ä¸æ¨¡å—ä¹‹é—´çš„æ¥å£ï¼Œå°½é‡çš„å°‘è€Œç®€å•ã€‚<br><a id="more"></a></p>
<p>åœ¨å†™æ–‡ç« ä¹‹å‰å…ˆåŠä¹¦è¢‹å­äº†ä¸€ä¸‹ï¼Œå‘Šè¯‰å¤§å®¶è½¯ä»¶è®¾è®¡ä¸­çš„ä½è€¦åˆï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šæŠŠä¸€ä¸ªä¸ªæ¨¡å—åˆ†å¼€ï¼Œæ¨¡å—ä¹‹å‰ç›¸äº’ç‹¬ç«‹ï¼Œå³æ’å³ç”¨ï¼Œè¿™ä¸ªä¹¦è¢‹å­åŠçš„è¿˜å¯ä»¥å§ã€‚<br><img src="http://img4.imgtn.bdimg.com/it/u=835084131,3132971467&amp;fm=21&amp;gp=0.jpg" alt="maven"></p>
<p>æ‰€ä»¥mavenåœ¨ä¸€ä¸ªå¤§å‹ç³»ç»Ÿæ˜¯ç»å¸¸è§åˆ°çš„ï¼Œå¦‚å„ä¸ªæ¨¡å—åšæˆç‹¬ç«‹çš„å‹ç¼©æ–‡ä»¶å¦‚jarï¼Œæ”¾åœ¨æœåŠ¡å™¨ä¸Šï¼Œæ‰€æœ‰éœ€è¦çš„éƒ½å¯ä»¥ç›´æ¥DownLoadåˆ°æœ¬åœ°ï¼Œæ‹¿æ¥ç”¨ï¼Œè¿™æ˜¯ä¸€ç§å¾ˆçˆ½çš„ä½“éªŒå§ã€‚</p>
<p>æ‰€ä»¥Mavenä½¿æˆ‘ä»¬è§£å†³ä¾èµ–çš„ä¸€ç§æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œå½“ç„¶äº†ä½ ä¹Ÿå¯ä»¥é€šè¿‡mavenæ¥æ„å»ºé¡¹ç›®ã€‚ä½†æ˜¯è¿™ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ï¼Œæˆ‘ä»¬è¦è®²çš„æ˜¯å¯¹äºandroidå¼€å‘è€…å¦‚ä½•ä¸Šä¼ è‡ªå·±çš„é¡¹ç›®åˆ°JCenter(ä¸€ä¸ªä¾›ç¨‹åºå‘˜ç©è€çš„Mavenä»“åº“)ï¼Œä¸–ç•Œä¸Šæ‰€æœ‰çš„ç¨‹åºå‘˜éƒ½å¯ä»¥é€šè¿‡JCenterä¸Šä¼ è‡ªå·±çš„é¡¹ç›®æˆ–è€…ä¸‹è½½åˆ«äººçš„é¡¹ç›®æ¥ä½¿ç”¨ã€‚</p>
<th><img src="http://qq.yh31.com/tp/qq/ZJBQ/201111/201111041444379709.gif" alt="è—è§†"></th>

<h1 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h1><h2 id="æ³¨å†Œ"><a href="#æ³¨å†Œ" class="headerlink" title="æ³¨å†Œ"></a>æ³¨å†Œ</h2><p>JCenterä½œä¸ºä¸€ä¸ªè§„æ¨¡ç›¸å½“å¤§çš„ä¸­å¿ƒä»“åº“ï¼Œæˆ‘ä»¬éœ€è¦åˆ°<a href="https://bintray.com/#" target="_blank" rel="external">https://bintray.com/#</a>ï¼Œå»æ³¨å†Œçš„è´¦å·ï¼Œè‹¥ä½ æœ‰è´¦å·è·³è¿‡è¿™ä¸€æ­¥ã€‚æ³¨å†Œä¸€èˆ¬é€šè¿‡é‚®ç®±éªŒè¯ï¼Œè¯•ä¸‹ç™»å½•æ˜¯å¦æ³¨å†ŒæˆåŠŸã€‚</p>
<h2 id="è·å–API-key"><a href="#è·å–API-key" class="headerlink" title="è·å–API key"></a><span id="apikey">è·å–API key</span></h2><p> æ³¨å†Œå®Œæˆåæˆ‘ä»¬éœ€è¦æŸ¥çœ‹è‡ªå·±çš„keyï¼Œè¿›å…¥åˆ°<a href="https://bintray.com/profile/edit" target="_blank" rel="external">https://bintray.com/profile/edit</a>ï¼Œçœ‹åˆ°æœ‰ä¸ªAPI KEYè¾“å…¥å¯†ç å°±å¯ä»¥è§åˆ°ï¼Œä¸‹é¢ä¼šç”¨åˆ°è¿™ä¸ªkeyã€‚</p>
<h2 id="è®¤è¯†GAV"><a href="#è®¤è¯†GAV" class="headerlink" title="è®¤è¯†GAV"></a>è®¤è¯†GAV</h2><p>ä¸ºäº†ç¡®å®šä½ çš„åŒ…å”¯ä¸€ï¼Œæˆ‘ä»¬ä½¿ç”¨GAVæ¥ä¿è¯ï¼Œå¦‚ä¸‹é¢çš„é…ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;    </div><div class="line">  	&lt;groupId&gt;org.apache.struts&lt;/groupId&gt;    </div><div class="line">	&lt;artifactId&gt;struts2-core&lt;/artifactId&gt;    </div><div class="line">	&lt;version&gt;2.0.11&lt;/version&gt;    </div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>groupId æ˜¯ä½ çš„Groupçš„å”¯ä¸€æ ‡ç¤º<br>artifactId  ä½ çš„é¡¹ç›®åç§°<br>version   é¡¹ç›®çš„ç‰ˆæœ¬    </p>
<p>æ‰€ä»¥ä½ è¦ç¡®å®šè‡ªå·±çš„groupIdå’ŒartifactIdã€‚</p>
<h1 id="é…ç½®gradleä¸Šä¼ mavençš„é…ç½®"><a href="#é…ç½®gradleä¸Šä¼ mavençš„é…ç½®" class="headerlink" title="é…ç½®gradleä¸Šä¼ mavençš„é…ç½®"></a>é…ç½®gradleä¸Šä¼ mavençš„é…ç½®</h1><h3 id="åœ¨æ›´é¡¹ç›®çš„build-gradleæ·»åŠ å¦‚ä¸‹å‡ å¥ï¼š"><a href="#åœ¨æ›´é¡¹ç›®çš„build-gradleæ·»åŠ å¦‚ä¸‹å‡ å¥ï¼š" class="headerlink" title="åœ¨æ›´é¡¹ç›®çš„build.gradleæ·»åŠ å¦‚ä¸‹å‡ å¥ï¼š"></a>åœ¨æ›´é¡¹ç›®çš„build.gradleæ·»åŠ å¦‚ä¸‹å‡ å¥ï¼š</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"> dependencies &#123;</div><div class="line">        â€¦â€¦</div><div class="line">        classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.4'</div><div class="line">        classpath 'com.github.dcendents:android-maven-gradle-plugin:1.3'</div><div class="line">        â€¦â€¦</div><div class="line">&#125;</div><div class="line">```   </div><div class="line"></div><div class="line"></div><div class="line">### å‡†å¤‡è„šæœ¬å’Œé…ç½®</div><div class="line"> æ–°å»ºä¸€ä¸ªå‘å¸ƒåˆ°Jcenterçš„gradleè„šæœ¬åˆ°ä½ çš„library,è¿™ä¸ªè„šæœ¬æ˜¯å•ç‹¬å¤„ç†å’ŒJCenterä¸Šä¼ çš„æ“ä½œ</div><div class="line"></div><div class="line"></div><div class="line">bintray.gradleæ–‡ä»¶</div><div class="line">```apply plugin: 'com.github.dcendents.android-maven'</div><div class="line">apply plugin: 'com.jfrog.bintray'</div><div class="line"></div><div class="line">Properties properties = new Properties()</div><div class="line">properties.load(project.file('bintray.properties').newDataInputStream())</div><div class="line">def siteUrl = properties.getProperty("bintray.siteUrl")</div><div class="line"></div><div class="line">def desc = properties.getProperty("bintray.descrip")</div><div class="line"></div><div class="line">// Maven Group ID for the artifactï¼Œä¸€èˆ¬å¡«ä½ å”¯ä¸€çš„åŒ…å</div><div class="line">group = properties.getProperty("bintray.group")</div><div class="line">version = properties.getProperty("bintray.version")</div><div class="line"></div><div class="line">def giturl = properties.getProperty("bintray.vcs")</div><div class="line">def userid = properties.getProperty("bintray.userid")</div><div class="line">def username = properties.getProperty("bintray.username")</div><div class="line">def useremail = properties.getProperty("bintray.useremail")</div><div class="line"></div><div class="line">def licensename = properties.getProperty("bintray.licensename")</div><div class="line">def licenseurl = properties.getProperty("bintray.licenseurl")</div><div class="line">install &#123;</div><div class="line">    repositories.mavenInstaller &#123;</div><div class="line">         // This generates POM.xml with proper parameters</div><div class="line">        pom &#123;</div><div class="line">            project &#123;</div><div class="line">                packaging 'aar'</div><div class="line">                // Add your description here</div><div class="line">                name desc //é¡¹ç›®æè¿°</div><div class="line"></div><div class="line">               url siteUrl</div><div class="line">               // Set your license</div><div class="line">               licenses &#123;</div><div class="line">                   license &#123;</div><div class="line">                       name licensename</div><div class="line">                       url licenseurl</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                developers &#123;</div><div class="line">                    developer &#123;</div><div class="line">                        id userid</div><div class="line">                        name username</div><div class="line">                        email useremail</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                scm &#123;</div><div class="line">                    connection giturl</div><div class="line">                    developerConnection giturl</div><div class="line">                    url siteUrl</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">task sourcesJar(type: Jar) &#123;</div><div class="line">    from android.sourceSets.main.java.srcDirs</div><div class="line">    classifier = 'sources'</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">task javadoc(type: Javadoc) &#123;</div><div class="line">    source = android.sourceSets.main.java.srcDirs</div><div class="line">    classpath += project.files(android.getBootClasspath().join(File.pathSeparator))</div><div class="line">&#125;</div><div class="line"></div><div class="line">task javadocJar(type: Jar, dependsOn: javadoc) &#123;</div><div class="line">    classifier = 'javadoc'</div><div class="line">    from javadoc.destinationDir</div><div class="line">&#125;</div><div class="line">artifacts &#123;</div><div class="line">//    archives javadocJar</div><div class="line">    archives sourcesJar</div><div class="line"></div><div class="line">&#125;</div><div class="line">bintray &#123;</div><div class="line">    user = properties.getProperty("bintray.user")</div><div class="line">    key = properties.getProperty("bintray.key")</div><div class="line">    configurations = ['archives']</div><div class="line">    pkg &#123;</div><div class="line">        repo = "maven"</div><div class="line">        name = properties.getProperty("bintray.name") //å‘å¸ƒåˆ°JCenterä¸Šçš„é¡¹ç›®åå­—</div><div class="line">        websiteUrl = properties.getProperty("bintray.siteUrl")</div><div class="line">        vcsUrl = properties.getProperty("bintray.vcs")</div><div class="line">        licenses =[properties.getProperty("bintray.licenses")]</div><div class="line">                publish = true</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½ çœ‹åˆ°çš„é‚£äº›<code>bintray.licenses</code>éƒ½æ˜¯æˆ‘ä»¬éœ€è¦æ–°å»ºå¦å¤–ä¸€ä¸ªé…ç½®æ–‡ä»¶çš„ï¼š</p>
<hr>
<p>bintray.propertiesæ–‡ä»¶<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">bintray.key= #å¡«å†™åˆšæ‰è·å–[API key](#apikey)ä¸­çš„key</div><div class="line">bintray.user=#å¡«å†™åˆšæ‰ç™»å½•æ—¶çš„æ˜µç§°</div><div class="line"></div><div class="line">bintray.userid=</div><div class="line">bintray.username=#éœ€è¦æ˜¾ç¤ºåœ¨mavenä¸­çš„ä½œè€…æ˜µç§°</div><div class="line">bintray.useremail=#éœ€è¦æ˜¾ç¤ºåœ¨mavenä¸­çš„ä½œè€…é‚®ç®±</div><div class="line"></div><div class="line">bintray.licensename=The Apache Software License, Version 2.0</div><div class="line">bintray.licenseurl=http://www.apache.org/licenses/LICENSE-2.0.txt</div><div class="line"></div><div class="line">bintray.group=#é¡¹ç›®çš„groupId</div><div class="line">bintray.name=#é¡¹ç›®åç§°</div><div class="line">bintray.version=#é¡¹ç›®ç‰ˆæœ¬å·</div><div class="line">bintray.siteUrl=#é¡¹ç›®çš„å¯¹åº”ç½‘ç«™</div><div class="line">bintray.vcs=#é¡¹ç›®çš„åœ°å€å¦‚githunç­‰ä»£ç æ‰˜ç®¡çš„é“¾æ¥</div><div class="line">bintray.licenses=#å¼€æºåè®®å¦‚mitç­‰</div><div class="line">bintray.descrip=é¡¹ç›®æè¿°</div><div class="line">`</div></pre></td></tr></table></figure></p>
<p>å‡†å¤‡å¦¥å½“äº†ï¼Œéœ€è¦æŠŠgradleè„šæœ¬æ”¾åˆ°ä½ çš„librayçš„<code>build.gradle</code>,å› ä¸ºé¡¹ç›®æ‰§è¡Œä¼šå»æ‰§è¡Œ<code>build.gradle</code>,æˆ‘ä»¬æŠŠåˆšæ‰çš„bintray.gradle</p>
<p>apply from: â€œbintray.gradleâ€</p>
<p>æ•´ä¸ªé¡¹ç›®ç»“æ„æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆçœ‹</p>
<p>library<br>â€“main<br>   â€“java<br>â€“build.gradle åœ¨ç»“å°¾è®°å¾—åŠ apply from: â€œbintray.gradleâ€<br>â€“bintray.gradle<br>â€“bintray.properties</p>
<h3 id="ä¸Šä¼ "><a href="#ä¸Šä¼ " class="headerlink" title="ä¸Šä¼ "></a>ä¸Šä¼ </h3><p>./gradlew clean bintrayUpload</p>
<p>è¿™æ ·å°±å¯ä»¥ä¸Šä¼ åˆ°jcenterä¸Šï¼Œå»ä½ çš„jcenterè´¦å·ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰æ–‡ä»¶ä¸Šä¼ æˆåŠŸå§ã€‚</p>
<h3 id="ç”³è¯·åŒæ­¥åˆ°jcenter"><a href="#ç”³è¯·åŒæ­¥åˆ°jcenter" class="headerlink" title="ç”³è¯·åŒæ­¥åˆ°jcenter"></a>ç”³è¯·åŒæ­¥åˆ°jcenter</h3><p>ä¼šçœ‹åˆ°å·¦ä¾§ä½¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„GAV<br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1470416953314.png" width="685"></p>
<p>å³ä¾§æ˜¯æˆ‘ä»¬éœ€è¦è‡ªå·±å¡«å†™åŒæ­¥åˆ°jcenterçš„ï¼Œå¦åˆ™åªæ˜¯ç§æœ‰åº“ä¸èƒ½ç›´æ¥é€šè¿‡jcenterè®¿é—®ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿï¼Œæ¨¡å—ä¸æ¨¡å—ä¹‹é—´ï¼Œå°½å¯èƒ½çš„ä½¿å…¶ç‹¬ç«‹å­˜åœ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®©æ¯ä¸ªæ¨¡å—ï¼Œå°½å¯èƒ½çš„ç‹¬ç«‹å®ŒæˆæŸä¸ªç‰¹å®šçš„å­åŠŸèƒ½ã€‚æ¨¡å—ä¸æ¨¡å—ä¹‹é—´çš„æ¥å£ï¼Œå°½é‡çš„å°‘è€Œç®€å•ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://ownwell.github.io/categories/Android/"/>
    
    
      <category term="JCenter" scheme="http://ownwell.github.io/tags/JCenter/"/>
    
  </entry>
  
  <entry>
    <title>æ‰©å¤§viewçš„ç‚¹å‡»åŒºåŸŸ</title>
    <link href="http://ownwell.github.io/2016/06/19/expand_touch/"/>
    <id>http://ownwell.github.io/2016/06/19/expand_touch/</id>
    <published>2016-06-19T09:54:20.000Z</published>
    <updated>2017-05-24T07:19:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨åšä¸€ä¸ªä¸€ä¸ªé¡µé¢ï¼Œå‘ç°æœ‰äº›å°Buttonå®åœ¨æ˜¯å¾ˆéš¾å‡»ä¸­,å¯èƒ½ä½ ä¼šæƒ³å„ç§åŠæ³•ï¼Œæ¯”å¦‚åœ¨å¤–é¢å¥—ä¸€ä¸ªå¤§çš„å®¹å™¨ã€æŠŠPaddingè®¾ç½®çš„å¤§ä¸€ç‚¹ç­‰ç­‰ï¼Œä»Šå¤©ç»™ä½ æä¾›ä¸€ä¸ªæ–°æ€è·¯ã€‚<br><a id="more"></a></p>
<h1 id="æ‰©å¤§viewçš„ç‚¹å‡»åŒºåŸŸ"><a href="#æ‰©å¤§viewçš„ç‚¹å‡»åŒºåŸŸ" class="headerlink" title="æ‰©å¤§viewçš„ç‚¹å‡»åŒºåŸŸ"></a>æ‰©å¤§viewçš„ç‚¹å‡»åŒºåŸŸ</h1><p>ä»Šå¤©åœ¨çœ‹Viewä»£ç æ—¶ï¼Œå‘ç°æœ‰ä¸ªæ–¹æ³•å«<code>setTouchDelegate</code>ï¼Œåæ¥æŸ¥é˜…äº†ä¸€ä¸‹å‘ç°è¿™ä¸ªå®é™…ä¸Šæ˜¯ä¸ªä»£ç†ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒçš„çˆ¶ç»„ä»¶æ¥æ‰©å¤§ç‚¹å‡»åŒºåŸŸã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1470736727319.png" width="299"></p>
<p>ä»£ç å¾ˆç®€å•ï¼Œç›´æ¥è´´ä¸Šå§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * æ‰©å¤§Viewçš„è§¦æ‘¸å’Œç‚¹å‡»å“åº”èŒƒå›´,æœ€å¤§ä¸è¶…è¿‡å…¶çˆ¶ViewèŒƒå›´</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> view</div><div class="line">     * <span class="doctag">@param</span> top</div><div class="line">     * <span class="doctag">@param</span> bottom</div><div class="line">     * <span class="doctag">@param</span> left</div><div class="line">     * <span class="doctag">@param</span> right</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">expandViewTouchDelegate</span><span class="params">(<span class="keyword">final</span> View view, <span class="keyword">final</span> <span class="keyword">int</span> top,</span></span></div><div class="line">                                               <span class="keyword">final</span> <span class="keyword">int</span> bottom, <span class="keyword">final</span> <span class="keyword">int</span> left, <span class="keyword">final</span> <span class="keyword">int</span> right) &#123;</div><div class="line"></div><div class="line">        ((View) view.getParent()).post(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                Rect bounds = <span class="keyword">new</span> Rect();</div><div class="line">                view.setEnabled(<span class="keyword">true</span>);</div><div class="line">                view.getHitRect(bounds);</div><div class="line"></div><div class="line">                bounds.top -= top;</div><div class="line">                bounds.bottom += bottom;</div><div class="line">                bounds.left -= left;</div><div class="line">                bounds.right += right;</div><div class="line"></div><div class="line">                TouchDelegate touchDelegate = <span class="keyword">new</span> TouchDelegate(bounds, view);</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (View.class.isInstance(view.getParent())) &#123;</div><div class="line">                    ((View) view.getParent()).setTouchDelegate(touchDelegate);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è¿˜åŸViewçš„è§¦æ‘¸å’Œç‚¹å‡»å“åº”èŒƒå›´,æœ€å°ä¸å°äºViewè‡ªèº«èŒƒå›´</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> view</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">restoreViewTouchDelegate</span><span class="params">(<span class="keyword">final</span> View view)</span> </span>&#123;</div><div class="line"></div><div class="line">        ((View) view.getParent()).post(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                Rect bounds = <span class="keyword">new</span> Rect();</div><div class="line">                bounds.setEmpty();</div><div class="line">                TouchDelegate touchDelegate = <span class="keyword">new</span> TouchDelegate(bounds, view);</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (View.class.isInstance(view.getParent())) &#123;</div><div class="line">                    ((View) view.getParent()).setTouchDelegate(touchDelegate);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨åšä¸€ä¸ªä¸€ä¸ªé¡µé¢ï¼Œå‘ç°æœ‰äº›å°Buttonå®åœ¨æ˜¯å¾ˆéš¾å‡»ä¸­,å¯èƒ½ä½ ä¼šæƒ³å„ç§åŠæ³•ï¼Œæ¯”å¦‚åœ¨å¤–é¢å¥—ä¸€ä¸ªå¤§çš„å®¹å™¨ã€æŠŠPaddingè®¾ç½®çš„å¤§ä¸€ç‚¹ç­‰ç­‰ï¼Œä»Šå¤©ç»™ä½ æä¾›ä¸€ä¸ªæ–°æ€è·¯ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://ownwell.github.io/categories/Android/"/>
    
    
      <category term="View" scheme="http://ownwell.github.io/tags/View/"/>
    
  </entry>
  
  <entry>
    <title>Activityç”Ÿå‘½å‘¨æœŸå’Œå¯åŠ¨æ¨¡å¼</title>
    <link href="http://ownwell.github.io/2016/06/01/2016-06-01%E3%80%8AAndroid%E5%BC%80%E5%8F%91%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B01/"/>
    <id>http://ownwell.github.io/2016/06/01/2016-06-01ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹è¯»ä¹¦ç¬”è®°1/</id>
    <published>2016-06-01T03:15:17.000Z</published>
    <updated>2017-05-24T07:19:18.000Z</updated>
    
    <content type="html"><![CDATA[<div align="center"><br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/android-book.png" align="middle"><br></div>

<p>ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹æ˜¯ä¸€æœ¬å¾ˆåˆé€‚åˆé«˜çº§å·¥ç¨‹å¸ˆæ¥å­¦ä¹ å’Œè¿›é˜¶ï¼Œè¿™ç§ä¹¦å¤šè¯»è¯»å¯¹è‡ªå·±ä¹Ÿæœ‰æˆé•¿ã€‚ä½œè€…ä¹Ÿæ˜¯ä»è‡ªå·±çš„å¼€å‘ç»éªŒè§’åº¦å‡ºå‘ï¼Œä¼¼ä¸€ä½å¯¼å¸ˆä¸€æ ·ç»™æˆ‘ä»¬è®²è§£ï¼Œæˆ‘è®¤ä¸ºè¿™æœ¬ä¹¦å¯¹æˆ‘çœŸçš„æœ‰æé«˜ï¼Œä»åŸºç¡€çš„Activityçš„ç”Ÿå‘½å‘¨æœŸåˆ°ç»„ä»¶å®šåˆ¶ï¼Œå†åˆ°å››å¤§ç»„ä»¶çš„å·¥ä½œåŸç†ï¼Œå¾ˆå®ç”¨çš„æŠ€æœ¯ã€‚</p>
<a id="more"></a>
<h1 id="Activityçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Activityçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Activityçš„ç”Ÿå‘½å‘¨æœŸ"></a>Activityçš„ç”Ÿå‘½å‘¨æœŸ</h1><h2 id="1-1-Activityçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#1-1-Activityçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1.1 Activityçš„ç”Ÿå‘½å‘¨æœŸ"></a>1.1 Activityçš„ç”Ÿå‘½å‘¨æœŸ</h2><ol>
<li><p><code>onCreate</code> <code>Activity</code> åˆ›å»ºæ—¶çš„åˆå§‹åŒ–å·¥ä½œ å¦‚è®¾ç½®é¡µé¢çš„ContentViewã€æ¥æ”¶å‚æ•°ç­‰.</p>
</li>
<li><p><code>onRestart</code> åœ¨<code>Activity</code>çš„<code>onStop</code>åé‡æ–°å¯åŠ¨æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå‚æ•°</p>
</li>
<li><p><code>onStart</code>  æ­£åœ¨å¯åŠ¨ï¼Œå³å°†å¼€å§‹ï¼Œæ²¡æœ‰å‡ºç°åœ¨å‰å°ï¼Œè¿˜æ— æ³•å’Œç”¨æˆ·äº¤äº’ï¼Œå¯ä»¥ç†è§£ä¸ºå·²ç»åˆå§‹åŒ–å®Œæˆï¼Œä½†æ˜¯å¤„äºåå°æˆ‘ä»¬æš‚æ—¶æ²¡æ³•çœ‹è§ã€‚</p>
</li>
<li><p><code>onResume</code>  å¯è§äº†å¹¶ä¸”å¤„äºæ¿€æ´»æ€,å¤„äºå‰å°ã€‚</p>
<blockquote>
<p>å’ŒonStartæœ€å¤§çš„ä¸åŒå°±æ˜¯onStartæ˜¯åœ¨åå°å·²ç»åˆå§‹åŒ–å®Œï¼Œä½†æ˜¯æ— æ³•äº¤äº’ã€‚</p>
</blockquote>
</li>
<li><p><code>onPause</code>  å¤±å»ç„¦ç‚¹ä¸å¯ä»¥äº¤äº’ã€å¤„äºåå°ã€‚</p>
</li>
<li><p><code>onStop</code> å³å°†åœæ­¢ï¼Œåšä¸€äº›ç¨å¾®é‡é‡çº§å›æ”¶ç±»çš„å·¥ä½œ</p>
</li>
<li><p><code>onDestory</code> Activityå³å°†è¢«é”€æ¯ï¼Œéœ€è¦ä»¬åšä¸€äº›å›æ”¶å’Œèµ„æºé‡Šæ”¾ç±»çš„å·¥ä½œã€‚</p>
</li>
</ol>
<p>ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼š</p>
<p><img src="http://p.blog.csdn.net/images/p_blog_csdn_net/hpoi/EntryImages/20091003/347621596238419942633901667161718750.jpg" alt=""></p>
<p>æˆ–è€…åŒå¦å¤–ä¸€ä¸ªè§’åº¦æ¥çœ‹Activityç”Ÿå‘½å‘¨æœŸä¹‹é—´çš„å…³ç³»ã€‚<br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/activity_life.png" alt=""></p>
<h2 id="å¼‚å¸¸çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨"><a href="#å¼‚å¸¸çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨" class="headerlink" title="å¼‚å¸¸çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨"></a>å¼‚å¸¸çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨</h2><p>å…¶å®æˆ‘ä»¬å¼€å‘ä¸­ä¸€èˆ¬æ˜¯æŒ‰ç…§è¿™æ ·çš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œï¼Œä½†æ˜¯ä¹Ÿä¼šæœ‰å¼‚å¸¸çš„ä¸€äº›å¤„ç†ï¼Œå¦‚ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œä¼šæ€æ­»ä¸€äº›è¿›ç¨‹ï¼Œä»¥å›æ”¶ä¸€éƒ¨åˆ†èµ„æºï¼Œæ¥ä¿è¯ç³»ç»Ÿä»å¯ä»¥æ­£å¸¸çš„è¿è¡Œã€‚å…·ä½“çš„ä¾‹å­å¯ä»¥å‚ç…§ï¼š<a href="http://itindex.net/detail/50832-%E5%86%85%E5%AD%98-android-%E7%B3%BB%E7%BB%9F" target="_blank" rel="external">å†…å­˜ä¸è¶³æ—¶Android ç³»ç»Ÿå¦‚ä½•Killè¿›ç¨‹</a>ï¼Œkillè¿›ç¨‹çš„é¡ºåºï¼š</p>
<p><strong>ç©ºè¿›ç¨‹â€” åå°è¿›ç¨‹ -&gt; æœåŠ¡è¿›ç¨‹ -&gt; å¯è§è¿›ç¨‹ -&gt; å‰å°è¿›ç¨‹</strong></p>
<p>ç›¸å¯¹äºå¼‚å¸¸Activityçš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹å®é™…ä¸Šæ˜¯ç²¾ç®€ç‰ˆçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æˆ‘ä»¬æŒ‰Homeé”®ï¼Œå½“å‰çš„è¿›ç¨‹(å®é™…ä¸Šå·²ç»æˆä¸ºäº†åå°è¿›ç¨‹)å¯èƒ½ä¼šç”±äºå†…å­˜ä¸è¶³ç­‰å…¶ä»–åŸå› ï¼Œè¢«ç³»ç»Ÿçš„killæ‰ï¼Œæ­¤æ—¶æ‰§è¡Œæ—¶çš„æ˜¯onPauseâ€“&gt;onStop è¿˜æœ‰ä¸€ä¸ªæ˜¯ä¸ºäº†ä¿å­˜activityæ•°æ®çŠ¶æ€çš„onSaveInstanceState,è¿™äº›å±äºå¸¸è§çš„å†…å®¹ï¼Œå¯ä»¥è‡ªè¡Œ<a href="http://google.com" target="_blank" rel="external">æœç´¢</a></p>
<h1 id="Activityçš„å¯åŠ¨æ¨¡å¼-LaunchMode"><a href="#Activityçš„å¯åŠ¨æ¨¡å¼-LaunchMode" class="headerlink" title="Activityçš„å¯åŠ¨æ¨¡å¼(LaunchMode)"></a>Activityçš„å¯åŠ¨æ¨¡å¼(LaunchMode)</h1><p>Activityçš„å¯åŠ¨æ¨¡å¼è¿™ä¸ªæ˜¯æˆ‘ä»¬åšä¹…é¡¹ç›®ï¼Œå¿…é¡»è¦æ€è€ƒå’Œç ”ç©¶é¢å†…å®¹ï¼Œåœ¨å¾ˆå¤šæ—¶å€™ï¼Œç†è§£è¿™äº›ä¼šäº‹å€åŠŸå€ã€‚</p>
<p>Activityä¸€å…±æœ‰å››ç§å¯åŠ¨æ–¹å¼ï¼šstandardã€SingleTaskã€SingleTopã€SingleInstanceã€‚æ¯æ¬¡Activityå¯åŠ¨éƒ½ä¼šåŠ å…¥åŠ å…¥ä»»åŠ¡æ ˆï¼Œå½“é”€æ¯æ—¶åˆä»ä»»åŠ¡æ ˆä¸­é€€å‡ºï¼Œä»»åŠ¡æ ˆæ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºçš„æ ˆç»“æ„ï¼Œå½“ä»»åŠ¡æ ˆä¸­æ²¡æœ‰Activityæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›æ”¶æ”¹ä»»åŠ¡æ ˆã€‚</p>
<p>åœ¨æˆ‘ä»¬å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æŸä¸€ä¸ªActivityï¼ˆå¦‚ä¸»ç•Œé¢çš„MainActivityï¼‰å§‹ç»ˆåªæœ‰ä¸€ä¸ªï¼Œæ²¡å¿…è¦æ¯æ¬¡startActivityéƒ½æ–°å»ºä¸€ä¸ªå§ã€‚æ‰€ä»¥æ€ä¹ˆåŒºåˆ†è¿™äº›é©±åŠ¨æ¨¡å¼å‘¢ï¼Ÿ</p>
<h2 id="Standard-æ ‡å‡†æ¨¡å¼"><a href="#Standard-æ ‡å‡†æ¨¡å¼" class="headerlink" title="Standard æ ‡å‡†æ¨¡å¼"></a>Standard æ ‡å‡†æ¨¡å¼</h2><blockquote>
<p>è‹¥æ²¡æœ‰ç»™Activityè®¾ç½®å¯åŠ¨æ¨¡å¼ï¼Œé»˜è®¤çš„è®¾ç½®å°±æ˜¯æ ‡å‡†æ¨¡å¼ã€‚</p>
</blockquote>
<p>æ ‡å‡†çš„Activityçš„å¯åŠ¨æ–¹å¼ï¼Œæ¯æ¬¡å¯åŠ¨éƒ½ä¼šæ–°å»ºä¸€ä¸ªæ–°çš„Activityï¼Œå¦‚Activity A(standart)å¯¹è±¡å¯åŠ¨Activity Bï¼ˆstandardï¼‰ï¼Œå°±ä¼šæ‰§è¡Œæ ‡å‡†çš„Activityçš„ç”Ÿå‘½å‘¨æœŸï¼š</p>
<p> onPause â€“&gt; onStop â€“&gt;onCreate â€“&gt; onStart â€¦â€¦</p>
<p>è¿™æ ·ä»»åŠ¡æ ˆä¸­å°±æœ‰äº†A B(ä»æ ˆä½åˆ°æ ˆé¡¶çš„é¡ºåº)ï¼Œå½“Båœ¨é‡æ–°å¯åŠ¨Aæ—¶ï¼Œå°±æˆäº†ABAã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/launchmode1.png" alt="å›¾ 2-1"></p>
<blockquote>
<ol>
<li>é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œå¯åŠ¨ä¸€ä¸ªå¯åŠ¨æ¨¡å¼ä¸ºstandardçš„Activityå¯åŠ¨å¦ä¸€ä¸ªå¯åŠ¨æ¨¡å¼ä¸ºstandardçš„Activityï¼Œä¼šå°†å¯åŠ¨çš„Activityæ”¾å…¥åˆ°å‰ä¸€ä¸ªActivityçš„ä»»åŠ¡æ ˆä¸­ï¼Œå¦‚å›¾2-7 æ‰€ç¤ºã€‚</li>
<li>é€šè¿‡å…¨å±€AppicationContextå¯åŠ¨ä¸€ä¸ªActivityï¼Œç”±äºApplicationçš„contextæ²¡æœ‰åœ¨ä»»åŠ¡æ ˆï¼Œæ‰€ä»¥å¿…é¡»æ·»åŠ FLAG_ACITIVITY_NEW_TASK è¿™ä¸ªæ ‡å¿—ä½ï¼Œæ¥æ–°å»ºä¸€ä¸ªä»»åŠ¡æ ˆã€‚</li>
</ol>
</blockquote>
<h2 id="SingleTop-æ ˆé¡¶å¤ç”¨æ¨¡å¼ã€‚"><a href="#SingleTop-æ ˆé¡¶å¤ç”¨æ¨¡å¼ã€‚" class="headerlink" title="SingleTop æ ˆé¡¶å¤ç”¨æ¨¡å¼ã€‚"></a>SingleTop æ ˆé¡¶å¤ç”¨æ¨¡å¼ã€‚</h2><p>è¯¥æ¨¡å¼ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§æ˜¯æ ˆé¡¶å¤ç”¨ï¼Œå½“å¯åŠ¨ä¸€ä¸ªå¯åŠ¨æ¨¡å¼ä¸ºSingleTopçš„Activityï¼Œä¼šå…ˆå»æ‰¾è¿™ä¸ªActivityæ‰€åœ¨çš„ä»»åŠ¡æ ˆçš„é¡¶éƒ¨æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œè‹¥æ ˆé¡¶æœ‰è¯¥Activityåˆ™ä¼šå¤ç”¨ï¼Œä¸ä¼šé‡æ–°æ–°å»ºActivityï¼Œè€Œæ˜¯å¤ç”¨è¯¥Activityï¼Œå¹¶è°ƒç”¨è¯¥Activityçš„onNewIntentæ–¹æ³•ã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/launchmode_singleTop.png" alt="å›¾ 2-2"></p>
<h2 id="SingleTask-æ ˆå†…å¤ç”¨"><a href="#SingleTask-æ ˆå†…å¤ç”¨" class="headerlink" title="SingleTask æ ˆå†…å¤ç”¨"></a>SingleTask æ ˆå†…å¤ç”¨</h2><p>SingleTaskæ¨¡å¼ï¼Œæ˜¯æ ˆå†…çš„å•ä¾‹ï¼Œå½“ä¸€ä¸ªAcitiviyå·²ç»åœ¨æ ˆå†…å­˜åœ¨ï¼Œå¤šæ¬¡å¯åŠ¨è¿™ä¸ªActivityä¸ä¼šé‡æ–°åˆ›å»ºè¿™ä¸ªActivityå®ä¾‹ï¼Œè€Œæ˜¯ä¼šç›´æ¥è°ƒç”¨è¿™ä¸ªæ ˆå†…å·²ç»å­˜åœ¨çš„è¯¥Activityå®ä¾‹ï¼Œç³»ç»Ÿä¼šè°ƒç”¨è¿™ä¸ªActivityçš„onNewIntentï¼ŒåŒæ—¶ä¼šæ¸…é™¤æ ˆå†…è¿™ä¸ªActivityåˆ°æ ˆé¡¶çš„æ‰€æœ‰Activityå®ä¾‹ï¼Œå®é™…ä¸ŠclearTopçš„æ•ˆæœã€‚</p>
<p>å¦‚å›¾2-2ï¼Œåªæœ‰3-2 å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œå› ä¸ºåœ¨Bâ€“&gt;Aæ—¶ï¼ŒAcitivity Aæ˜¯åœ¨ä»»åŠ¡æ ˆä¸­çš„ï¼Œä¼šå°†Acitivity Aè°ƒè‡³æ ˆé¡¶ï¼Œæ¸…é™¤Aåˆ°æ ˆé¡¶çš„æ‰€æœ‰Activityï¼Œæœ€åå°±åªæœ‰Activity Aã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;center&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xj9f0.com1.z0.glb.clouddn.com/android-book.png&quot; align=&quot;middle&quot;&gt;&lt;br&gt;&lt;/div&gt;

&lt;p&gt;ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹æ˜¯ä¸€æœ¬å¾ˆåˆé€‚åˆé«˜çº§å·¥ç¨‹å¸ˆæ¥å­¦ä¹ å’Œè¿›é˜¶ï¼Œè¿™ç§ä¹¦å¤šè¯»è¯»å¯¹è‡ªå·±ä¹Ÿæœ‰æˆé•¿ã€‚ä½œè€…ä¹Ÿæ˜¯ä»è‡ªå·±çš„å¼€å‘ç»éªŒè§’åº¦å‡ºå‘ï¼Œä¼¼ä¸€ä½å¯¼å¸ˆä¸€æ ·ç»™æˆ‘ä»¬è®²è§£ï¼Œæˆ‘è®¤ä¸ºè¿™æœ¬ä¹¦å¯¹æˆ‘çœŸçš„æœ‰æé«˜ï¼Œä»åŸºç¡€çš„Activityçš„ç”Ÿå‘½å‘¨æœŸåˆ°ç»„ä»¶å®šåˆ¶ï¼Œå†åˆ°å››å¤§ç»„ä»¶çš„å·¥ä½œåŸç†ï¼Œå¾ˆå®ç”¨çš„æŠ€æœ¯ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="è¯»ä¹¦" scheme="http://ownwell.github.io/categories/%E8%AF%BB%E4%B9%A6/"/>
    
    
      <category term="ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹è¯»ä¹¦ç¬”è®°" scheme="http://ownwell.github.io/tags/%E3%80%8AAndroid%E5%BC%80%E5%8F%91%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Androidå¼€å‘å¤‡å¿˜</title>
    <link href="http://ownwell.github.io/2016/05/09/Android%E5%BC%80%E5%8F%91%E5%A4%87%E5%BF%98/"/>
    <id>http://ownwell.github.io/2016/05/09/Androidå¼€å‘å¤‡å¿˜/</id>
    <published>2016-05-09T02:02:24.000Z</published>
    <updated>2017-05-24T07:19:20.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a>
<p> Viewç›¸å…³</p>
<ol>
<li><p>çˆ¶ç»„ä»¶çš„ç„¦ç‚¹çŠ¶æ€æ€ä¹ˆè®¾ç½®</p>
<p>LinearLayoutæœ‰ä¸€ä¸ªå¾ˆå¥½çš„å±æ€§ Android:addStatesFromChildren=â€trueâ€ï¼Œå°±æ˜¯å­ç»„ä»¶çš„çŠ¶æ€å†³å®šäº†çˆ¶ç»„ä»¶çš„çŠ¶æ€ã€‚</p>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="http://blog.csdn.net/finddreams/article/details/45502277" target="_blank" rel="external">Androidç™»å½•ç•Œé¢è´¦å·å¯†ç è¾“å…¥æ¡†é€‰ä¸­æ—¶ï¼Œé€‰ä¸­èƒŒæ™¯å˜æ¢çš„å®ç°æ–¹æ³•</a></p>
</li>
</ol>
<h2 id="ButterKnifeå¤šå‚æ•°"><a href="#ButterKnifeå¤šå‚æ•°" class="headerlink" title="ButterKnifeå¤šå‚æ•°"></a>ButterKnifeå¤šå‚æ•°</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@OnClick(&#123;</div><div class="line">            R.id.dialog_dau_share_wx,</div><div class="line">            R.id.dialog_dau_share_wx_timeline,</div><div class="line">            R.id.dialog_dau_share_weibo,</div><div class="line">            R.id.dialog_dau_share_qq</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<h1 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h1><h2 id="æ£€æµ‹Appæ˜¯å¦å®‰è£…"><a href="#æ£€æµ‹Appæ˜¯å¦å®‰è£…" class="headerlink" title="æ£€æµ‹Appæ˜¯å¦å®‰è£…"></a>æ£€æµ‹Appæ˜¯å¦å®‰è£…</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">// æ£€æŸ¥Appæ˜¯å¦å®‰è£…</div><div class="line">private boolean appInstalledOrNot(String uri) &#123;</div><div class="line">    PackageManager pm = getPackageManager();</div><div class="line">    boolean app_installed;</div><div class="line">    try &#123;</div><div class="line">        pm.getPackageInfo(uri, PackageManager.GET_ACTIVITIES);</div><div class="line">        app_installed = true;</div><div class="line">    &#125; catch (PackageManager.NameNotFoundException e) &#123;</div><div class="line">        app_installed = false;</div><div class="line">    &#125;</div><div class="line">    return app_installed;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Android-Studio-Tips"><a href="#Android-Studio-Tips" class="headerlink" title="Android Studio Tips"></a>Android Studio Tips</h1><p><a href="https://github.com/pavlospt/Android-Studio-Tips-by-Philippe-Breault/wiki" target="_blank" rel="external">https://github.com/pavlospt/Android-Studio-Tips-by-Philippe-Breault/wiki</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt; Viewç›¸å…³&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;çˆ¶ç»„ä»¶çš„ç„¦ç‚¹çŠ¶æ€æ€ä¹ˆè®¾ç½®&lt;/p&gt;
&lt;p&gt;LinearLayoutæœ‰ä¸€ä¸ªå¾ˆå¥½çš„å±æ€§ Android:addStatesFromChildren=â€trueâ€ï¼Œå°±æ˜¯å­ç»„ä»¶çš„çŠ¶æ€å†³å®šäº†çˆ¶ç»„ä»¶çš„çŠ¶æ€
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Fragment+Tabå®ç°æ‡’åŠ è½½</title>
    <link href="http://ownwell.github.io/2016/04/22/fragment-tab-host/"/>
    <id>http://ownwell.github.io/2016/04/22/fragment-tab-host/</id>
    <published>2016-04-22T15:12:58.000Z</published>
    <updated>2017-05-24T07:19:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç°åœ¨Googleå·²ç»åœ¨æ–°çš„APP UIè§„èŒƒä¸­å¼€å§‹æå€¡ä½¿ç”¨åº•éƒ¨å¯¼èˆªæ ï¼ˆ<code>BottomNavigation</code>ï¼‰ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„ä¾§æ‹‰å¯¼èˆªæ ï¼ˆ<code>NavigationView</code>,å¯¹äºå¤§å±æ‰‹æœºï¼Œè¿™ä¸ªè§„èŒƒæ˜¯å¾ˆäººæ€§çš„ã€‚<code>BottomNavigation</code>åˆ†ä¸ºåº•éƒ¨çš„Tabå¯¼èˆªæ å’Œä¸Šé¢çš„å†…å®¹å±•ç¤ºéƒ¨åˆ†ï¼Œå®ç°ä¸Šï¼Œæ¯ä¸ªTabå¯¹åº”ä¸€ä¸ª<code>Fragment</code>ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æˆ‘ä»¬æ­£ç¡®å¤„ç†æ¯ä¸ª<code>Fragment</code>åœ¨Tabé—´è¿›è¡Œåˆ‡æ¢ï¼ŒåŒæ—¶æ¯æ¬¡æ‰“å¼€é‚£ä¸ªTabæ—¶ï¼Œé‚£ä¸ªTabå¯¹åº”çš„<code>Fragment</code>æ‰åŠ è½½ã€‚<br><a id="more"></a></p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/QQ20160422-1.png" alt="tab"></p>
<blockquote>
<p>å¦‚ä¸Šå›¾ï¼š</p>
<ol>
<li>å½“é€‰ä¸­ä¸‹é¢çš„Tabæ—¶,å¯¹åº”çš„Tabæ˜¾ç¤ºï¼ˆå…¶å®åœ¨ä»£ç å®ç°ä¸Šå°±æ˜¯Fragmentèƒ½åŠ è½½æ˜¾ç¤ºï¼‰</li>
<li>å¯¹äºç¬¬ä¸€æ¬¡åŠ è½½çš„Tabï¼Œéœ€è¦è¿›è¡Œåˆå§‹åŒ–å’ŒåŠ è½½å·¥ä½œï¼Œè€Œå¯¹äºå·²ç»åŠ è½½è¿‡çš„Tab,åªéœ€è¦åŠ è½½å³å¯ï¼Œä½†æ˜¯ä¸èƒ½å†æ¬¡è¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚</li>
</ol>
</blockquote>
<p>å°±æ˜¯è¯´æ¯ä¸€ä¸ªtabå¯¹åº”ä¸€ä¸ª<code>Fragemnt</code>ï¼Œåˆ‡æ¢Tabæ—¶èƒ½æ­£ç¡®åˆ‡æ¢åˆ°<code>Fragment</code>ä¸Šã€‚</p>
<p>Tab 1  â€”-&gt; TabFragment1<br>Tab 2  â€”-&gt; TabFragment2</p>
<h1 id="æ–¹æ¡ˆä¸€-FragmentTabHost"><a href="#æ–¹æ¡ˆä¸€-FragmentTabHost" class="headerlink" title="æ–¹æ¡ˆä¸€  FragmentTabHost"></a>æ–¹æ¡ˆä¸€  FragmentTabHost</h1><p>  åœ¨æ–°çš„v4 supportä¸‹æœ‰ä¸ªç±»å«<code>FragemntTabHost</code>ï¼Œæ˜¯æ›¿ä»£ä»¥å‰é‚£ç§<code>TabHost</code>çš„æ–¹æ¡ˆï¼Œæ¯ä¸ªTabå°±æ˜¯<code>Fragment</code>ã€‚</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line"></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">".SendActivity"</span></div><div class="line">    &gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">      <span class="attr">android:id</span>=<span class="string">"@+id/toolbar"</span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimary"</span></div><div class="line">      <span class="attr">app:popupTheme</span>=<span class="string">"@style/AppTheme.PopupOverlay"</span></div><div class="line">      &gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_below</span>=<span class="string">"@+id/toolbar"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span> &gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- æŠŠFragmentLayoutæ”¾åœ¨FragmentTabHostä¸Šé¢ï¼Œè¿™æ ·tabså°±åœ¨åº•éƒ¨äº†ï¼Œæ³¨æ„ï¼Œidè¦è‡ªå·±æ·»åŠ äº†</span></div><div class="line">     android:id="@+id/realtabcontent"</div><div class="line">    --&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/realtabcontent"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"0dip"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span> /&gt;</div><div class="line">    <span class="comment">&lt;!--&lt;View--&gt;</span></div><div class="line">        <span class="comment">&lt;!--android:id="@android:id/tabhost"--&gt;</span></div><div class="line">        <span class="comment">&lt;!--android:layout_width="match_parent"--&gt;</span></div><div class="line">        <span class="comment">&lt;!--android:layout_height="48dp"--&gt;</span></div><div class="line">        <span class="comment">&lt;!--&amp;gt;--&gt;</span></div><div class="line">    <span class="comment">&lt;!--&lt;/&gt;--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v4.app.FragmentTabHost</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@android:id/tabhost"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"48dp"</span></div><div class="line">        &gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.app.FragmentTabHost</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>å¯èƒ½ä¼šè¿™ä¹ˆè®¾ç½®å¸ƒå±€ï¼Œä¸ºæ¯ä¸ªtabè®¾ç½®ä¸€ä¸ªTabViewã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">View tab_msg1 = initTabItem(<span class="number">1</span>);</div><div class="line">View tab_msg2 = initTabItem(<span class="number">2</span>);</div><div class="line">View tab_msg3 = initTabItem(<span class="number">3</span>);</div><div class="line">View tab_msg4 = initTabItem(<span class="number">4</span>);</div><div class="line"></div><div class="line"><span class="comment">//addTab(æ ‡é¢˜ï¼Œè·³è½¬çš„Fragmentï¼Œä¼ é€’å‚æ•°çš„Bundle)</span></div><div class="line"><span class="comment">//ContactFragmentè‡ªå·±å®šä¹‰ä¸€ä¸ªextends Fragmentçš„ç±»å°±è¡Œäº†</span></div><div class="line"></div><div class="line">mTabHost.addTab(mTabHost.newTabSpec(<span class="string">"Tag1"</span>).setIndicator(tab_msg1), ContactFragment.class, <span class="keyword">null</span>);</div><div class="line">mTabHost.addTab(mTabHost.newTabSpec(<span class="string">"Tag2"</span>).setIndicator(tab_msg2), ContactFragment.class, <span class="keyword">null</span>);</div><div class="line">mTabHost.addTab(mTabHost.newTabSpec(<span class="string">"Tag3"</span>).setIndicator(tab_msg3), ContactFragment.class, <span class="keyword">null</span>);</div><div class="line">mTabHost.addTab(mTabHost.newTabSpec(<span class="string">"Tag4"</span>).setIndicator(tab_msg4), ContactFragment.class, <span class="keyword">null</span>);</div><div class="line"><span class="comment">//è®¾ç½®tabsä¹‹é—´çš„åˆ†éš”çº¿ä¸æ˜¾ç¤º</span></div><div class="line">mTabHost.getTabWidget().setShowDividers(LinearLayout.SHOW_DIVIDER_NONE);</div><div class="line"></div><div class="line"></div><div class="line">mTabHost.setOnTabChangedListener(<span class="keyword">this</span>);</div></pre></td></tr></table></figure></p>
<p>åªè¦ç›‘å¬æ¯æ¬¡Tabçš„åˆ‡æ¢äº‹ä»¶<code>OnTabChangeListener</code>å°±å¯ä»¥äº†ï¼Œè‡³äºæ¯ä¸ª<code>Fragment</code>æ€ä¹ˆåˆ‡æ¢äº¤ç»™äº†<code>FragmentTabHost</code>æ¥å¤„ç†ã€‚</p>
<p>ç­‰ç­‰è®©æˆ‘å®éªŒä¸‹ã€‚</p>
<hr>
<p>coding 20åˆ†é’Ÿç­‰å¾…ä¸­ã€‚</p>
<hr>
<p>ä½†(æ)æ˜¯(ç¤º)å¤§å®¶Tabæœ‰æ²¡æœ‰çœŸæ­£åº”ç”¨åˆ°é¡¹ç›®ä¸­ï¼Œæˆ‘èƒ½è¯´æˆ‘ç”¨äº†ä¹ˆï¼Œä¸ºäº†<code>Fragemnt</code>æˆ‘æ˜¯æ“ç¢äº†å¿ƒäº†å•Šï¼Œæ¯æ¬¡åˆ‡æ¢Tabï¼Œå¯¹åº”çš„<code>Fragment</code>éƒ½ä¼šå›è°ƒ<code>onCreateView</code>,<code>OnResume</code>ç­‰<code>Fragment</code>çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ¯æ¬¡éƒ½ä¼šåˆ›å»ºçš„<code>Fragment</code>çš„ï¼Œå¾ˆå¤šåˆå§‹åŒ–å·¥ä½œä¹Ÿä¼šé‡æ–°èµ°ä¸€éã€‚å¥½äº†ï¼Œè¿˜æ˜¯çœ‹çœ‹<code>FragmentTabHost</code>çš„source codeå§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">private FragmentTransaction doTabChanged(String tabId, FragmentTransaction ft) &#123;</div><div class="line">       TabInfo newTab = null;</div><div class="line">       for (int i=0; i&lt;mTabs.size(); i++) &#123;</div><div class="line">           TabInfo tab = mTabs.get(i);</div><div class="line">           if (tab.tag.equals(tabId)) &#123;</div><div class="line">               newTab = tab;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       if (newTab == null) &#123;</div><div class="line">           throw new IllegalStateException(&quot;No tab known for tag &quot; + tabId);</div><div class="line">       &#125;</div><div class="line">       if (mLastTab != newTab) &#123;</div><div class="line">           if (ft == null) &#123;</div><div class="line">               ft = mFragmentManager.beginTransaction();</div><div class="line">           &#125;</div><div class="line">           if (mLastTab != null) &#123;</div><div class="line">               if (mLastTab.fragment != null) &#123;</div><div class="line">                   ft.detach(mLastTab.fragment);</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">           if (newTab != null) &#123;</div><div class="line">               if (newTab.fragment == null) &#123;</div><div class="line">                   newTab.fragment = Fragment.instantiate(mContext,</div><div class="line">                           newTab.clss.getName(), newTab.args);</div><div class="line">                   ft.add(mContainerId, newTab.fragment, newTab.tag);</div><div class="line">               &#125; else &#123;</div><div class="line">                   ft.attach(newTab.fragment);</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           mLastTab = newTab;</div><div class="line">       &#125;</div><div class="line">       return ft;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>æºç å¾ˆæ¸…æ™°è§£é‡Šäº†ä¸ºä»€ä¹ˆï¼Œå½“åˆ‡æ¢Tabæ—¶ï¼Œæœ‰ä¸¤ä¸ªFragemntï¼Œä¸€ä¸ªæ˜¯<br>newTabï¼Œå¦ä¸€æ˜¯mLastTabï¼ŒmLastTabæ˜¯è¢«detachï¼ŒnewTabæ˜¯addæˆ–è€…è¢«attachï¼Œä¼¼ä¹è¿™äº›æœ‰ç‚¹è’™ã€‚</p>
<blockquote>
<p>detach()<br>ä¼šå°†viewä»UIä¸­ç§»é™¤,å’Œremove()ä¸åŒ,æ­¤æ—¶fragmentçš„çŠ¶æ€ä¾ç„¶ç”±FragmentManagerç»´æŠ¤ã€‚<br>attach()<br>é‡å»ºviewè§†å›¾ï¼Œé™„åŠ åˆ°UIä¸Šå¹¶æ˜¾ç¤ºã€‚<br>ä¸€ä¸ªFragmentçš„ç”Ÿå‘½å‘¨æœŸéš¾é“ä½ å¿˜äº†ä¹ˆï¼Œç¿ èŠ±ä¸Šå›¾ï¼š</p>
</blockquote>
<p><img src="http://img.my.csdn.net/uploads/201211/29/1354170699_6619.png" alt="Fragmentçš„ç”Ÿå‘½å‘¨æœŸ">ã€‚<br>è¢«attachå°±ä¼šèµ°<code>onAttach</code>åé¢çš„<code>onCreateView</code>ç­‰æ–¹æ³•ï¼Œè¢«detachå°±ä¼šèµ°<code>onDestoryView</code>ç­‰æ–¹æ³•ï¼Œå¥½äº†çŸ¥é“ä¸ºä»€ä¹ˆä¼šå‡ºç°Tabåˆ‡æ¢ï¼Œåˆ‡åˆ°ç›®æ ‡<code>Fragemnt</code>ä¸Šæ—¶<code>Fragemnt</code>ä¼šä¸æ–­è°ƒç”¨<code>onCreateView</code>ã€<code>onResume</code>ç­‰æ–¹æ³•äº†ã€‚</p>
<p>è¿™ä¹ˆæ§åˆ¶æ¯ä¸ª<code>Fragemnt</code>çœŸçš„å¥½ç´¯ï¼Œä¸ºäº†èƒ½æ›´å¥½æ§åˆ¶<code>Fragment</code>æˆ‘ä»¬æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰ç±»ä¼¼<code>FragemntTabHost</code>çš„ä¸œè¥¿ï¼Œä½¿å¾—æ¯æ¬¡åŠ è½½å·²ç»åŠ è½½è¿‡çš„<code>Fragemnt</code>èƒ½åªæ˜¯æ˜¾ç¤ºä¸ªViewï¼Œä¸è¦ä¸€æ¬¡æ¬¡è°ƒç”¨<code>onCreateView</code>ã€<code>onResume</code>ç­‰æ–¹æ³•ã€‚</p>
<h1 id="Hide-Or-Showï¼ˆï¼‰çš„æ–¹å¼"><a href="#Hide-Or-Showï¼ˆï¼‰çš„æ–¹å¼" class="headerlink" title="Hide() Or Showï¼ˆï¼‰çš„æ–¹å¼"></a>Hide() Or Showï¼ˆï¼‰çš„æ–¹å¼</h1><p>åœ¨ä½¿ç”¨Tabåˆ‡æ¢æ—¶ï¼Œå¾ˆå¤šäººåœ¨æå€¡<code>ç”¨FragmentManager</code>çš„hide()å’Œshow()çš„æ–¹æ³•ã€‚</p>
<blockquote>
<p>transaction.hide()<br>éšè—å½“å‰çš„Fragmentï¼Œä»…ä»…æ˜¯è®¾ä¸ºä¸å¯è§ï¼Œå¹¶ä¸ä¼šé”€æ¯<br>transaction.show()<br>æ˜¾ç¤ºä¹‹å‰éšè—çš„Fragment   </p>
</blockquote>
<p>è¿™ä¸ªå°±ç¨å¾®ç®€å•äº†ç‚¹ï¼Œå¯¹äºä¸€ä¸ª<code>Fragment</code>ï¼Œæ²¡addåˆ°transactionæ˜¯å°±addï¼Œå·²ç»addäº†å°±showï¼Œå…¶ä»–ä¸è¯¥æ˜¾ç¤ºçš„<code>Fragemnt</code>å…¨éƒ¨hideã€‚å°±æ˜¯è¿™ä¸ªç®€å•æ®‹æš´ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">switchFragemnt</span><span class="params">(String tag)</span> </span>&#123;</div><div class="line">    FragmentTransaction ft = getSupportFragmentManager().beginTransaction();</div><div class="line">    <span class="keyword">if</span> (Tag1.equals(tag))&#123;</div><div class="line">      <span class="keyword">if</span> (fragment2 != <span class="keyword">null</span> &amp;&amp; fragment2.isAdded())&#123;</div><div class="line">        ft.hide(fragment2);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span> (fragment1 == <span class="keyword">null</span>)&#123;</div><div class="line">        fragment1 = ContactFragment.newInstance(<span class="number">1</span>);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span> (!fragment1.isAdded())&#123;</div><div class="line">        ft.add(R.id.contenter,fragment1,Tag1);</div><div class="line">      &#125;<span class="keyword">else</span> &#123;</div><div class="line">        ft.show(fragment1);</div><div class="line">      &#125;</div><div class="line"></div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (Tag2.equals(tag))&#123;</div><div class="line">      <span class="keyword">if</span> (fragment1 != <span class="keyword">null</span> &amp;&amp; fragment1.isAdded())&#123;</div><div class="line">        ft.hide(fragment1);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span> (fragment2 == <span class="keyword">null</span>)&#123;</div><div class="line">        fragment2 = ContactFragment.newInstance(<span class="number">2</span>);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span> (!fragment2.isAdded())&#123;</div><div class="line">        ft.add(R.id.contenter,fragment2,Tag2);</div><div class="line">      &#125;<span class="keyword">else</span> &#123;</div><div class="line">        ft.show(fragment2);</div><div class="line">      &#125;</div><div class="line"></div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ft.commitAllowingStateLoss();</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>  è¿™ä¸ªåªæ˜¯ç®€å•çš„é€»è¾‘ä»£ç ï¼Œå‚»äº†ç‚¹ä¸è¿‡è‚¯å®šä½ èƒ½çœ‹æ‡‚ï¼Œè¿™ä¸ªå†åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œåªæ˜¯éšè—ä½†æ˜¯ä¾ç„¶å¯ä»¥æµç•…åˆ‡ã€‚<br>  åæ¥æ€»ç»“è¿™äº›è‡ªå·±ä¹ŸæŠ½è±¡äº†ä¸€ä¸ªç®€å•çš„ç±»ï¼š</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.Fragment;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.FragmentActivity;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.FragmentTransaction;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.TabHost;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TabManager</span> <span class="keyword">implements</span> <span class="title">TabHost</span>.<span class="title">OnTabChangeListener</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> FragmentActivity mActivity;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> TabHost          mTabHost;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>              mContainerId;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;String, TabInfo&gt; mTabs = <span class="keyword">new</span> HashMap&lt;String, TabInfo&gt;();</div><div class="line"></div><div class="line">	TabHost.OnTabChangeListener tabChangeListener;</div><div class="line">	TabInfo mLastTab;</div><div class="line"></div><div class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TabInfo</span> </span>&#123;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">final</span> String   tag;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; clss;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">final</span> Bundle   args;</div><div class="line">		<span class="keyword">private</span>       Fragment fragment;</div><div class="line"></div><div class="line">		TabInfo(String _tag, Class&lt;?&gt; _class, Bundle _args) &#123;</div><div class="line">			tag = _tag;</div><div class="line">			clss = _class;</div><div class="line">			args = _args;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DummyTabFactory</span> <span class="keyword">implements</span> <span class="title">TabHost</span>.<span class="title">TabContentFactory</span> </span>&#123;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">final</span> Context mContext;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">DummyTabFactory</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">			mContext = context;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> View <span class="title">createTabContent</span><span class="params">(String tag)</span> </span>&#123;</div><div class="line">			View v = <span class="keyword">new</span> View(mContext);</div><div class="line">			v.setMinimumWidth(<span class="number">0</span>);</div><div class="line">			v.setMinimumHeight(<span class="number">0</span>);</div><div class="line">			<span class="keyword">return</span> v;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> TabManager <span class="title">setTabChangeListener</span><span class="params">(TabHost.OnTabChangeListener tabChangeListener)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.tabChangeListener = tabChangeListener;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">TabManager</span><span class="params">(FragmentActivity activity, TabHost tabHost,</span></span></div><div class="line">			<span class="keyword">int</span> containerId) &#123;</div><div class="line">		mActivity = activity;</div><div class="line">		mTabHost = tabHost;</div><div class="line">		mContainerId = containerId;</div><div class="line">		mTabHost.setOnTabChangedListener(<span class="keyword">this</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> TabManager <span class="title">addTab</span><span class="params">(TabHost.TabSpec tabSpec, Class&lt;?&gt; clss, Bundle args)</span> </span>&#123;</div><div class="line">		tabSpec.setContent(<span class="keyword">new</span> DummyTabFactory(mActivity));</div><div class="line">		String tag = tabSpec.getTag();</div><div class="line"></div><div class="line">		TabInfo info = <span class="keyword">new</span> TabInfo(tag, clss, args);</div><div class="line"></div><div class="line">		<span class="comment">// Check to see if we already have a fragment for this tab, probably</span></div><div class="line">		<span class="comment">// from a previously saved state. If so, deactivate it, because our</span></div><div class="line">		<span class="comment">// initial state is that a tab isn't shown.</span></div><div class="line">		info.fragment = mActivity.getSupportFragmentManager().findFragmentByTag(tag);</div><div class="line">		<span class="keyword">if</span> (info.fragment != <span class="keyword">null</span> &amp;&amp; !info.fragment.isDetached()) &#123;</div><div class="line">			FragmentTransaction ft = mActivity.getSupportFragmentManager().beginTransaction();</div><div class="line">			ft.hide(info.fragment);</div><div class="line">			ft.commit();</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		mTabs.put(tag, info);</div><div class="line">		mTabHost.addTab(tabSpec);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabChanged</span><span class="params">(String tabId)</span> </span>&#123;</div><div class="line"></div><div class="line">		TabInfo newTab = mTabs.get(tabId);</div><div class="line">		<span class="keyword">if</span> (mLastTab != newTab) &#123;</div><div class="line">			FragmentTransaction ft = mActivity.getSupportFragmentManager().beginTransaction();</div><div class="line">			<span class="keyword">if</span> (mLastTab != <span class="keyword">null</span>) &#123;</div><div class="line">				<span class="keyword">if</span> (mLastTab.fragment != <span class="keyword">null</span>) &#123;</div><div class="line">					ft.hide(mLastTab.fragment);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span> (newTab != <span class="keyword">null</span>) &#123;</div><div class="line">				<span class="keyword">if</span> (newTab.fragment == <span class="keyword">null</span>) &#123;</div><div class="line">					newTab.fragment = Fragment.instantiate(mActivity, newTab.clss.getName(), newTab.args);</div><div class="line">					ft.add(mContainerId, newTab.fragment, newTab.tag);</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					ft.show(newTab.fragment);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			mLastTab = newTab;</div><div class="line">			ft.commitAllowingStateLoss(); <span class="comment">// å¦‚æœä½¿ç”¨commit()ï¼Œåˆ™ä»ç‰›äººåè®®é¡µç‚¹åŒæ„åç¨‹åºå´©æºƒ; java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState</span></div><div class="line">			mActivity.getSupportFragmentManager().executePendingTransactions();</div><div class="line">			<span class="keyword">if</span> (tabChangeListener != <span class="keyword">null</span>)&#123;</div><div class="line">				tabChangeListener.onTabChanged(tabId);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  ä½¿ç”¨ï¼š<br>  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mTabManager = <span class="keyword">new</span> TabManager(<span class="keyword">this</span>, mTabHost, R.id.realtabcontent);</div><div class="line">View tab1 = addTab(mInflater, Constants.INDEX_1, R.drawable.ic_tab_1, R.string.1);</div><div class="line">      mTabManager.addTab(mTabHost.newTabSpec(Constants.TAB_1).setIndicator(tabMarket), MainFragment.class, <span class="keyword">null</span>);</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç°åœ¨Googleå·²ç»åœ¨æ–°çš„APP UIè§„èŒƒä¸­å¼€å§‹æå€¡ä½¿ç”¨åº•éƒ¨å¯¼èˆªæ ï¼ˆ&lt;code&gt;BottomNavigation&lt;/code&gt;ï¼‰ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„ä¾§æ‹‰å¯¼èˆªæ ï¼ˆ&lt;code&gt;NavigationView&lt;/code&gt;,å¯¹äºå¤§å±æ‰‹æœºï¼Œè¿™ä¸ªè§„èŒƒæ˜¯å¾ˆäººæ€§çš„ã€‚&lt;code&gt;BottomNavigation&lt;/code&gt;åˆ†ä¸ºåº•éƒ¨çš„Tabå¯¼èˆªæ å’Œä¸Šé¢çš„å†…å®¹å±•ç¤ºéƒ¨åˆ†ï¼Œå®ç°ä¸Šï¼Œæ¯ä¸ªTabå¯¹åº”ä¸€ä¸ª&lt;code&gt;Fragment&lt;/code&gt;ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æˆ‘ä»¬æ­£ç¡®å¤„ç†æ¯ä¸ª&lt;code&gt;Fragment&lt;/code&gt;åœ¨Tabé—´è¿›è¡Œåˆ‡æ¢ï¼ŒåŒæ—¶æ¯æ¬¡æ‰“å¼€é‚£ä¸ªTabæ—¶ï¼Œé‚£ä¸ªTabå¯¹åº”çš„&lt;code&gt;Fragment&lt;/code&gt;æ‰åŠ è½½ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://ownwell.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="http://ownwell.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Pythonå­¦ä¹ -pipå’Œvirtualenv</title>
    <link href="http://ownwell.github.io/2016/04/16/Android-developer-to-learn-to-python-01/"/>
    <id>http://ownwell.github.io/2016/04/16/Android-developer-to-learn-to-python-01/</id>
    <published>2016-04-16T13:57:04.000Z</published>
    <updated>2017-05-24T07:19:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pythonå¯ä»¥ä½œä¸ºè¿ç»´äººå‘˜çš„å·¥å…·ï¼Œæ— è®ºæ˜¯windowsã€macå’Œlinuxï¼Œéƒ½å¯ä»¥è·‘èµ·æ¥ï¼Œæ¯”shellè„šæœ¬æ–¹ä¾¿ï¼Œå¯ä»¥ä½œä¸ºwebçš„å¼€å‘å·¥å…·ï¼Œæ­å»ºç½‘ç«™ï¼Œåœ¨å¤§æ•°æ®æ–¹é¢Pythonä¹Ÿä¸å¼±ï¼Œæ‰€ä»¥é€‰æ‹©Pythonä½œä¸ºå¼€å‘è¯­è¨€çš„å·¥ç¨‹å¸ˆå¯èƒ½æ˜¯ä¸€ä¸ªå…¨æ ˆå·¥ç¨‹å¸ˆã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/308085d7cbf0dfed3d87bd686d564143_r.jpg" alt=""></p>
<a id="more"></a>
<p>é‚£ä¹ˆ<code>Python</code>ä½œä¸ºä¸€ä¸ªçƒ­é—¨è¯­è¨€ï¼Œè‚¯å®šæœ‰å¾ˆå¤šå¼€å‘è€…ï¼Œä¹Ÿæœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹åº“ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå¯¼å…¥è¿™äº›å‘¢ï¼Œå°±åƒæˆ‘ä»¬é€šè¿‡<code>maven center</code>æ¥è·å–ç¬¬ä¸‰æ–¹çš„åº“å‘¢ï¼Œä¸è¦æ‹…å¿ƒ<code>Python</code>ä¹Ÿæœ‰ã€‚<br>å°±è¯·å‡ºæˆ‘ä»¬çš„ç”·çŒªè„šå§ â€”-<code>pip</code>ã€‚<br>å¯¹äº†æˆ‘çš„ç”µè„‘ä¸Šæœ‰å¥½å‡ ä¸ªç‰ˆæœ¬çš„<code>Python</code>ï¼Œ<code>Python2.7</code>å’Œ<code>Python3</code>éƒ½æœ‰ï¼Œæå¾—çœ¼èŠ±ç¼­ä¹±ï¼Œæ€ä¹ˆåŠï¼Œä¸è¦æ‹…å¿ƒä»Šå¤©çš„å¥³çŒªè„šä¹Ÿæ¥äº† â€”<code>virtualenv</code>ã€‚</p>
<p>åŒå‰‘åœ¨æ‰‹ï¼Œ<code>Python</code>æ— æ„ã€‚</p>
<h1 id="Pip"><a href="#Pip" class="headerlink" title="Pip"></a><code>Pip</code></h1><h2 id="å®‰è£…pip"><a href="#å®‰è£…pip" class="headerlink" title="å®‰è£…pip"></a>å®‰è£…<code>pip</code></h2><p><code>mac</code>ç³»ç»Ÿä¸ºä¾‹ï¼Œ<code>brew</code>å®‰è£…<code>wget</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget https://raw.github.com/pypa/pip/master/contrib/get-pip.py</div><div class="line"></div><div class="line">python get-pip.py</div></pre></td></tr></table></figure>
<h2 id="pip-å¸¸ç”¨å‘½ä»¤"><a href="#pip-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="pip å¸¸ç”¨å‘½ä»¤"></a>pip å¸¸ç”¨å‘½ä»¤</h2><h3 id="pipå‡çº§è‡ªå·±"><a href="#pipå‡çº§è‡ªå·±" class="headerlink" title="pipå‡çº§è‡ªå·±"></a>pipå‡çº§è‡ªå·±</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install --upgrade pip</div></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨searchã€installè¿™ä¸¤ä¸ªå‚æ•°"><a href="#ä½¿ç”¨searchã€installè¿™ä¸¤ä¸ªå‚æ•°" class="headerlink" title="ä½¿ç”¨searchã€installè¿™ä¸¤ä¸ªå‚æ•°"></a>ä½¿ç”¨searchã€installè¿™ä¸¤ä¸ªå‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pip install pack  </div><div class="line"></div><div class="line">pip install package</div></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„åº“"><a href="#æŸ¥çœ‹å·²ç»å®‰è£…çš„åº“" class="headerlink" title="æŸ¥çœ‹å·²ç»å®‰è£…çš„åº“"></a>æŸ¥çœ‹å·²ç»å®‰è£…çš„åº“</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip list</div></pre></td></tr></table></figure>
<h3 id="è·å–è¿‡æœŸçš„åº“ï¼š"><a href="#è·å–è¿‡æœŸçš„åº“ï¼š" class="headerlink" title="è·å–è¿‡æœŸçš„åº“ï¼š"></a>è·å–è¿‡æœŸçš„åº“ï¼š</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pip list --outdated</div><div class="line"></div><div class="line">ä¾‹å¦‚ï¼š</div><div class="line">pip list --outdated | grep Jinja2</div></pre></td></tr></table></figure>
<h1 id="virtualenv"><a href="#virtualenv" class="headerlink" title="virtualenv"></a>virtualenv</h1><h2 id="virtualenvå®‰è£…"><a href="#virtualenvå®‰è£…" class="headerlink" title="virtualenvå®‰è£…"></a><code>virtualenv</code>å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pip install virtualenv</div><div class="line"></div><div class="line">python3ä¸‹</div><div class="line">pip install virtualenv</div></pre></td></tr></table></figure>
<h2 id="virtualenvä½¿ç”¨"><a href="#virtualenvä½¿ç”¨" class="headerlink" title="virtualenvä½¿ç”¨"></a><code>virtualenv</code>ä½¿ç”¨</h2><h3 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Mac:~ cyning$ mkdir myproject</div><div class="line">Mac:~ cyning$ cd myproject/</div><div class="line">Mac:myproject cyning$</div></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„Pythonè¿è¡Œç¯å¢ƒï¼Œå‘½åä¸ºvenv"><a href="#åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„Pythonè¿è¡Œç¯å¢ƒï¼Œå‘½åä¸ºvenv" class="headerlink" title="åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„Pythonè¿è¡Œç¯å¢ƒï¼Œå‘½åä¸ºvenv"></a>åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„<code>Python</code>è¿è¡Œç¯å¢ƒï¼Œå‘½åä¸º<code>venv</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Mac:myproject cyning$ virtualenv --no-site-packages venv</div><div class="line">Using base prefix '/usr/local/.../Python.framework/Versions/3.4'</div><div class="line">New python executable in venv/bin/python3.4</div><div class="line">Also creating executable in venv/bin/python</div><div class="line">Installing setuptools, pip, wheel...done.</div></pre></td></tr></table></figure>
<p>å‚æ•°<code>--no-site-packages</code>ï¼Œè¿™æ ·ï¼Œå·²ç»å®‰è£…åˆ°ç³»ç»Ÿ<code>Python</code>ç¯å¢ƒä¸­çš„æ‰€æœ‰ç¬¬ä¸‰æ–¹åŒ…éƒ½ä¸ä¼šå¤åˆ¶è¿‡æ¥ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªä¸å¸¦ä»»ä½•ç¬¬ä¸‰æ–¹åŒ…çš„â€œå¹²å‡€â€çš„<code>Python</code>è¿è¡Œç¯å¢ƒã€‚</p>
<p>æœ‰äº†<code>venv</code>è¿™ä¸ªPythonç¯å¢ƒï¼Œå¯ä»¥ç”¨sourceè¿›å…¥è¯¥ç¯å¢ƒï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Mac:myproject cyning$ source venv/bin/activate</div><div class="line">(venv)Mac:myproject cyning$</div></pre></td></tr></table></figure>
<p>æœ‰ä¸ª(venv)å‰ç¼€ï¼Œè¡¨ç¤ºå½“å‰ç¯å¢ƒæ˜¯ä¸€ä¸ªåä¸º<code>venv</code>çš„<code>Python</code>ç¯å¢ƒã€‚</p>
<h3 id="åœ¨è‡ªå·±çš„Pythonç¯å¢ƒä¸‹ç®¡ç†è‡ªå·±çš„Pythonçš„ç¯å¢ƒ"><a href="#åœ¨è‡ªå·±çš„Pythonç¯å¢ƒä¸‹ç®¡ç†è‡ªå·±çš„Pythonçš„ç¯å¢ƒ" class="headerlink" title="åœ¨è‡ªå·±çš„Pythonç¯å¢ƒä¸‹ç®¡ç†è‡ªå·±çš„Pythonçš„ç¯å¢ƒ"></a>åœ¨è‡ªå·±çš„<code>Python</code>ç¯å¢ƒä¸‹ç®¡ç†è‡ªå·±çš„<code>Python</code>çš„ç¯å¢ƒ</h3><p>ä¸‹é¢æ­£å¸¸å®‰è£…å„ç§ç¬¬ä¸‰æ–¹åŒ…ï¼Œå¹¶è¿è¡Œ<code>Python</code>å‘½ä»¤:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(venv)Mac:myproject cyning$ pip install jinja2</div><div class="line">...</div><div class="line">Successfully installed jinja2<span class="number">-2.7</span><span class="number">.3</span> markupsafe<span class="number">-0.23</span></div><div class="line">(venv)Mac:myproject cyning$ python myapp.py</div></pre></td></tr></table></figure></p>
<p>åœ¨<code>venv</code>ç¯å¢ƒä¸‹ï¼Œç”¨<code>pip</code>å®‰è£…çš„åŒ…éƒ½è¢«å®‰è£…åˆ°<code>venv</code>è¿™ä¸ªç¯å¢ƒä¸‹ï¼Œç³»ç»Ÿ<code>Python</code>ç¯å¢ƒä¸å—ä»»ä½•å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>venv</code>ç¯å¢ƒæ˜¯ä¸“é—¨é’ˆå¯¹myprojectè¿™ä¸ªåº”ç”¨åˆ›å»ºçš„ã€‚</p>
<p>é€€å‡ºå½“å‰çš„<code>venv</code>ç¯å¢ƒï¼Œä½¿ç”¨<code>deactivate</code>å‘½ä»¤:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(venv)Mac:myproject cyning$ deactivate</div><div class="line">Mac:myproject cyning$</div></pre></td></tr></table></figure>
<p>åœ¨<code>venv</code>å’Œç³»ç»Ÿçš„<code>python</code>é—´è‡ªç”±çš„é£ç¿”å§ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Pythonå¯ä»¥ä½œä¸ºè¿ç»´äººå‘˜çš„å·¥å…·ï¼Œæ— è®ºæ˜¯windowsã€macå’Œlinuxï¼Œéƒ½å¯ä»¥è·‘èµ·æ¥ï¼Œæ¯”shellè„šæœ¬æ–¹ä¾¿ï¼Œå¯ä»¥ä½œä¸ºwebçš„å¼€å‘å·¥å…·ï¼Œæ­å»ºç½‘ç«™ï¼Œåœ¨å¤§æ•°æ®æ–¹é¢Pythonä¹Ÿä¸å¼±ï¼Œæ‰€ä»¥é€‰æ‹©Pythonä½œä¸ºå¼€å‘è¯­è¨€çš„å·¥ç¨‹å¸ˆå¯èƒ½æ˜¯ä¸€ä¸ªå…¨æ ˆå·¥ç¨‹å¸ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xj9f0.com1.z0.glb.clouddn.com/308085d7cbf0dfed3d87bd686d564143_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Python" scheme="http://ownwell.github.io/categories/Python/"/>
    
    
      <category term="Python" scheme="http://ownwell.github.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ç«™åœ¨å¤§ç¥è‚©è†€ä¸Šçœ‹RxJava</title>
    <link href="http://ownwell.github.io/2016/04/13/RxJava-introduce/"/>
    <id>http://ownwell.github.io/2016/04/13/RxJava-introduce/</id>
    <published>2016-04-13T13:44:49.000Z</published>
    <updated>2017-05-24T07:19:27.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/md/1470727585294.png"></p>
<p>RxJavaæ˜¯ä½œä¸ºAndroidå¼€å‘ä¸­çš„æ–°è´µï¼Œ è¶Šæ¥è¶Šå¤šçš„äººå‚ä¸åˆ°RxJavaçš„æ‹“å±•å’Œä½¿ç”¨ä¸Šï¼Œå¦‚JakeWhartonå‚ä¸äº†å¤šä¸ªRxJavaé¡¹ç›®ã€‚å›½å†…å‘¢ï¼Œä¸€å¤§æ‰¹ï¼ˆå¦‚æ‰”ç‰©çº¿ã€å°é‚“å­ã€ä»£ç å®¶ç­‰ï¼‰å¯¹RxJavaæ¨å¹¿ï¼Œä½ è¦ä¸æ²¡å¬è¿‡å®ƒï¼Œä½ éƒ½è§‰å¾—ä¸å¥½æ„æ€ï¼Œå› ä¸ºå®ƒå¤ªç«äº†ã€‚<br><a id="more"></a></p>
<p>ä»Šå¤©æˆ‘ä»¬å°±æ˜¯è¦è¸©åœ¨è¿™äº›è¿‡æ¥äººçš„è‚©è†€ä¸Šï¼Œæ¥å­¦ä¹ RxJavaï¼Œè¿™ä¸ªä¸»è¦æ˜¯é’ˆå¯¹ä¸ç†Ÿæ‚‰RxJavaçš„ï¼Œè‹¥æ˜¯å·²ç»å¾ˆç†Ÿç»ƒä½¿ç”¨äº†ï¼Œè¿™ç¯‡å¯èƒ½å°±ä¸å¤ªé€‚åˆä½ ã€‚</p>
<p>å¤§æ¦‚æ˜¯åœ¨14å¹´åº•ï¼Œæˆ‘åœ¨ä¸€ä¸ªåˆ›ä¸šå…¬å¸ï¼Œä»yahooæ¥çš„æ›¾Sirå°±ç»™æˆ‘ä»¬åˆ†äº«RxJavaä½†æ˜¯å½“æ—¶èµ„æ–™ç”šå°‘ï¼ŒåŠ ä¸Šé¡¹ç›®èµ¶ç´§ï¼Œå°±å¤§æ¦‚çŸ¥é“äº†RxJavaè¿™ç§å“åº”å¼å¤„ç†æ•°æ®å¤ªå¥½äº†ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥éœ€è¦è‡ªå·±å†™ä¸€å †é…å¥—çš„åº“ï¼Œæ‰€ä»¥å°±æç½®äº†ã€‚ä½†æ˜¯éšç€Retrofit 2.0ã€RxVolleyç­‰è¿™äº›å¥½ç”¨çš„ç¬¬ä¸‰æ–¹RxJavaæ‹“å±•åº“ â€”-ç”¨ä¸€æ¬¡å°±è§‰å¾—çˆ½åˆ°çˆ†â€”æˆ‘å†³å®šåœ¨å…¬å¸çš„é¡¹ç›®ä¸­ä½¿ç”¨RxJavaäº†ã€‚</p>
<p>RxJavaæ˜¯ä¸€ä¸ªé’ˆå¯¹JVMé€šç”¨çš„å·¥å…·åº“ï¼Œåœ¨Githubä¸Šä½ ä¼šå‘ç°ä¸€å †çš„æ‰©å±•åº“ï¼Œåœ¨ç®€ä¹¦ã€CSDNç­‰æŠ€æœ¯è®ºå›ä¸Šï¼Œä½ ä¼šå‘ç°æœ‰Nå¤šç¯‡RxJavaçš„æ–‡ç« ï¼Œå¯¹äºä¸€ä¸ªæ–°æ‰‹æˆ–è€…è¿›é˜¶çš„å¼€å‘è€…ï¼Œæˆ‘å°±ä»¥è¿‡æ¥äººçš„èº«ä»½ä¸ºå¤§å®¶åˆ—å‡ºä¸€äº›å…¥é—¨çš„æ–‡ç« å’Œé¡¹ç›®ï¼Œæœ¬äººä¸ä¼šæœ‰ä»€ä¹ˆå®è´¨æ€§çš„ä»‹ç»æˆ–è€…è§£é‡Šï¼Œä¼šç»™å¤§å®¶åˆ—å‡ºä¸€ç³»åˆ—çš„æ–‡ç« å’Œä¹¦ï¼Œä¸€æ­¥æ­¥ç»™å¤§å®¶çŸ¥é“ã€‚</p>
<h1 id="ä»€ä¹ˆæ˜¯RxJavaä»¥åŠRxJavaèƒ½å¹²ä»€ä¹ˆ"><a href="#ä»€ä¹ˆæ˜¯RxJavaä»¥åŠRxJavaèƒ½å¹²ä»€ä¹ˆ" class="headerlink" title="ä»€ä¹ˆæ˜¯RxJavaä»¥åŠRxJavaèƒ½å¹²ä»€ä¹ˆ"></a>ä»€ä¹ˆæ˜¯RxJavaä»¥åŠRxJavaèƒ½å¹²ä»€ä¹ˆ</h1><p>åœ¨Flipboardå·¥ä½œçš„æ‰”ç‰©çº¿åŒå­¦ç”¨é€šä¿—çš„æè¿°ä¸ºæˆ‘ä»¬è®²è¿°ä»€ä¹ˆæ˜¯Rxjavaï¼Œä¸ºä»€ä¹ˆè¦ç”¨RxJava â€” <a href="http://gank.io/post/560e15be2dca930e00da1083" target="_blank" rel="external">ç»™ Android å¼€å‘è€…çš„ RxJava </a>è¯¦è§£ã€‚å¾ˆå–œæ¬¢ä»–çš„æ–‡ç« é£æ ¼ï¼Œå›¾æ–‡éƒ½æ˜¯è®©ä½ è¿‡ç›®ä¸å¿˜ã€‚è¿˜æ˜¯å»ºè®®ä½ ç›´æ¥è·³è½¬å»çœ‹çœ‹æ‰”ç‰©çº¿çš„<a href="http://gank.io/post/560e15be2dca930e00da1083" target="_blank" rel="external">æ–‡ç« </a>ã€‚</p>
<h1 id="è¯¥æ€ä¹ˆç”¨RxJava"><a href="#è¯¥æ€ä¹ˆç”¨RxJava" class="headerlink" title="è¯¥æ€ä¹ˆç”¨RxJava"></a>è¯¥æ€ä¹ˆç”¨RxJava</h1><p>å…¶å®æˆ‘ä»¥å‰æ˜¯å…ˆçœ‹çš„å¤§å¤´é¬¼ç¿»è¯‘çš„æ–‡ç« ï¼Œè§‰å¾—ç¿»è¯‘çš„å¾ˆå¥½ï¼ˆè‹±æ–‡çš„ï¼Œçœ‹ç€å¤šå¤šå°‘å°‘æœ‰æ—¶ä¸å¤ªç†è§£ï¼‰ï¼Œæ·±å…¥æµ…å‡ºå‘Šè¯‰ä½ æ€ä¹ˆä½¿ç”¨RxJavaã€‚</p>
<ol>
<li><a href="http://blog.csdn.net/lzyzsd/article/details/41833541" target="_blank" rel="external">æ·±å…¥æµ…å‡ºRxJavaï¼ˆä¸€ï¼šåŸºç¡€ç¯‡ï¼‰</a></li>
<li><a href="http://blog.csdn.net/lzyzsd/article/details/44094895" target="_blank" rel="external">æ·±å…¥æµ…å‡ºRxJava(äºŒï¼šæ“ä½œç¬¦)</a></li>
<li><a href="http://blog.csdn.net/lzyzsd/article/details/44891933" target="_blank" rel="external">æ·±å…¥æµ…å‡ºRxJavaä¸‰â€“å“åº”å¼çš„å¥½å¤„</a></li>
<li><a href="http://blog.csdn.net/lzyzsd/article/details/45033611" target="_blank" rel="external">æ·±å…¥æµ…å‡ºRxJavaå››-åœ¨Androidä¸­ä½¿ç”¨å“åº”å¼ç¼–ç¨‹</a></li>
</ol>
<p>çœ‹å®Œäº†è¿™äº›ä½ æˆ–è®¸å¯¹RxJavaæœ‰ä¸ªå¤§æ¦‚çš„å°è±¡å’Œä½¿ç”¨å¸¸è§çš„æ“ä½œç¬¦ï¼Œé‚£ä½ å¯ä»¥è¯•è¯•ç”¨RxJavaå’ŒRxAndroidæ¥ä¸€ä¸ªç®€å•çš„é¡¹ç›®ã€‚<br><a href="https://github.com/jpetitto/MovieListApp" target="_blank" rel="external">MovieListApp</a>æ²¡äº‹å¯ä»¥çœ‹çœ‹è¿™ä¸ªé¡¹ç›®ï¼Œå°†è¯·æ±‚çš„æœåŠ¡å™¨è¿œç¨‹æ•°æ®è¯·æ±‚åï¼Œé€šè¿‡Observable.just(ï¼‰åï¼Œå¯ä»¥å¤„ç†è¿™äº›æ•°æ®ï¼Œé€šè¿‡mapè½¬æ¢ã€onNextï¼ˆï¼‰é‡Œç¼“å­˜ï¼Œçº¿ç¨‹åˆ‡æ¢ã€æœ€åé€šè¿‡subcriberäº¤ç»™æˆ‘ä»¬éœ€è¦å±•ç¤ºçš„UIç»„ä»¶ä¸Šã€‚</p>
<p>æ˜¯ä¸æ˜¯æœ‰ç‚¹æ„æ€äº†ã€‚<br>è¿˜æœ‰ä¸€ä¸ª<a href="https://github.com/kaushikgopal/RxJava-Android-Samples" target="_blank" rel="external">Demo</a>ã€‚</p>
<p>ç­‰ç­‰ï¼Œæˆ‘æ„Ÿè§‰æˆ‘è¿˜æ˜¯ä¸ç†Ÿç»ƒå•Šã€‚æ²¡å…³ç³»ï¼Œæˆ‘æ˜¯é›·é”‹ï¼Œç»§ç»­ç»™ä½ å‘æ”¾ç¦åˆ©ã€‚</p>
<ol>
<li><p><a href="https://github.com/mcxiaoke/RxDocs" target="_blank" rel="external">ReactiveXæ–‡æ¡£ä¸­æ–‡ç¿»è¯‘</a></p>
</li>
<li><p><a href="http://rxmarbles.com/" target="_blank" rel="external">å„ç§æ“ä½œç¬¦çš„ç¤ºä¾‹å›¾</a>ï¼Œæ»¡è¶³ä½ çš„è§†è§‰ã€‚<br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/QQ20160413-1.png" alt=""></p>
</li>
<li><p><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0430/2815.html" target="_blank" rel="external">æ³¡ç½‘ç›¸å…³çš„RxJavaæ€»ç»“</a>ï¼Œæ³¡ç½‘é‡Œå†³å®šæ˜¯éƒ½è‰¯å¿ƒåšæ–‡ã€‚</p>
</li>
</ol>
<h1 id="æ‹“å±•åº“"><a href="#æ‹“å±•åº“" class="headerlink" title="æ‹“å±•åº“"></a>æ‹“å±•åº“</h1><p>RxJavaçš„æ‹“å±•åº“å¤ªå¤šäº†ï¼Œå¦‚JakeWhartonå‚ä¸æˆ–è€…ä¸»å¯¼çš„é¡¹ç›®å°±å‚ä¸äº†RxBindingã€RxAndroidç­‰é¡¹ç›®ï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šçš„äººå‚ä¸RxJavaçš„æ¨å¹¿ä¸­ã€‚</p>
<p>æˆ‘å°±é¡¹ç›®ä¸­å¯èƒ½ä¼šç”¨åˆ°çš„ä¸€äº›åº“ç»™å¤§å®¶æ¨èå‡ æ¬¾ã€‚</p>
<h2 id="Retrofit"><a href="#Retrofit" class="headerlink" title="Retrofit"></a><a href="http://square.github.io/retrofit/" target="_blank" rel="external">Retrofit</a></h2><p>ä¸€ä¸ªæ‡’äººå¿…å¤‡ç¥å™¨ï¼Œå¯ä»¥ç®€åŒ–æˆ‘ä»¬å¯¹ç½‘ç»œè¯·æ±‚çš„å°è£…ï¼Œç”¨å®ƒå¯èƒ½ä¹Ÿæœ‰ä¸€äº›é—®é¢˜ï¼Œéœ€è¦ä½ å†å¼€å‘ä¸­è§£å†³ã€‚å»ºè®®ä½¿ç”¨Retrofit 2.0ã€‚</p>
<ol>
<li><p><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0915/3460.html" target="_blank" rel="external">Retrofit 2.0ï¼šæœ‰å²ä»¥æ¥æœ€å¤§çš„æ”¹è¿›</a></p>
</li>
<li><p><a href="http://gank.io/post/56e80c2c677659311bed9841" target="_blank" rel="external">RxJava ä¸ Retrofit ç»“åˆçš„æœ€ä½³å®è·µ</a> Gank.ioçš„åŒ å¿ƒå†™ä½œç³»åˆ—æ–‡ç« ã€‚</p>
</li>
<li><p><a href="https://futurestud.io/blog/retrofit-getting-started-and-android-client" target="_blank" rel="external">Retrofitçš„ä½¿ç”¨æ‰‹å†Œ</a>ï¼Œå¿…å¤‡æ‰‹å†Œã€‚</p>
</li>
</ol>
<h2 id="RxBinding"><a href="#RxBinding" class="headerlink" title="RxBinding"></a><a href="https://github.com/JakeWharton/RxBinding" target="_blank" rel="external">RxBinding</a></h2><p>JakeWhartonå¤§ç¥æ“åˆ€é¡¹ç›®ï¼Œä¸»è¦æ˜¯å„ç§ç»„ä»¶ç»‘å®šï¼Œå°†Onclickã€TextWatcherç­‰æ—¶é—´ä½œä¸ºä¸€ä¸ªäº‹ä»¶æºï¼Œé€šè¿‡RxJavaå¯ä»¥æ”¹å–„ç”¨æˆ·çš„äº¤äº’ä½“éªŒï¼Œé¿å…äº†å¿«é€Ÿç‚¹å‡»ä¼šå‡ºç°ä¸¤ä¸ªç‚¹å‡»äº‹ä»¶ã€‚å¦å¤–ï¼Œè¿˜æ”¯æŒkotlinã€‚<br><img src="http://7xj9f0.com1.z0.glb.clouddn.com/QQ20160413-2.png" alt=""></p>
<h2 id="RxLifecycle"><a href="#RxLifecycle" class="headerlink" title="RxLifecycle"></a><a href="https://github.com/trello/RxLifecycle" target="_blank" rel="external">RxLifecycle</a></h2><p>ç”¨æ¥ä¸¥æ ¼æ§åˆ¶ç”±äºå‘å¸ƒäº†ä¸€ä¸ªè®¢é˜…åï¼Œç”±äºæ²¡æœ‰åŠæ—¶å–æ¶ˆï¼Œå¯¼è‡´Activity/Fragmentæ— æ³•é”€æ¯å¯¼è‡´çš„å†…å­˜æ³„éœ²ã€‚</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/QQ20160413-3.png" alt=""></p>
<h2 id="Rx-preferences"><a href="#Rx-preferences" class="headerlink" title="Rx-preferences"></a><a href="https://github.com/f2prateek/rx-preferences" target="_blank" rel="external">Rx-preferences</a></h2><p>ç”¨RxJavaå®ç°Androidä¸­çš„SharedPreferences</p>
<p><img src="http://7xj9f0.com1.z0.glb.clouddn.com/QQ20160413-4.png" alt="image">)</p>
<h2 id="Storio"><a href="#Storio" class="headerlink" title="Storio"></a><a href="https://github.com/pushtorefresh/storio" target="_blank" rel="external">Storio</a></h2><p>æ”¯æŒRxJavaçš„æ•°æ®åº“</p>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><ol>
<li><a href="https://github.com/lzyzsd/Awesome-RxJava" target="_blank" rel="external">Awesome-RxJava</a></li>
<li><a href="http://www.jianshu.com/p/6917510b0e4c" target="_blank" rel="external">RxJavaå¸¸è§çš„ä½¿ç”¨åœºæ™¯æ€»ç»“</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://7xj9f0.com1.z0.glb.clouddn.com/md/1470727585294.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;RxJavaæ˜¯ä½œä¸ºAndroidå¼€å‘ä¸­çš„æ–°è´µï¼Œ è¶Šæ¥è¶Šå¤šçš„äººå‚ä¸åˆ°RxJavaçš„æ‹“å±•å’Œä½¿ç”¨ä¸Šï¼Œå¦‚JakeWhartonå‚ä¸äº†å¤šä¸ªRxJavaé¡¹ç›®ã€‚å›½å†…å‘¢ï¼Œä¸€å¤§æ‰¹ï¼ˆå¦‚æ‰”ç‰©çº¿ã€å°é‚“å­ã€ä»£ç å®¶ç­‰ï¼‰å¯¹RxJavaæ¨å¹¿ï¼Œä½ è¦ä¸æ²¡å¬è¿‡å®ƒï¼Œä½ éƒ½è§‰å¾—ä¸å¥½æ„æ€ï¼Œå› ä¸ºå®ƒå¤ªç«äº†ã€‚&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
